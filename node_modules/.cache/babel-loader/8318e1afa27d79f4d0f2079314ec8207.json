{"ast":null,"code":"var _jsxFileName = \"/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/InferenceUI.js\";\nimport './InferenceUI.css';\nimport React from 'react';\nimport WebcamStream from './WebcamStream/WebcamStream.js';\nimport SidePanel from './SidePanel/SidePanel.js';\nimport { manageStates } from './functions.js';\nimport foto from './beyonce.webp'; //import socketIOClient from \"socket.io-client\";\n//import React, { useEffect, useState } from \"react\";\n//import FileSaver from 'file-saver';\n\nconst ENDPOINT = \"wss://qcwh36f8wg.execute-api.sa-east-1.amazonaws.com/Dev/\";\n\nconst WebSocket = require('isomorphic-ws');\n\nconst packetsSentLimit = 1;\nconst zipName = 'p';\nconst alertWaitFor = 2000; //miliseconds to wait for alerts\n\nconst alertsLimit = 3; //how many alerts in alertWaiFor necessary to show the alert on screen\n\nconst alertTTL = 4000; //miliseconds to keep alert on screen\n\nclass InferenceUI extends React.Component {\n  constructor(props) {\n    super();\n    this.state = {\n      stateName: \"Idle\",\n      // Render canvas or video\n      renderCanvas: true,\n      // Canvas Message\n      canvasMessage: \"\",\n      canvasAlert: false,\n      // Progress Bar props\n      showProgressBar: false,\n      progress: 0,\n      // Show Spinner\n      showSpinner: false,\n      // Button state\n      textCtrlBtn: \"Empezar\",\n      enableCtrlBtn: true,\n      enableCaptureBtn: false,\n      // Side Panel\n      tabsEnabled: [1, 0, 0, 0],\n      //conf, results, diagnosis, report\n      GallerySrcLength: 0,\n      GalleryIndexShowing: [0, 0, 0],\n      selectedGalleryPhoto: 0,\n      isVideoLoading: true,\n      hideSidePanel: false,\n      tabOn: 1,\n      fullScreen: false,\n      isDiagnosisReady: false,\n      blurAlert: false,\n      domAlert: false\n    };\n    this.gallerySrc = new Map();\n    this.childWebcamStream = React.createRef();\n    this.childDiagnosis = React.createRef();\n    this.countdownFrom = 5;\n    this.alertTimeout = null;\n    this.videoThumbnail = null;\n    this.canvasPreview = React.createRef();\n    this.socketCon = null;\n    this.pdfSrc = null;\n    this.presignedURL = [];\n    this.indexURL = 0;\n    this.blurCnt = 0;\n    this.blurTimeoutAlertOn = null;\n    this.blurTimeoutAlertOff = null;\n    this.domCnt = 0;\n    this.domTimeoutAlertOn = null;\n    this.domTimeoutAlertOff = null;\n  } // En caso de que venga de review y vaya a idle, limpiar las variables.\n\n\n  async stateHandler(nextState) {\n    await this.setState({\n      stateName: nextState\n    });\n    console.log(\"Estado: \" + this.state.stateName);\n\n    if (nextState.localeCompare('Idle') === 0) {\n      this.setState(manageStates(nextState), async () => {\n        this.childDiagnosis.current.listDevices();\n        var selectObj = document.getElementById(\"videoSelectConf\");\n\n        for (var i = 0; i < selectObj.options.length; i++) {\n          if (!selectObj.options[i].text.localeCompare(this.childWebcamStream.current.videoSrc)) {\n            selectObj.options[i].selected = true;\n            break;\n          }\n        }\n\n        document.getElementById(\"countdownFromInput\").value = this.countdownFrom;\n      });\n    } else {\n      await this.setState(manageStates(nextState));\n\n      if (nextState.localeCompare('Countdown') === 0 && this.state.fullScreen) {\n        let cnvs = document.getElementById('canvasCountdown');\n        if (cnvs) cnvs.style.marginLeft = '12%';\n      }\n    }\n\n    if (!this.state.hideSidePanel) {\n      let tabs = document.getElementsByClassName('tab');\n\n      for (let i = 0; i < 4; i++) {\n        if (!this.state.tabsEnabled[i]) tabs[i].style.color = 'grey';else {\n          if (i !== this.state.tabOn - 1) tabs[i].style.color = 'white';else tabs[i].style.color = 'var(--main)';\n        }\n      }\n    }\n  }\n\n  downloadHandler(media) {\n    if (media.localeCompare(\"video\") === 0) {\n      this.childWebcamStream.current.downloadVideo();\n    } else if (media.localeCompare(\"screenshots\") === 0) {\n      this.childWebcamStream.current.downloadScreenshots();\n    } else if (media.localeCompare(\"all\") === 0) {\n      this.childWebcamStream.current.downloadAll();\n    }\n  }\n\n  async setGalleryIndxShowing(newIndxShowing, indx, newPhoto, dir) {\n    let auxArr = [];\n    let mapKeys = Array.from(this.gallerySrc.keys());\n\n    if (dir.localeCompare('prev') === 0 && this.state.GalleryIndexShowing[0] > mapKeys[0] || newPhoto || dir.localeCompare('reset') === 0 || dir.localeCompare('delete') === 0 || dir.localeCompare('next') === 0 && this.state.GalleryIndexShowing[2] < mapKeys[mapKeys.length - 1] && this.state.GalleryIndexShowing[2] !== 0) {\n      auxArr[0] = this.state.GalleryIndexShowing[0];\n      auxArr[1] = this.state.GalleryIndexShowing[1];\n      auxArr[2] = this.state.GalleryIndexShowing[2];\n\n      for (let i = 0; i < newIndxShowing.length; i++) {\n        auxArr[indx[i]] = newIndxShowing[i];\n      }\n\n      if (dir) {\n        this.childDiagnosis.current.galleryCtrl(dir, auxArr, this.gallerySrc, false, this.state.selectedGalleryPhoto);\n      }\n\n      if (newPhoto) {\n        this.setSelectedGalleryPhoto(newIndxShowing[newIndxShowing.length - 1]);\n\n        if (this.state.GalleryIndexShowing[2] !== 0) {\n          this.childDiagnosis.current.galleryCtrl('next', auxArr, this.gallerySrc, true);\n        }\n      }\n\n      if (dir.localeCompare('delete') === 0) {\n        document.getElementById('img1').src = this.gallerySrc.get(auxArr[0]);\n        document.getElementById('img2').src = this.gallerySrc.get(auxArr[1]);\n        document.getElementById('img3').src = this.gallerySrc.get(auxArr[2]);\n      }\n\n      this.setState({\n        GalleryIndexShowing: auxArr\n      });\n    }\n  }\n\n  setFullScreen(value) {\n    this.setState({\n      fullScreen: value\n    });\n  }\n\n  setTabOn(value) {\n    if (!this.state.hideSidePanel) {\n      let tabs = document.getElementsByClassName('tab');\n      tabs[this.state.tabOn - 1].style.backgroundColor = 'var(--main)';\n      tabs[this.state.tabOn - 1].style.color = 'white';\n      tabs[this.state.tabOn - 1].style.borderBottom = 'black';\n      tabs[value - 1].style.backgroundColor = 'white';\n      tabs[value - 1].style.color = 'var(--main)';\n      tabs[value - 1].style.borderBottom = 'none';\n      this.setState({\n        tabOn: value\n      }, () => {\n        if (value === 2) {\n          document.getElementById('img1').src = this.gallerySrc.get(this.state.GalleryIndexShowing[0]);\n          document.getElementById('img2').src = this.gallerySrc.get(this.state.GalleryIndexShowing[1]);\n          document.getElementById('img3').src = this.gallerySrc.get(this.state.GalleryIndexShowing[2]);\n\n          if (this.state.stateName.localeCompare('Review') === 0) {\n            //enable all download buttons\n            if (this.gallerySrc.size > 0) {\n              for (let i = 0; i < 3; i++) {\n                document.getElementsByClassName('download')[i].style.color = \"white\";\n                document.getElementsByClassName('downloadLogo')[i].style.filter = \"invert(1)\";\n              }\n            } //enable only video download\n            else {\n                document.getElementsByClassName('download')[2].style.color = \"white\";\n                document.getElementsByClassName('downloadLogo')[2].style.filter = \"invert(1)\";\n              }\n          } //disable all downloads in any other state\n          else {\n              for (let i = 0; i < 3; i++) {\n                document.getElementsByClassName('download')[i].style.color = \"rgba(0,0,0,0.3)\";\n                document.getElementsByClassName('downloadLogo')[i].style.filter = \"opacity(0.3)\";\n              }\n            }\n        }\n      });\n    } else {\n      this.setState({\n        tabOn: value\n      });\n    }\n  }\n\n  setHideSidePanel(value) {\n    this.setState({\n      hideSidePanel: value\n    }, () => {\n      if (!value) this.setTabOn(this.state.tabOn);\n    });\n  }\n\n  setIsVideoLoading(value) {\n    this.setState({\n      isVideoLoading: value\n    });\n  }\n\n  setCountdownFrom(value) {\n    this.countdownFrom = value;\n  }\n\n  setIsDiagnosisReady(value) {\n    this.setState({\n      isDiagnosisReady: value\n    });\n  }\n\n  setSelectedGalleryPhoto(id) {\n    this.setState({\n      selectedGalleryPhoto: id\n    });\n  }\n\n  async setScreenshots(data) {\n    let newId = this.state.GallerySrcLength + 1;\n    await this.gallerySrc.set(newId, data);\n    this.setState({\n      GallerySrcLength: this.state.GallerySrcLength + 1\n    }, () => {\n      this.childDiagnosis.current.setGallery2();\n    });\n  }\n\n  layout() {\n    this.childWebcamStream.current.organizeScreen(this.childWebcamStream.current);\n  }\n\n  setPdfSrc(pdf) {\n    this.pdfSrc = pdf;\n  }\n\n  setBlurAlertOn() {\n    this.setState({\n      blurAlert: true\n    });\n    let el = this;\n    this.blurTimeoutAlertOff = setTimeout(function () {\n      el.setBlurAlertOff();\n    }, alertTTL);\n  }\n\n  setBlurAlertOff() {\n    this.setState({\n      blurAlert: false\n    });\n    this.blurTimeoutAlertOff = null;\n  }\n\n  setDomAlertOn() {\n    this.setState({\n      domAlert: true\n    });\n    let el = this;\n    this.domTimeoutAlertOff = setTimeout(function () {\n      el.setDomAlertOff();\n    }, alertTTL);\n  }\n\n  setDomAlertOff() {\n    this.setState({\n      domAlert: false\n    });\n    this.domTimeoutAlertOff = null;\n  }\n\n  componentDidMount() {\n    this.childDiagnosis.current.listDevices();\n    document.addEventListener('fullscreenchange', event => {\n      this.layout();\n    });\n    document.addEventListener(\"webkitfullscreenchange\", event => {\n      this.layout();\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(WebcamStream, {\n      currentState: this.state,\n      gallerySrc: this.gallerySrc,\n      canvasPreview: this.canvasPreview,\n      stateHandler: nextState => this.stateHandler(nextState),\n      countdownFrom: this.countdownFrom,\n      ref: this.childWebcamStream,\n      setScreenshots: data => {\n        this.setScreenshots(data);\n      },\n      setFullScreen: value => this.setFullScreen(value),\n      setTabOn: value => this.setTabOn(value),\n      setHideSidePanel: value => this.setHideSidePanel(value),\n      setIsDiagnosisReady: value => this.setIsDiagnosisReady(value),\n      setIsVideoLoading: value => this.setIsVideoLoading(value),\n      setCountdownFrom: value => this.setCountdownFrom(value),\n      setGallery: () => this.setGallery(),\n      setGalleryIndxShowing: (newIndxShowing, indx, newPhoto, dir) => this.setGalleryIndxShowing(newIndxShowing, indx, newPhoto, dir),\n      hideSidePanel: () => this.childDiagnosis.current.hideSidePanel(),\n      sendViaSocket: content => sendFile(content, this.socketConi, this.presignedURL, this),\n      getCon: () => getCon(this),\n      closeCon: () => closeCon(this),\n      pdfSrc: this.pdfSrc,\n      setPdfSrc: () => this.setPdfSrc(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 10\n      }\n    }), /*#__PURE__*/React.createElement(SidePanel, {\n      currentState: this.state,\n      setStreamFromConfig: () => {\n        this.childWebcamStream.current.setStream();\n      },\n      ref: this.childDiagnosis,\n      downloadHandler: media => this.downloadHandler(media),\n      setTabOn: value => this.setTabOn(value),\n      setHideSidePanel: value => this.setHideSidePanel(value),\n      mirror: way => {\n        this.childWebcamStream.current.mirror(way);\n      },\n      setCountdownFrom: value => this.setCountdownFrom(value),\n      countdownFrom: this.countdownFrom,\n      setGalleryIndxShowing: (newIndxShowing, indx, newPhoto, dir) => this.setGalleryIndxShowing(newIndxShowing, indx, newPhoto, dir),\n      gallerySrc: this.gallerySrc,\n      setSelectedGalleryPhoto: id => this.setSelectedGalleryPhoto(id),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 10\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: () => blurAlert(this),\n      style: {\n        position: 'absolute',\n        top: '50vw',\n        left: '5vw'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 9\n      }\n    }, \"B\"), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: () => domAlert(this),\n      style: {\n        position: 'absolute',\n        top: '50vw',\n        left: '10vw'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 9\n      }\n    }, \"D\"), /*#__PURE__*/React.createElement(ReportTest, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}\n\nfunction ReportTest() {\n  return /*#__PURE__*/React.createElement(\"div\", {\n    id: \"ReportTest\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 334,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    id: \"r_logo\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 335,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"table\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 13\n    }\n  }, \" Fecha: \"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 340,\n      columnNumber: 13\n    }\n  }, \" fecha  \")), /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 13\n    }\n  }, \" C\\xF3digo Paciente: \"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 344,\n      columnNumber: 13\n    }\n  }, \" fecha  \")), /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 346,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 347,\n      columnNumber: 13\n    }\n  }, \" Estudio: \"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 13\n    }\n  }, \" fecha  \")), /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 351,\n      columnNumber: 13\n    }\n  }, \" M\\xE9dico Referente: \"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 13\n    }\n  }, \" fecha  \")))), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 7\n    }\n  }, \"INFORME\"), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"results\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 360,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 9\n    }\n  }, \"Resultados\"), /*#__PURE__*/React.createElement(\"img\", {\n    src: foto,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 362,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"img\", {\n    src: foto,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"img\", {\n    src: foto,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"obs\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 367,\n      columnNumber: 9\n    }\n  }, \"Observaciones\"), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"obsBox\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 368,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"diagnosis\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 371,\n      columnNumber: 9\n    }\n  }, \"Diagn\\xF3stico Recomendado\"), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"diagnosisBox\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 372,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"info\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 374,\n      columnNumber: 7\n    }\n  }));\n}\n\nfunction closeCon(el) {\n  console.log('Disconnecting...'); //el.socketCon.close();\n\n  el.childWebcamStream.current.resetSocketVars();\n}\n\nfunction getCon(el) {\n  console.log('Connecting...');\n  el.socketCon = new WebSocket(ENDPOINT);\n\n  el.socketCon.onopen = function open() {\n    console.log('connected');\n    let fileNames = '\"p1.zip\"';\n\n    for (let i = 2; i <= packetsSentLimit; i++) {\n      fileNames += ',\"' + zipName + i + '.zip\"';\n    }\n\n    let msg = '{\"action\":\"getURL\", \"fileName\":[' + fileNames + ']}';\n    el.socketCon.send(msg);\n  };\n\n  el.socketCon.onclose = function close() {\n    console.log('disconnected');\n  };\n\n  el.socketCon.onmessage = function incoming(data) {\n    console.log(JSON.parse(data.data));\n    let dataJSON = JSON.parse(data.data);\n\n    if (dataJSON.response) {\n      console.log('Set presigned URLs');\n      el.presignedURL = dataJSON.response;\n    }\n\n    if (dataJSON.alert) {\n      //may not work to check\n      //check format\n      if (dataJSON.alert[0].localeCompare('blur') === 0) {\n        console.log('Blur');\n        blurAlert(el);\n      }\n\n      if (dataJSON.alert[0].localeCompare('dom') === 0) {\n        console.log('Dom');\n        domAlert();\n      }\n    } //el.socketCon.close();\n\n  };\n}\n\nfunction sendFile(file, socketCon, presignedURL, el) {\n  console.log('Sending...');\n  var xhr = new XMLHttpRequest();\n  xhr.open('PUT', presignedURL[el.indexURL], true);\n\n  xhr.onload = () => {\n    if (xhr.status === 200) {\n      console.log('Uploaded data successfully');\n    }\n  };\n\n  xhr.onerror = () => {\n    console.log('Nope');\n  };\n\n  xhr.send(file);\n  el.indexURL++;\n} //function sleep(ms) {return new Promise(resolve => setTimeout(resolve, ms));}\n\n\nfunction blurAlert(el) {\n  console.log('blur');\n  el.blurCnt++;\n\n  if (el.blurTimeoutAlertOn === null) {\n    el.blurTimeoutAlertOn = setTimeout(function () {\n      if (el.blurCnt > alertsLimit) {\n        //not currently showing alert\n        if (el.blurTimeoutAlertOff === null) {\n          el.setBlurAlertOn();\n        } else {\n          clearTimeout(el.blurTimeoutAlertOff);\n          el.blurTimeoutAlertOff = setTimeout(function () {\n            el.setBlurAlertOff();\n          }, alertTTL);\n        }\n      } else {\n        el.blurTimeoutAlertOff = null;\n      }\n\n      el.blurCnt = 0;\n      el.blurTimeoutAlertOn = null;\n    }, alertWaitFor);\n  }\n}\n\nfunction domAlert(el) {\n  console.log('dom');\n  el.domCnt++;\n\n  if (el.domTimeoutAlertOn === null) {\n    el.domTimeoutAlertOn = setTimeout(function () {\n      if (el.domCnt > alertsLimit) {\n        //not currently showing alert\n        if (el.domTimeoutAlertOff === null) {\n          el.setDomAlertOn();\n        } else {\n          clearTimeout(el.domTimeoutAlertOff);\n          el.domTimeoutAlertOff = setTimeout(function () {\n            el.setDomAlertOff();\n          }, alertTTL);\n        }\n      } else {\n        el.domTimeoutAlertOff = null;\n      }\n\n      el.domCnt = 0;\n      el.domTimeoutAlertOn = null;\n    }, alertWaitFor);\n  }\n}\n\nexport default InferenceUI;","map":{"version":3,"sources":["/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/InferenceUI.js"],"names":["React","WebcamStream","SidePanel","manageStates","foto","ENDPOINT","WebSocket","require","packetsSentLimit","zipName","alertWaitFor","alertsLimit","alertTTL","InferenceUI","Component","constructor","props","state","stateName","renderCanvas","canvasMessage","canvasAlert","showProgressBar","progress","showSpinner","textCtrlBtn","enableCtrlBtn","enableCaptureBtn","tabsEnabled","GallerySrcLength","GalleryIndexShowing","selectedGalleryPhoto","isVideoLoading","hideSidePanel","tabOn","fullScreen","isDiagnosisReady","blurAlert","domAlert","gallerySrc","Map","childWebcamStream","createRef","childDiagnosis","countdownFrom","alertTimeout","videoThumbnail","canvasPreview","socketCon","pdfSrc","presignedURL","indexURL","blurCnt","blurTimeoutAlertOn","blurTimeoutAlertOff","domCnt","domTimeoutAlertOn","domTimeoutAlertOff","stateHandler","nextState","setState","console","log","localeCompare","current","listDevices","selectObj","document","getElementById","i","options","length","text","videoSrc","selected","value","cnvs","style","marginLeft","tabs","getElementsByClassName","color","downloadHandler","media","downloadVideo","downloadScreenshots","downloadAll","setGalleryIndxShowing","newIndxShowing","indx","newPhoto","dir","auxArr","mapKeys","Array","from","keys","galleryCtrl","setSelectedGalleryPhoto","src","get","setFullScreen","setTabOn","backgroundColor","borderBottom","size","filter","setHideSidePanel","setIsVideoLoading","setCountdownFrom","setIsDiagnosisReady","id","setScreenshots","data","newId","set","setGallery2","layout","organizeScreen","setPdfSrc","pdf","setBlurAlertOn","el","setTimeout","setBlurAlertOff","setDomAlertOn","setDomAlertOff","componentDidMount","addEventListener","event","render","setGallery","content","sendFile","socketConi","getCon","closeCon","setStream","way","mirror","position","top","left","ReportTest","resetSocketVars","onopen","open","fileNames","msg","send","onclose","close","onmessage","incoming","JSON","parse","dataJSON","response","alert","file","xhr","XMLHttpRequest","onload","status","onerror","clearTimeout"],"mappings":";AAAA,OAAO,mBAAP;AACA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,YAAP,MAAyB,gCAAzB;AACA,OAAOC,SAAP,MAAsB,0BAAtB;AACA,SAAQC,YAAR,QAA2B,gBAA3B;AAEA,OAAOC,IAAP,MAAiB,gBAAjB,C,CACA;AACA;AACA;;AACA,MAAMC,QAAQ,GAAG,2DAAjB;;AACA,MAAMC,SAAS,GAAGC,OAAO,CAAC,eAAD,CAAzB;;AAEA,MAAMC,gBAAgB,GAAG,CAAzB;AACA,MAAMC,OAAO,GAAG,GAAhB;AAEA,MAAMC,YAAY,GAAG,IAArB,C,CAA4B;;AAC5B,MAAMC,WAAW,GAAG,CAApB,C,CAA2B;;AAC3B,MAAMC,QAAQ,GAAG,IAAjB,C,CAA4B;;AAE5B,MAAMC,WAAN,SAA0Bb,KAAK,CAACc,SAAhC,CAA0C;AAExCC,EAAAA,WAAW,CAACC,KAAD,EAAO;AAChB;AACA,SAAKC,KAAL,GAAa;AACXC,MAAAA,SAAS,EAAE,MADA;AAGX;AACAC,MAAAA,YAAY,EAAE,IAJH;AAKX;AACAC,MAAAA,aAAa,EAAE,EANJ;AAOXC,MAAAA,WAAW,EAAE,KAPF;AASX;AACAC,MAAAA,eAAe,EAAE,KAVN;AAWXC,MAAAA,QAAQ,EAAE,CAXC;AAYX;AACAC,MAAAA,WAAW,EAAE,KAbF;AAcX;AACAC,MAAAA,WAAW,EAAE,SAfF;AAgBXC,MAAAA,aAAa,EAAE,IAhBJ;AAiBXC,MAAAA,gBAAgB,EAAE,KAjBP;AAmBX;AACAC,MAAAA,WAAW,EAAE,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CApBF;AAoBa;AACxBC,MAAAA,gBAAgB,EAAE,CArBP;AAsBXC,MAAAA,mBAAmB,EAAE,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAtBV;AAuBXC,MAAAA,oBAAoB,EAAE,CAvBX;AAwBXC,MAAAA,cAAc,EAAE,IAxBL;AAyBXC,MAAAA,aAAa,EAAE,KAzBJ;AA2BXC,MAAAA,KAAK,EAAE,CA3BI;AA4BXC,MAAAA,UAAU,EAAE,KA5BD;AA8BXC,MAAAA,gBAAgB,EAAE,KA9BP;AAgCXC,MAAAA,SAAS,EAAE,KAhCA;AAiCXC,MAAAA,QAAQ,EAAE;AAjCC,KAAb;AAoCA,SAAKC,UAAL,GAAkB,IAAIC,GAAJ,EAAlB;AACA,SAAKC,iBAAL,GAAyBzC,KAAK,CAAC0C,SAAN,EAAzB;AACA,SAAKC,cAAL,GAAsB3C,KAAK,CAAC0C,SAAN,EAAtB;AACA,SAAKE,aAAL,GAAqB,CAArB;AACA,SAAKC,YAAL,GAAoB,IAApB;AACA,SAAKC,cAAL,GAAsB,IAAtB;AACA,SAAKC,aAAL,GAAqB/C,KAAK,CAAC0C,SAAN,EAArB;AAEA,SAAKM,SAAL,GAAiB,IAAjB;AACA,SAAKC,MAAL,GAAc,IAAd;AACF,SAAKC,YAAL,GAAoB,EAApB;AACE,SAAKC,QAAL,GAAgB,CAAhB;AAEA,SAAKC,OAAL,GAAe,CAAf;AACA,SAAKC,kBAAL,GAAyB,IAAzB;AACA,SAAKC,mBAAL,GAA0B,IAA1B;AAEA,SAAKC,MAAL,GAAc,CAAd;AACA,SAAKC,iBAAL,GAAwB,IAAxB;AACA,SAAKC,kBAAL,GAAyB,IAAzB;AACD,GA5DuC,CA6DxC;;;AACA,QAAMC,YAAN,CAAmBC,SAAnB,EAA6B;AAC3B,UAAM,KAAKC,QAAL,CAAc;AAAC1C,MAAAA,SAAS,EAAEyC;AAAZ,KAAd,CAAN;AACAE,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAa,KAAK7C,KAAL,CAAWC,SAApC;;AACA,QAAGyC,SAAS,CAACI,aAAV,CAAwB,MAAxB,MAAoC,CAAvC,EAAyC;AACvC,WAAKH,QAAL,CAAczD,YAAY,CAACwD,SAAD,CAA1B,EAAuC,YAAS;AACjD,aAAKhB,cAAL,CAAoBqB,OAApB,CAA4BC,WAA5B;AACG,YAAIC,SAAS,GAAGC,QAAQ,CAACC,cAAT,CAAwB,iBAAxB,CAAhB;;AACH,aAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,SAAS,CAACI,OAAV,CAAkBC,MAAtC,EAA8CF,CAAC,EAA/C,EAAmD;AAC9C,cAAI,CAACH,SAAS,CAACI,OAAV,CAAkBD,CAAlB,EAAqBG,IAArB,CAA0BT,aAA1B,CAAwC,KAAKtB,iBAAL,CAAuBuB,OAAvB,CAA+BS,QAAvE,CAAL,EAAuF;AACnFP,YAAAA,SAAS,CAACI,OAAV,CAAkBD,CAAlB,EAAqBK,QAArB,GAAgC,IAAhC;AACA;AACH;AACF;;AACDP,QAAAA,QAAQ,CAACC,cAAT,CAAwB,oBAAxB,EAA8CO,KAA9C,GAAoD,KAAK/B,aAAzD;AACD,OAVD;AAWD,KAZD,MAaI;AACF,YAAM,KAAKgB,QAAL,CAAczD,YAAY,CAACwD,SAAD,CAA1B,CAAN;;AACA,UAAGA,SAAS,CAACI,aAAV,CAAwB,WAAxB,MAAyC,CAAzC,IAA8C,KAAK9C,KAAL,CAAWkB,UAA5D,EAAuE;AACrE,YAAIyC,IAAI,GAAGT,QAAQ,CAACC,cAAT,CAAwB,iBAAxB,CAAX;AACA,YAAGQ,IAAH,EAASA,IAAI,CAACC,KAAL,CAAWC,UAAX,GAAwB,KAAxB;AAEV;AACF;;AACD,QAAG,CAAC,KAAK7D,KAAL,CAAWgB,aAAf,EAA6B;AAC3B,UAAI8C,IAAI,GAAGZ,QAAQ,CAACa,sBAAT,CAAgC,KAAhC,CAAX;;AACA,WAAI,IAAIX,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAE,CAAlB,EAAqBA,CAAC,EAAtB,EAAyB;AACvB,YAAG,CAAC,KAAKpD,KAAL,CAAWW,WAAX,CAAuByC,CAAvB,CAAJ,EACEU,IAAI,CAACV,CAAD,CAAJ,CAAQQ,KAAR,CAAcI,KAAd,GAAsB,MAAtB,CADF,KAEI;AACF,cAAGZ,CAAC,KAAK,KAAKpD,KAAL,CAAWiB,KAAX,GAAiB,CAA1B,EACE6C,IAAI,CAACV,CAAD,CAAJ,CAAQQ,KAAR,CAAcI,KAAd,GAAsB,OAAtB,CADF,KAGEF,IAAI,CAACV,CAAD,CAAJ,CAAQQ,KAAR,CAAcI,KAAd,GAAsB,aAAtB;AACH;AACF;AACF;AAGF;;AAEDC,EAAAA,eAAe,CAACC,KAAD,EAAO;AACpB,QAAGA,KAAK,CAACpB,aAAN,CAAoB,OAApB,MAA+B,CAAlC,EAAoC;AAClC,WAAKtB,iBAAL,CAAuBuB,OAAvB,CAA+BoB,aAA/B;AACD,KAFD,MAGK,IAAGD,KAAK,CAACpB,aAAN,CAAoB,aAApB,MAAqC,CAAxC,EAA0C;AAC7C,WAAKtB,iBAAL,CAAuBuB,OAAvB,CAA+BqB,mBAA/B;AACD,KAFI,MAGA,IAAGF,KAAK,CAACpB,aAAN,CAAoB,KAApB,MAA6B,CAAhC,EAAkC;AACrC,WAAKtB,iBAAL,CAAuBuB,OAAvB,CAA+BsB,WAA/B;AACD;AACF;;AAED,QAAMC,qBAAN,CAA4BC,cAA5B,EAA4CC,IAA5C,EAAkDC,QAAlD,EAA4DC,GAA5D,EAAgE;AAC9D,QAAIC,MAAM,GAAE,EAAZ;AACA,QAAIC,OAAO,GAAGC,KAAK,CAACC,IAAN,CAAW,KAAKxD,UAAL,CAAgByD,IAAhB,EAAX,CAAd;;AACA,QAAIL,GAAG,CAAC5B,aAAJ,CAAkB,MAAlB,MAA8B,CAA9B,IAAmC,KAAK9C,KAAL,CAAWa,mBAAX,CAA+B,CAA/B,IAAoC+D,OAAO,CAAC,CAAD,CAA/E,IACIH,QADJ,IACgBC,GAAG,CAAC5B,aAAJ,CAAkB,OAAlB,MAA+B,CAD/C,IACoD4B,GAAG,CAAC5B,aAAJ,CAAkB,QAAlB,MAAgC,CADpF,IAEE4B,GAAG,CAAC5B,aAAJ,CAAkB,MAAlB,MAA8B,CAA9B,IAAmC,KAAK9C,KAAL,CAAWa,mBAAX,CAA+B,CAA/B,IAAoC+D,OAAO,CAACA,OAAO,CAACtB,MAAR,GAAe,CAAhB,CAA9E,IAAoG,KAAKtD,KAAL,CAAWa,mBAAX,CAA+B,CAA/B,MAAsC,CAF/I,EAEoJ;AAClJ8D,MAAAA,MAAM,CAAC,CAAD,CAAN,GAAY,KAAK3E,KAAL,CAAWa,mBAAX,CAA+B,CAA/B,CAAZ;AACA8D,MAAAA,MAAM,CAAC,CAAD,CAAN,GAAY,KAAK3E,KAAL,CAAWa,mBAAX,CAA+B,CAA/B,CAAZ;AACA8D,MAAAA,MAAM,CAAC,CAAD,CAAN,GAAY,KAAK3E,KAAL,CAAWa,mBAAX,CAA+B,CAA/B,CAAZ;;AAEA,WAAK,IAAIuC,CAAC,GAAC,CAAX,EAAaA,CAAC,GAAGmB,cAAc,CAACjB,MAAhC,EAAwCF,CAAC,EAAzC,EAA4C;AAC1CuB,QAAAA,MAAM,CAACH,IAAI,CAACpB,CAAD,CAAL,CAAN,GAAkBmB,cAAc,CAACnB,CAAD,CAAhC;AACD;;AAED,UAAGsB,GAAH,EAAO;AACL,aAAKhD,cAAL,CAAoBqB,OAApB,CAA4BiC,WAA5B,CAAwCN,GAAxC,EAA6CC,MAA7C,EAAqD,KAAKrD,UAA1D,EAAsE,KAAtE,EAA6E,KAAKtB,KAAL,CAAWc,oBAAxF;AACD;;AAED,UAAG2D,QAAH,EAAY;AACV,aAAKQ,uBAAL,CAA6BV,cAAc,CAACA,cAAc,CAACjB,MAAf,GAAsB,CAAvB,CAA3C;;AACA,YAAG,KAAKtD,KAAL,CAAWa,mBAAX,CAA+B,CAA/B,MAAsC,CAAzC,EAA2C;AACzC,eAAKa,cAAL,CAAoBqB,OAApB,CAA4BiC,WAA5B,CAAwC,MAAxC,EAAgDL,MAAhD,EAAwD,KAAKrD,UAA7D,EAAyE,IAAzE;AACD;AACF;;AACD,UAAGoD,GAAG,CAAC5B,aAAJ,CAAkB,QAAlB,MAAgC,CAAnC,EAAqC;AACnCI,QAAAA,QAAQ,CAACC,cAAT,CAAwB,MAAxB,EAAgC+B,GAAhC,GAAsC,KAAK5D,UAAL,CAAgB6D,GAAhB,CAAqBR,MAAM,CAAC,CAAD,CAA3B,CAAtC;AACAzB,QAAAA,QAAQ,CAACC,cAAT,CAAwB,MAAxB,EAAgC+B,GAAhC,GAAsC,KAAK5D,UAAL,CAAgB6D,GAAhB,CAAqBR,MAAM,CAAC,CAAD,CAA3B,CAAtC;AACAzB,QAAAA,QAAQ,CAACC,cAAT,CAAwB,MAAxB,EAAgC+B,GAAhC,GAAsC,KAAK5D,UAAL,CAAgB6D,GAAhB,CAAqBR,MAAM,CAAC,CAAD,CAA3B,CAAtC;AACD;;AACD,WAAKhC,QAAL,CACE;AAAC9B,QAAAA,mBAAmB,EAAE8D;AAAtB,OADF;AAGD;AACF;;AAEDS,EAAAA,aAAa,CAAC1B,KAAD,EAAO;AAClB,SAAKf,QAAL,CAAc;AAACzB,MAAAA,UAAU,EAAEwC;AAAb,KAAd;AACD;;AACD2B,EAAAA,QAAQ,CAAC3B,KAAD,EAAO;AACb,QAAG,CAAC,KAAK1D,KAAL,CAAWgB,aAAf,EAA6B;AAC5B,UAAI8C,IAAI,GAAGZ,QAAQ,CAACa,sBAAT,CAAgC,KAAhC,CAAX;AACAD,MAAAA,IAAI,CAAC,KAAK9D,KAAL,CAAWiB,KAAX,GAAiB,CAAlB,CAAJ,CAAyB2C,KAAzB,CAA+B0B,eAA/B,GAAiD,aAAjD;AACAxB,MAAAA,IAAI,CAAC,KAAK9D,KAAL,CAAWiB,KAAX,GAAiB,CAAlB,CAAJ,CAAyB2C,KAAzB,CAA+BI,KAA/B,GAAsC,OAAtC;AACAF,MAAAA,IAAI,CAAC,KAAK9D,KAAL,CAAWiB,KAAX,GAAiB,CAAlB,CAAJ,CAAyB2C,KAAzB,CAA+B2B,YAA/B,GAA8C,OAA9C;AACAzB,MAAAA,IAAI,CAACJ,KAAK,GAAC,CAAP,CAAJ,CAAcE,KAAd,CAAoB0B,eAApB,GAAsC,OAAtC;AACAxB,MAAAA,IAAI,CAACJ,KAAK,GAAC,CAAP,CAAJ,CAAcE,KAAd,CAAoBI,KAApB,GAA4B,aAA5B;AACAF,MAAAA,IAAI,CAACJ,KAAK,GAAC,CAAP,CAAJ,CAAcE,KAAd,CAAoB2B,YAApB,GAAmC,MAAnC;AACC,WAAK5C,QAAL,CAAc;AAAC1B,QAAAA,KAAK,EAAEyC;AAAR,OAAd,EAA6B,MAAI;AAC/B,YAAGA,KAAK,KAAK,CAAb,EAAe;AACbR,UAAAA,QAAQ,CAACC,cAAT,CAAwB,MAAxB,EAAgC+B,GAAhC,GAAsC,KAAK5D,UAAL,CAAgB6D,GAAhB,CAAqB,KAAKnF,KAAL,CAAWa,mBAAX,CAA+B,CAA/B,CAArB,CAAtC;AACAqC,UAAAA,QAAQ,CAACC,cAAT,CAAwB,MAAxB,EAAgC+B,GAAhC,GAAsC,KAAK5D,UAAL,CAAgB6D,GAAhB,CAAqB,KAAKnF,KAAL,CAAWa,mBAAX,CAA+B,CAA/B,CAArB,CAAtC;AACAqC,UAAAA,QAAQ,CAACC,cAAT,CAAwB,MAAxB,EAAgC+B,GAAhC,GAAsC,KAAK5D,UAAL,CAAgB6D,GAAhB,CAAqB,KAAKnF,KAAL,CAAWa,mBAAX,CAA+B,CAA/B,CAArB,CAAtC;;AACA,cAAG,KAAKb,KAAL,CAAWC,SAAX,CAAqB6C,aAArB,CAAmC,QAAnC,MAAiD,CAApD,EAAsD;AACpD;AACA,gBAAG,KAAKxB,UAAL,CAAgBkE,IAAhB,GAAqB,CAAxB,EAA0B;AACxB,mBAAI,IAAIpC,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAE,CAAhB,EAAmBA,CAAC,EAApB,EAAuB;AACrBF,gBAAAA,QAAQ,CAACa,sBAAT,CAAgC,UAAhC,EAA4CX,CAA5C,EAA+CQ,KAA/C,CAAqDI,KAArD,GAA6D,OAA7D;AACAd,gBAAAA,QAAQ,CAACa,sBAAT,CAAgC,cAAhC,EAAgDX,CAAhD,EAAmDQ,KAAnD,CAAyD6B,MAAzD,GAAkE,WAAlE;AACD;AACF,aALD,CAMA;AANA,iBAOI;AACFvC,gBAAAA,QAAQ,CAACa,sBAAT,CAAgC,UAAhC,EAA4C,CAA5C,EAA+CH,KAA/C,CAAqDI,KAArD,GAA6D,OAA7D;AACAd,gBAAAA,QAAQ,CAACa,sBAAT,CAAgC,cAAhC,EAAgD,CAAhD,EAAmDH,KAAnD,CAAyD6B,MAAzD,GAAkE,WAAlE;AACD;AACF,WAbD,CAcA;AAdA,eAeI;AACF,mBAAI,IAAIrC,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAE,CAAhB,EAAmBA,CAAC,EAApB,EAAuB;AACrBF,gBAAAA,QAAQ,CAACa,sBAAT,CAAgC,UAAhC,EAA4CX,CAA5C,EAA+CQ,KAA/C,CAAqDI,KAArD,GAA6D,iBAA7D;AACAd,gBAAAA,QAAQ,CAACa,sBAAT,CAAgC,cAAhC,EAAgDX,CAAhD,EAAmDQ,KAAnD,CAAyD6B,MAAzD,GAAkE,cAAlE;AACD;AACF;AACF;AACF,OA3BD;AA4BD,KApCD,MAqCI;AACF,WAAK9C,QAAL,CAAc;AAAC1B,QAAAA,KAAK,EAAEyC;AAAR,OAAd;AACD;AACF;;AACDgC,EAAAA,gBAAgB,CAAChC,KAAD,EAAO;AACrB,SAAKf,QAAL,CAAc;AAAC3B,MAAAA,aAAa,EAAE0C;AAAhB,KAAd,EAAqC,MAAI;AAAC,UAAI,CAACA,KAAL,EAAY,KAAK2B,QAAL,CAAc,KAAKrF,KAAL,CAAWiB,KAAzB;AAAgC,KAAtF;AACD;;AACD0E,EAAAA,iBAAiB,CAACjC,KAAD,EAAO;AACtB,SAAKf,QAAL,CAAc;AAAC5B,MAAAA,cAAc,EAAE2C;AAAjB,KAAd;AACD;;AACDkC,EAAAA,gBAAgB,CAAClC,KAAD,EAAO;AACrB,SAAK/B,aAAL,GAAqB+B,KAArB;AACD;;AACDmC,EAAAA,mBAAmB,CAACnC,KAAD,EAAO;AACxB,SAAKf,QAAL,CAAc;AAACxB,MAAAA,gBAAgB,EAAEuC;AAAnB,KAAd;AACD;;AACDuB,EAAAA,uBAAuB,CAACa,EAAD,EAAI;AACzB,SAAKnD,QAAL,CAAc;AAAC7B,MAAAA,oBAAoB,EAAEgF;AAAvB,KAAd;AACD;;AACD,QAAMC,cAAN,CAAqBC,IAArB,EAA0B;AACxB,QAAIC,KAAK,GAAM,KAAKjG,KAAL,CAAWY,gBAAX,GAA4B,CAA3C;AACA,UAAM,KAAKU,UAAL,CAAgB4E,GAAhB,CAAoBD,KAApB,EAA2BD,IAA3B,CAAN;AACA,SAAKrD,QAAL,CACE;AAAC/B,MAAAA,gBAAgB,EAAE,KAAKZ,KAAL,CAAWY,gBAAX,GAA6B;AAAhD,KADF,EAEE,MAAI;AAAC,WAAKc,cAAL,CAAoBqB,OAApB,CAA4BoD,WAA5B;AAA0C,KAFjD;AAID;;AAEDC,EAAAA,MAAM,GAAE;AACN,SAAK5E,iBAAL,CAAuBuB,OAAvB,CAA+BsD,cAA/B,CAA8C,KAAK7E,iBAAL,CAAuBuB,OAArE;AACD;;AAEDuD,EAAAA,SAAS,CAACC,GAAD,EAAK;AACZ,SAAKvE,MAAL,GAAcuE,GAAd;AACD;;AACDC,EAAAA,cAAc,GAAE;AACd,SAAK7D,QAAL,CAAc;AAACvB,MAAAA,SAAS,EAAE;AAAZ,KAAd;AACA,QAAIqF,EAAE,GAAG,IAAT;AACA,SAAKpE,mBAAL,GAA2BqE,UAAU,CAAC,YAAU;AAC9CD,MAAAA,EAAE,CAACE,eAAH;AACC,KAFkC,EAEhChH,QAFgC,CAArC;AAGD;;AACDgH,EAAAA,eAAe,GAAE;AACf,SAAKhE,QAAL,CAAc;AAACvB,MAAAA,SAAS,EAAE;AAAZ,KAAd;AACA,SAAKiB,mBAAL,GAA0B,IAA1B;AACD;;AACDuE,EAAAA,aAAa,GAAE;AACb,SAAKjE,QAAL,CAAc;AAACtB,MAAAA,QAAQ,EAAE;AAAX,KAAd;AACA,QAAIoF,EAAE,GAAG,IAAT;AACA,SAAKjE,kBAAL,GAA0BkE,UAAU,CAAC,YAAU;AAC7CD,MAAAA,EAAE,CAACI,cAAH;AACC,KAFiC,EAE/BlH,QAF+B,CAApC;AAGD;;AACDkH,EAAAA,cAAc,GAAE;AACd,SAAKlE,QAAL,CAAc;AAACtB,MAAAA,QAAQ,EAAE;AAAX,KAAd;AACA,SAAKmB,kBAAL,GAAyB,IAAzB;AACD;;AACDsE,EAAAA,iBAAiB,GAAE;AACjB,SAAKpF,cAAL,CAAoBqB,OAApB,CAA4BC,WAA5B;AACAE,IAAAA,QAAQ,CAAC6D,gBAAT,CAA0B,kBAA1B,EAA+CC,KAAK,IAAI;AACtD,WAAKZ,MAAL;AACD,KAFD;AAGAlD,IAAAA,QAAQ,CAAC6D,gBAAT,CAA0B,wBAA1B,EAAqDC,KAAK,IAAI;AAC5D,WAAKZ,MAAL;AACD,KAFD;AAGD;;AAEDa,EAAAA,MAAM,GAAG;AACP,wBACD;AAAK,MAAA,EAAE,EAAC,WAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACM,oBAAC,YAAD;AAAc,MAAA,YAAY,EAAE,KAAKjH,KAAjC;AACc,MAAA,UAAU,EAAI,KAAKsB,UADjC;AAEc,MAAA,aAAa,EAAE,KAAKQ,aAFlC;AAGc,MAAA,YAAY,EAAGY,SAAD,IAAa,KAAKD,YAAL,CAAkBC,SAAlB,CAHzC;AAIc,MAAA,aAAa,EAAE,KAAKf,aAJlC;AAKc,MAAA,GAAG,EAAE,KAAKH,iBALxB;AAMc,MAAA,cAAc,EAAGwE,IAAD,IAAQ;AAAC,aAAKD,cAAL,CAAoBC,IAApB;AAA0B,OANjE;AAOc,MAAA,aAAa,EAAGtC,KAAD,IAAS,KAAK0B,aAAL,CAAmB1B,KAAnB,CAPtC;AAQc,MAAA,QAAQ,EAAGA,KAAD,IAAS,KAAK2B,QAAL,CAAc3B,KAAd,CARjC;AASc,MAAA,gBAAgB,EAAGA,KAAD,IAAS,KAAKgC,gBAAL,CAAsBhC,KAAtB,CATzC;AAUc,MAAA,mBAAmB,EAAIA,KAAD,IAAS,KAAKmC,mBAAL,CAAyBnC,KAAzB,CAV7C;AAWc,MAAA,iBAAiB,EAAGA,KAAD,IAAS,KAAKiC,iBAAL,CAAuBjC,KAAvB,CAX1C;AAYc,MAAA,gBAAgB,EAAGA,KAAD,IAAS,KAAKkC,gBAAL,CAAsBlC,KAAtB,CAZzC;AAac,MAAA,UAAU,EAAE,MAAI,KAAKwD,UAAL,EAb9B;AAcc,MAAA,qBAAqB,EAAE,CAAC3C,cAAD,EAAiBC,IAAjB,EAAuBC,QAAvB,EAAgCC,GAAhC,KAAsC,KAAKJ,qBAAL,CAA2BC,cAA3B,EAA0CC,IAA1C,EAAgDC,QAAhD,EAA0DC,GAA1D,CAd3E;AAec,MAAA,aAAa,EAAE,MAAI,KAAKhD,cAAL,CAAoBqB,OAApB,CAA4B/B,aAA5B,EAfjC;AAgBc,MAAA,aAAa,EAAGmG,OAAD,IAAWC,QAAQ,CAACD,OAAD,EAAS,KAAKE,UAAd,EAAyB,KAAKpF,YAA9B,EAA2C,IAA3C,CAhBhD;AAiBc,MAAA,MAAM,EAAE,MAAIqF,MAAM,CAAC,IAAD,CAjBhC;AAkBc,MAAA,QAAQ,EAAE,MAAIC,QAAQ,CAAC,IAAD,CAlBpC;AAmBc,MAAA,MAAM,EAAE,KAAKvF,MAnB3B;AAoBc,MAAA,SAAS,EAAE,MAAI,KAAKsE,SAAL,EApB7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADN,eAwBM,oBAAC,SAAD;AAAc,MAAA,YAAY,EAAE,KAAKtG,KAAjC;AACc,MAAA,mBAAmB,EAAE,MAAI;AAAC,aAAKwB,iBAAL,CAAuBuB,OAAvB,CAA+ByE,SAA/B;AAA4C,OADpF;AAEc,MAAA,GAAG,EAAE,KAAK9F,cAFxB;AAGc,MAAA,eAAe,EAAGwC,KAAD,IAAS,KAAKD,eAAL,CAAqBC,KAArB,CAHxC;AAIc,MAAA,QAAQ,EAAGR,KAAD,IAAS,KAAK2B,QAAL,CAAc3B,KAAd,CAJjC;AAKc,MAAA,gBAAgB,EAAGA,KAAD,IAAS,KAAKgC,gBAAL,CAAsBhC,KAAtB,CALzC;AAMc,MAAA,MAAM,EAAG+D,GAAD,IAAO;AAAC,aAAKjG,iBAAL,CAAuBuB,OAAvB,CAA+B2E,MAA/B,CAAsCD,GAAtC;AAA2C,OANzE;AAOc,MAAA,gBAAgB,EAAG/D,KAAD,IAAS,KAAKkC,gBAAL,CAAsBlC,KAAtB,CAPzC;AAQc,MAAA,aAAa,EAAE,KAAK/B,aARlC;AASc,MAAA,qBAAqB,EAAE,CAAC4C,cAAD,EAAiBC,IAAjB,EAAuBC,QAAvB,EAAgCC,GAAhC,KAAsC,KAAKJ,qBAAL,CAA2BC,cAA3B,EAA0CC,IAA1C,EAAgDC,QAAhD,EAA0DC,GAA1D,CAT3E;AAUc,MAAA,UAAU,EAAI,KAAKpD,UAVjC;AAWc,MAAA,uBAAuB,EAAKwE,EAAD,IAAQ,KAAKb,uBAAL,CAA6Ba,EAA7B,CAXjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAxBN,eAuCK;AAAQ,MAAA,OAAO,EAAE,MAAI1E,SAAS,CAAC,IAAD,CAA9B;AAAsC,MAAA,KAAK,EAAE;AAACuG,QAAAA,QAAQ,EAAE,UAAX;AAAuBC,QAAAA,GAAG,EAAE,MAA5B;AAAoCC,QAAAA,IAAI,EAAE;AAA1C,OAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAvCL,eAwCK;AAAQ,MAAA,OAAO,EAAE,MAAIxG,QAAQ,CAAC,IAAD,CAA7B;AAAqC,MAAA,KAAK,EAAE;AAACsG,QAAAA,QAAQ,EAAE,UAAX;AAAuBC,QAAAA,GAAG,EAAE,MAA5B;AAAoCC,QAAAA,IAAI,EAAE;AAA1C,OAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAxCL,eA0CK,oBAAC,UAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA1CL,CADC;AAiDC;;AApTqC;;AAuT1C,SAASC,UAAT,GAAqB;AACnB,sBACE;AAAK,IAAA,EAAE,EAAC,YAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAK,IAAA,EAAE,EAAC,QAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF,CADF,eAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF,CALF,eASE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF,CATF,eAaE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF,CAbF,CADF,CAFF,eAuBE;AAAK,IAAA,EAAE,EAAC,OAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAvBF,eA0BE;AAAK,IAAA,EAAE,EAAC,SAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,eAEE;AAAK,IAAA,GAAG,EAAE3I,IAAV;AAAgB,IAAA,GAAG,EAAC,EAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,eAGE;AAAK,IAAA,GAAG,EAAEA,IAAV;AAAgB,IAAA,GAAG,EAAC,EAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAHF,eAIE;AAAK,IAAA,GAAG,EAAEA,IAAV;AAAgB,IAAA,GAAG,EAAC,EAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAJF,CA1BF,eAgCE;AAAK,IAAA,EAAE,EAAC,KAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBADF,eAEE;AAAK,IAAA,EAAE,EAAC,QAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,CAhCF,eAoCE;AAAK,IAAA,EAAE,EAAC,WAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCADF,eAEE;AAAK,IAAA,EAAE,EAAC,cAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,CApCF,eAwCE;AAAK,IAAA,EAAE,EAAC,MAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAxCF,CADF;AA4CD;;AACD,SAASoI,QAAT,CAAkBd,EAAlB,EAAqB;AACnB7D,EAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EADmB,CAEnB;;AACA4D,EAAAA,EAAE,CAACjF,iBAAH,CAAqBuB,OAArB,CAA6BgF,eAA7B;AACD;;AAED,SAAST,MAAT,CAAgBb,EAAhB,EAAmB;AACjB7D,EAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACA4D,EAAAA,EAAE,CAAC1E,SAAH,GAAe,IAAI1C,SAAJ,CAAcD,QAAd,CAAf;;AAEAqH,EAAAA,EAAE,CAAC1E,SAAH,CAAaiG,MAAb,GAAsB,SAASC,IAAT,GAAgB;AAClCrF,IAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACA,QAAIqF,SAAS,GAAG,UAAhB;;AACA,SAAI,IAAI9E,CAAC,GAAC,CAAV,EAAaA,CAAC,IAAI7D,gBAAlB,EAAoC6D,CAAC,EAArC,EAAwC;AACtC8E,MAAAA,SAAS,IAAG,OAAK1I,OAAL,GAAa4D,CAAb,GAAe,OAA3B;AACD;;AACJ,QAAI+E,GAAG,GAAG,qCAAqCD,SAArC,GAAiD,IAA3D;AACAzB,IAAAA,EAAE,CAAC1E,SAAH,CAAaqG,IAAb,CAAkBD,GAAlB;AACA,GARD;;AASD1B,EAAAA,EAAE,CAAC1E,SAAH,CAAasG,OAAb,GAAuB,SAASC,KAAT,GAAiB;AACtC1F,IAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ;AACD,GAFD;;AAIA4D,EAAAA,EAAE,CAAC1E,SAAH,CAAawG,SAAb,GAAyB,SAASC,QAAT,CAAkBxC,IAAlB,EAAwB;AAC9CpD,IAAAA,OAAO,CAACC,GAAR,CAAY4F,IAAI,CAACC,KAAL,CAAW1C,IAAI,CAACA,IAAhB,CAAZ;AACA,QAAI2C,QAAQ,GAAGF,IAAI,CAACC,KAAL,CAAW1C,IAAI,CAACA,IAAhB,CAAf;;AAEA,QAAG2C,QAAQ,CAACC,QAAZ,EAAqB;AACnBhG,MAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ;AACF4D,MAAAA,EAAE,CAACxE,YAAH,GAAkB0G,QAAQ,CAACC,QAA3B;AACC;;AACD,QAAGD,QAAQ,CAACE,KAAZ,EAAkB;AAChB;AACA;AACA,UAAGF,QAAQ,CAACE,KAAT,CAAe,CAAf,EAAkB/F,aAAlB,CAAgC,MAAhC,MAA4C,CAA/C,EAAiD;AAC/CF,QAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACAzB,QAAAA,SAAS,CAACqF,EAAD,CAAT;AACD;;AACD,UAAGkC,QAAQ,CAACE,KAAT,CAAe,CAAf,EAAkB/F,aAAlB,CAAgC,KAAhC,MAA2C,CAA9C,EAAgD;AAC9CF,QAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ;AACAxB,QAAAA,QAAQ;AAET;AACF,KApB6C,CAqBhD;;AACA,GAtBD;AAuBA;;AACD,SAAS+F,QAAT,CAAkB0B,IAAlB,EAAuB/G,SAAvB,EAAkCE,YAAlC,EAA+CwE,EAA/C,EAAkD;AAChD7D,EAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACD,MAAIkG,GAAG,GAAG,IAAIC,cAAJ,EAAV;AACCD,EAAAA,GAAG,CAACd,IAAJ,CAAS,KAAT,EAAgBhG,YAAY,CAACwE,EAAE,CAACvE,QAAJ,CAA5B,EAA2C,IAA3C;;AACD6G,EAAAA,GAAG,CAACE,MAAJ,GAAa,MAAM;AAChB,QAAIF,GAAG,CAACG,MAAJ,KAAe,GAAnB,EAAwB;AACtBtG,MAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACD;AACF,GAJF;;AAKCkG,EAAAA,GAAG,CAACI,OAAJ,GAAc,MAAM;AAClBvG,IAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACD,GAFD;;AAGAkG,EAAAA,GAAG,CAACX,IAAJ,CAASU,IAAT;AACArC,EAAAA,EAAE,CAACvE,QAAH;AACD,C,CACD;;;AACA,SAASd,SAAT,CAAmBqF,EAAnB,EAAsB;AACpB7D,EAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACA4D,EAAAA,EAAE,CAACtE,OAAH;;AACA,MAAGsE,EAAE,CAACrE,kBAAH,KAA0B,IAA7B,EAAkC;AAChCqE,IAAAA,EAAE,CAACrE,kBAAH,GAAwBsE,UAAU,CAAC,YAAU;AAC3C,UAAGD,EAAE,CAACtE,OAAH,GAAazC,WAAhB,EAA4B;AAC1B;AACA,YAAG+G,EAAE,CAACpE,mBAAH,KAA2B,IAA9B,EAAmC;AACjCoE,UAAAA,EAAE,CAACD,cAAH;AACD,SAFD,MAGI;AACF4C,UAAAA,YAAY,CAAC3C,EAAE,CAACpE,mBAAJ,CAAZ;AACAoE,UAAAA,EAAE,CAACpE,mBAAH,GAAyBqE,UAAU,CAAC,YAAU;AAC5CD,YAAAA,EAAE,CAACE,eAAH;AACD,WAFkC,EAEhChH,QAFgC,CAAnC;AAGD;AACF,OAXD,MAYI;AACF8G,QAAAA,EAAE,CAACpE,mBAAH,GAAyB,IAAzB;AACD;;AACDoE,MAAAA,EAAE,CAACtE,OAAH,GAAa,CAAb;AACAsE,MAAAA,EAAE,CAACrE,kBAAH,GAAwB,IAAxB;AACD,KAlBiC,EAkB/B3C,YAlB+B,CAAlC;AAmBD;AACF;;AAED,SAAS4B,QAAT,CAAkBoF,EAAlB,EAAqB;AACnB7D,EAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ;AACA4D,EAAAA,EAAE,CAACnE,MAAH;;AACA,MAAGmE,EAAE,CAAClE,iBAAH,KAAyB,IAA5B,EAAiC;AAC/BkE,IAAAA,EAAE,CAAClE,iBAAH,GAAuBmE,UAAU,CAAC,YAAU;AAC1C,UAAGD,EAAE,CAACnE,MAAH,GAAY5C,WAAf,EAA2B;AACzB;AACA,YAAG+G,EAAE,CAACjE,kBAAH,KAA0B,IAA7B,EAAkC;AAChCiE,UAAAA,EAAE,CAACG,aAAH;AACD,SAFD,MAGI;AACFwC,UAAAA,YAAY,CAAC3C,EAAE,CAACjE,kBAAJ,CAAZ;AACAiE,UAAAA,EAAE,CAACjE,kBAAH,GAAwBkE,UAAU,CAAC,YAAU;AAC3CD,YAAAA,EAAE,CAACI,cAAH;AACD,WAFiC,EAE/BlH,QAF+B,CAAlC;AAGD;AACF,OAXD,MAYI;AACF8G,QAAAA,EAAE,CAACjE,kBAAH,GAAwB,IAAxB;AACD;;AACDiE,MAAAA,EAAE,CAACnE,MAAH,GAAY,CAAZ;AACAmE,MAAAA,EAAE,CAAClE,iBAAH,GAAuB,IAAvB;AACD,KAlBgC,EAkB9B9C,YAlB8B,CAAjC;AAmBD;AACF;;AACD,eAAeG,WAAf","sourcesContent":["import './InferenceUI.css';\nimport React from 'react';\nimport WebcamStream from './WebcamStream/WebcamStream.js'\nimport SidePanel from './SidePanel/SidePanel.js'\nimport {manageStates} from './functions.js'\n\nimport foto from './beyonce.webp'\n//import socketIOClient from \"socket.io-client\";\n//import React, { useEffect, useState } from \"react\";\n//import FileSaver from 'file-saver';\nconst ENDPOINT = \"wss://qcwh36f8wg.execute-api.sa-east-1.amazonaws.com/Dev/\";\nconst WebSocket = require('isomorphic-ws');\n\nconst packetsSentLimit = 1;\nconst zipName = 'p';\n\nconst alertWaitFor = 2000;  //miliseconds to wait for alerts\nconst alertsLimit = 3;     //how many alerts in alertWaiFor necessary to show the alert on screen\nconst alertTTL = 4000;      //miliseconds to keep alert on screen\n\nclass InferenceUI extends React.Component {\n  \n  constructor(props){\n    super();\n    this.state = {\n      stateName: \"Idle\",\n\n      // Render canvas or video\n      renderCanvas: true,\n      // Canvas Message\n      canvasMessage: \"\",\n      canvasAlert: false,\n\n      // Progress Bar props\n      showProgressBar: false,\n      progress: 0,\n      // Show Spinner\n      showSpinner: false,\n      // Button state\n      textCtrlBtn: \"Empezar\",\n      enableCtrlBtn: true,\n      enableCaptureBtn: false,\n\n      // Side Panel\n      tabsEnabled: [1,0,0,0], //conf, results, diagnosis, report\n      GallerySrcLength: 0,\n      GalleryIndexShowing: [0,0,0],\n      selectedGalleryPhoto: 0,\n      isVideoLoading: true,\n      hideSidePanel: false,\n\n      tabOn: 1,\n      fullScreen: false,\n\n      isDiagnosisReady: false,\n      \n      blurAlert: false,\n      domAlert: false\n  \t\n    }\n    this.gallerySrc = new Map();\n    this.childWebcamStream = React.createRef();\n    this.childDiagnosis = React.createRef();\n    this.countdownFrom = 5;\n    this.alertTimeout = null;\n    this.videoThumbnail = null;\n    this.canvasPreview = React.createRef();\n\n    this.socketCon = null;\n    this.pdfSrc = null;\n\t\tthis.presignedURL = [];\n    this.indexURL = 0;\n\n    this.blurCnt = 0;\n    this.blurTimeoutAlertOn= null;\n    this.blurTimeoutAlertOff= null;\n\n    this.domCnt = 0;\n    this.domTimeoutAlertOn= null;\n    this.domTimeoutAlertOff= null;\n  }\n  // En caso de que venga de review y vaya a idle, limpiar las variables.\n  async stateHandler(nextState){\n    await this.setState({stateName: nextState});\n    console.log(\"Estado: \" + this.state.stateName);\n    if(nextState.localeCompare('Idle') === 0){\n      this.setState(manageStates(nextState), async()=>{\n\t\t  \tthis.childDiagnosis.current.listDevices();\n        var selectObj = document.getElementById(\"videoSelectConf\");\n\t\t  \tfor (var i = 0; i < selectObj.options.length; i++) {\n          if (!selectObj.options[i].text.localeCompare(this.childWebcamStream.current.videoSrc)) {\n              selectObj.options[i].selected = true;\n              break;\n          }\n   \t  \t }\n        document.getElementById(\"countdownFromInput\").value=this.countdownFrom;\n      });\n    }\n    else{\n      await this.setState(manageStates(nextState));\n      if(nextState.localeCompare('Countdown') === 0 && this.state.fullScreen){\n        let cnvs = document.getElementById('canvasCountdown');\n        if(cnvs) cnvs.style.marginLeft = '12%';\n\n      }\n    }\n    if(!this.state.hideSidePanel){\n      let tabs = document.getElementsByClassName('tab');\n      for(let i = 0; i <4; i++){\n        if(!this.state.tabsEnabled[i])\n          tabs[i].style.color = 'grey';\n        else{\n          if(i !== this.state.tabOn-1)\n            tabs[i].style.color = 'white';\n          else\n            tabs[i].style.color = 'var(--main)';\n        }\n      }\n    }\n\n  \n  }\n  \n  downloadHandler(media){\n    if(media.localeCompare(\"video\")===0){\n      this.childWebcamStream.current.downloadVideo();\n    }\n    else if(media.localeCompare(\"screenshots\")===0){\n      this.childWebcamStream.current.downloadScreenshots();\n    }\n    else if(media.localeCompare(\"all\")===0){\n      this.childWebcamStream.current.downloadAll();\n    }\n  }\n\n  async setGalleryIndxShowing(newIndxShowing, indx, newPhoto, dir){\n    let auxArr =[];\n    let mapKeys = Array.from(this.gallerySrc.keys());\n    if((dir.localeCompare('prev') === 0 && this.state.GalleryIndexShowing[0] > mapKeys[0]) \n        || newPhoto || dir.localeCompare('reset') === 0 || dir.localeCompare('delete') === 0 ||\n        (dir.localeCompare('next') === 0 && this.state.GalleryIndexShowing[2] < mapKeys[mapKeys.length-1] && this.state.GalleryIndexShowing[2] !== 0 ) ){\n      auxArr[0] = this.state.GalleryIndexShowing[0];\n      auxArr[1] = this.state.GalleryIndexShowing[1];\n      auxArr[2] = this.state.GalleryIndexShowing[2];\n\n      for (let i=0;i < newIndxShowing.length; i++){\n        auxArr[indx[i]] = newIndxShowing[i];\n      }\n\n      if(dir){\n        this.childDiagnosis.current.galleryCtrl(dir, auxArr, this.gallerySrc, false, this.state.selectedGalleryPhoto);\n      }\n      \n      if(newPhoto){\n        this.setSelectedGalleryPhoto(newIndxShowing[newIndxShowing.length-1]);\n        if(this.state.GalleryIndexShowing[2] !== 0){\n          this.childDiagnosis.current.galleryCtrl('next', auxArr, this.gallerySrc, true);\n        }\n      }\n      if(dir.localeCompare('delete') === 0){\n        document.getElementById('img1').src = this.gallerySrc.get((auxArr[0]));\n        document.getElementById('img2').src = this.gallerySrc.get((auxArr[1]));\n        document.getElementById('img3').src = this.gallerySrc.get((auxArr[2]));\n      }\n      this.setState(\n        {GalleryIndexShowing: auxArr}\n      );\n    }\n  }\n      \n  setFullScreen(value){\n    this.setState({fullScreen: value});\n  }\n  setTabOn(value){\n    if(!this.state.hideSidePanel){\n  \t  let tabs = document.getElementsByClassName('tab');\n  \t  tabs[this.state.tabOn-1].style.backgroundColor = 'var(--main)';\n  \t  tabs[this.state.tabOn-1].style.color= 'white';\n  \t  tabs[this.state.tabOn-1].style.borderBottom = 'black';\n  \t  tabs[value-1].style.backgroundColor = 'white';\n  \t  tabs[value-1].style.color = 'var(--main)';\n  \t  tabs[value-1].style.borderBottom = 'none';\n      this.setState({tabOn: value},()=>{\n        if(value === 2){\n          document.getElementById('img1').src = this.gallerySrc.get((this.state.GalleryIndexShowing[0]));\n          document.getElementById('img2').src = this.gallerySrc.get((this.state.GalleryIndexShowing[1]));\n          document.getElementById('img3').src = this.gallerySrc.get((this.state.GalleryIndexShowing[2]));\n          if(this.state.stateName.localeCompare('Review') === 0){\n            //enable all download buttons\n            if(this.gallerySrc.size>0){\n              for(let i=0; i <3; i++){\n                document.getElementsByClassName('download')[i].style.color = \"white\";\n                document.getElementsByClassName('downloadLogo')[i].style.filter = \"invert(1)\";\n              }\n            }\n            //enable only video download\n            else{\n              document.getElementsByClassName('download')[2].style.color = \"white\";\n              document.getElementsByClassName('downloadLogo')[2].style.filter = \"invert(1)\";\n            }\n          }\n          //disable all downloads in any other state\n          else{\n            for(let i=0; i <3; i++){\n              document.getElementsByClassName('download')[i].style.color = \"rgba(0,0,0,0.3)\";\n              document.getElementsByClassName('downloadLogo')[i].style.filter = \"opacity(0.3)\";\n            }\n          }\n        }\n      });\n    }\n    else{\n      this.setState({tabOn: value});\n    }\n  }\n  setHideSidePanel(value){\n    this.setState({hideSidePanel: value},()=>{if (!value) this.setTabOn(this.state.tabOn)});\n  }\n  setIsVideoLoading(value){\n    this.setState({isVideoLoading: value});\n  }\n  setCountdownFrom(value){\n    this.countdownFrom = value;\n  }\n  setIsDiagnosisReady(value){\n    this.setState({isDiagnosisReady: value});\n  }\n  setSelectedGalleryPhoto(id){\n    this.setState({selectedGalleryPhoto: id});\n  }\n  async setScreenshots(data){\n    let newId =    this.state.GallerySrcLength+1;\n    await this.gallerySrc.set(newId, data);\n    this.setState(\n      {GallerySrcLength: this.state.GallerySrcLength +1 },\n      ()=>{this.childDiagnosis.current.setGallery2()}\n    );\n  }\n\n  layout(){\n    this.childWebcamStream.current.organizeScreen(this.childWebcamStream.current);\n  }\n\n  setPdfSrc(pdf){\n    this.pdfSrc = pdf;\n  }\n  setBlurAlertOn(){\n    this.setState({blurAlert: true});\n    let el = this;\n    this.blurTimeoutAlertOff = setTimeout(function(){\n      el.setBlurAlertOff();\n      }, alertTTL);\n  }\n  setBlurAlertOff(){\n    this.setState({blurAlert: false});\n    this.blurTimeoutAlertOff= null;\n  }\n  setDomAlertOn(){\n    this.setState({domAlert: true});\n    let el = this;\n    this.domTimeoutAlertOff = setTimeout(function(){\n      el.setDomAlertOff();\n      }, alertTTL);\n  }\n  setDomAlertOff(){\n    this.setState({domAlert: false});\n    this.domTimeoutAlertOff= null;\n  }\n  componentDidMount(){\n    this.childDiagnosis.current.listDevices();\n    document.addEventListener('fullscreenchange', (event => {\n      this.layout();\n    }));\n    document.addEventListener(\"webkitfullscreenchange\", (event => {\n      this.layout();\n    }));\n  }\n\n  render() {\n    return (\n\t\t\t<div id=\"container\">\n         <WebcamStream currentState={this.state} \n                       gallerySrc = {this.gallerySrc}\n                       canvasPreview={this.canvasPreview}\n                       stateHandler={(nextState)=>this.stateHandler(nextState)} \n                       countdownFrom={this.countdownFrom} \n                       ref={this.childWebcamStream}\n                       setScreenshots={(data)=>{this.setScreenshots(data)}}\n                       setFullScreen={(value)=>this.setFullScreen(value)}\n                       setTabOn={(value)=>this.setTabOn(value)}\n                       setHideSidePanel={(value)=>this.setHideSidePanel(value)}\n                       setIsDiagnosisReady ={(value)=>this.setIsDiagnosisReady(value)}\n                       setIsVideoLoading={(value)=>this.setIsVideoLoading(value)}\n                       setCountdownFrom={(value)=>this.setCountdownFrom(value)}\n                       setGallery={()=>this.setGallery()}\n                       setGalleryIndxShowing={(newIndxShowing, indx, newPhoto,dir)=>this.setGalleryIndxShowing(newIndxShowing,indx, newPhoto, dir)}\n                       hideSidePanel={()=>this.childDiagnosis.current.hideSidePanel()}\n                       sendViaSocket={(content)=>sendFile(content,this.socketConi,this.presignedURL,this)}\n                       getCon={()=>getCon(this)}\n                       closeCon={()=>closeCon(this)}\n                       pdfSrc={this.pdfSrc}\n                       setPdfSrc={()=>this.setPdfSrc()}\n                      \n\t\t\t\t />\n         <SidePanel    currentState={this.state}\n                       setStreamFromConfig={()=>{this.childWebcamStream.current.setStream();}}\n                       ref={this.childDiagnosis}\n                       downloadHandler={(media)=>this.downloadHandler(media)}\n                       setTabOn={(value)=>this.setTabOn(value)}\n                       setHideSidePanel={(value)=>this.setHideSidePanel(value)}\n                       mirror={(way)=>{this.childWebcamStream.current.mirror(way)}}\n                       setCountdownFrom={(value)=>this.setCountdownFrom(value)}\n                       countdownFrom={this.countdownFrom} \n                       setGalleryIndxShowing={(newIndxShowing, indx, newPhoto,dir)=>this.setGalleryIndxShowing(newIndxShowing,indx, newPhoto, dir)}\n                       gallerySrc = {this.gallerySrc}\n                       setSelectedGalleryPhoto = {(id) => this.setSelectedGalleryPhoto(id)}\n                      \n                       \n         />\n        <button onClick={()=>blurAlert(this)} style={{position: 'absolute', top: '50vw', left: '5vw'}}>B</button>\n        <button onClick={()=>domAlert(this)} style={{position: 'absolute', top: '50vw', left: '10vw'}}>D</button>\n    \n        <ReportTest/>\n\n      </div>\n\t\n      );\n        \n    }\n}\n\nfunction ReportTest(){\n  return(\n    <div id='ReportTest'>\n      <div id='r_logo'/>\n      <table>\n        <tbody>\n          <tr>\n            <td> Fecha: </td>\n            <td> fecha  </td>\n          </tr>\n          <tr>\n            <td> Código Paciente: </td>\n            <td> fecha  </td>\n          </tr>\n          <tr>\n            <td> Estudio: </td>\n            <td> fecha  </td>\n          </tr>\n          <tr>\n            <td> Médico Referente: </td>\n            <td> fecha  </td>\n          </tr>\n          \n        </tbody>\n      </table>\n      <div id='title'>\n        INFORME\n      </div>\n      <div id='results'>\n        <p>Resultados</p>\n        <img src={foto} alt=''/>\n        <img src={foto} alt=''/>\n        <img src={foto} alt=''/>\n      </div>\n      <div id='obs'>\n        <p>Observaciones</p>\n        <div id='obsBox'/>\n      </div>\n      <div id='diagnosis'>\n        <p>Diagnóstico Recomendado</p>\n        <div id='diagnosisBox'/>\n      </div>\n      <div id='info'/>\n    </div>\n  );\n}\nfunction closeCon(el){\n  console.log('Disconnecting...');\n  //el.socketCon.close();\n  el.childWebcamStream.current.resetSocketVars();\n}\n\nfunction getCon(el){\n  console.log('Connecting...');\n  el.socketCon = new WebSocket(ENDPOINT);\n\n  el.socketCon.onopen = function open() {\n      console.log('connected');\n      let fileNames = '\"p1.zip\"';\n      for(let i=2; i <= packetsSentLimit; i++){\n        fileNames+= ',\"'+zipName+i+'.zip\"';\n      }\n\t\t\tlet msg = '{\"action\":\"getURL\", \"fileName\":[' + fileNames + ']}';\n\t\t\tel.socketCon.send(msg);\n  };\n\tel.socketCon.onclose = function close() {\n\t  console.log('disconnected');\n\t};\n\t\n\tel.socketCon.onmessage = function incoming(data) {\n    console.log(JSON.parse(data.data));\n    let dataJSON = JSON.parse(data.data); \n\n    if(dataJSON.response){\n      console.log('Set presigned URLs');\n\t\t  el.presignedURL = dataJSON.response;\n    }\n    if(dataJSON.alert){\n      //may not work to check\n      //check format\n      if(dataJSON.alert[0].localeCompare('blur') === 0){\n        console.log('Blur');\n        blurAlert(el);\n      }\n      if(dataJSON.alert[0].localeCompare('dom') === 0){\n        console.log('Dom');\n        domAlert();\n          \n      }\n    }\n\t\t//el.socketCon.close();\n\t};\n}\nfunction sendFile(file,socketCon, presignedURL,el){\n  console.log('Sending...');\n\tvar xhr = new XMLHttpRequest();\n  xhr.open('PUT', presignedURL[el.indexURL], true);\n\txhr.onload = () => {\n    if (xhr.status === 200) {\n      console.log('Uploaded data successfully');\n    }\n  };\n  xhr.onerror = () => {\n    console.log('Nope')\n  };\n  xhr.send(file);  \n  el.indexURL++;\n}\n//function sleep(ms) {return new Promise(resolve => setTimeout(resolve, ms));}\nfunction blurAlert(el){\n  console.log('blur');\n  el.blurCnt++;\n  if(el.blurTimeoutAlertOn === null){\n    el.blurTimeoutAlertOn = setTimeout(function(){ \n      if(el.blurCnt > alertsLimit){\n        //not currently showing alert\n        if(el.blurTimeoutAlertOff === null){\n          el.setBlurAlertOn(); \n        }\n        else{\n          clearTimeout(el.blurTimeoutAlertOff);\n          el.blurTimeoutAlertOff = setTimeout(function(){\n            el.setBlurAlertOff()\n          }, alertTTL);\n        }\n      }\n      else{\n        el.blurTimeoutAlertOff = null;\n      }\n      el.blurCnt = 0;\n      el.blurTimeoutAlertOn = null;\n    }, alertWaitFor); \n  }\n}\n\nfunction domAlert(el){\n  console.log('dom');\n  el.domCnt++;\n  if(el.domTimeoutAlertOn === null){\n    el.domTimeoutAlertOn = setTimeout(function(){ \n      if(el.domCnt > alertsLimit){\n        //not currently showing alert\n        if(el.domTimeoutAlertOff === null){\n          el.setDomAlertOn(); \n        }\n        else{\n          clearTimeout(el.domTimeoutAlertOff);\n          el.domTimeoutAlertOff = setTimeout(function(){\n            el.setDomAlertOff()\n          }, alertTTL);\n        }\n      }\n      else{\n        el.domTimeoutAlertOff = null;\n      }\n      el.domCnt = 0;\n      el.domTimeoutAlertOn = null;\n    }, alertWaitFor); \n  }\n}\nexport default InferenceUI;\n"]},"metadata":{},"sourceType":"module"}