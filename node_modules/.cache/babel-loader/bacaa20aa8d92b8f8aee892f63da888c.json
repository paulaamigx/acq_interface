{"ast":null,"code":"var _jsxFileName = \"/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/WebcamStream/WebcamStream.js\";\nimport './WebcamStream.css';\nimport React from 'react'; //import {Alert} from 'reactstrap';\n\nimport \"@fortawesome/fontawesome-free/css/all.css\";\nimport JSZipUtils from 'jszip-utils';\nimport JSZip from 'jszip'; //import FileSaver from 'file-saver';\n\nimport { handleDataAvailable, ctrlBtnFunction, countdown, downloadScreenshots, downloadVideo, downloadAll, captureScreenshot, mirror, fullScreen, organizeScreen } from './functions.js';\nconst framesPerZip = 3;\nconst packetsSentLimit = 3; // Agregar variable para almacenar la hora en que se apretó el start.\n// Administrar el fullscreen desde acá ahora.\n\nclass WebcamStream extends React.Component {\n  constructor(props) {\n    super();\n    this.state = {};\n    this.videoTag = React.createRef();\n    this.tick = this.tick.bind(this);\n    this.timeStartPressed = null;\n    this.mediaRecorder = null;\n    this.recordedChunks = [];\n    this.videoRecorded = null;\n    this.mirrorScale = [1, 1];\n    this.mirrorTranslate = [0, 0];\n    this.canvasHeight = 0;\n    this.canvasWidth = 0; //Dummy mientras usamos setTimeout para pasar de gecon a exam\n\n    this.timeout = null;\n    this.timeout2 = null;\n    this.videoSrc = null;\n    this.changeFullScreenFrom = false;\n    this.framesArray = [];\n    this.socketCnt = 0;\n    this.zip = null;\n    this.packetsSent = 0;\n  }\n\n  setStream() {\n    console.log('sa');\n    var selectVideoSrc = document.getElementById(\"videoSelectConf\");\n\n    if (this.videoSrc) {\n      try {\n        selectVideoSrc.value = this.videoSrc;\n      } catch (e) {\n        console.log(e);\n      }\n    } // Falta cerrar el stream anterior antes de abrir uno nuevo.\n\n\n    navigator.mediaDevices.getUserMedia({\n      video: {\n        deviceId: selectVideoSrc ? {\n          exact: selectVideoSrc.value\n        } : undefined,\n        facingMode: \"enviroment\"\n      }\n    }).then(stream => {\n      this.videoTag.current.srcObject = stream;\n      requestAnimationFrame(this.tick);\n      window.stream = stream;\n      return navigator.mediaDevices.enumerateDevices();\n    }).then(gotDevices).catch(function (e) {\n      console.log('guardar esto');\n      console.log(e);\n    });\n  }\n\n  tick() {\n    const video = this.videoTag.current;\n    let countdownCurrent;\n    let countdownNext;\n    const checkVideoState = setInterval(() => {\n      if (video.readyState === video.HAVE_ENOUGH_DATA) {\n        clearInterval(checkVideoState);\n        this.props.setIsVideoLoading(false);\n        var canvasPreviewElement = this.props.canvasPreview.current;\n\n        if (canvasPreviewElement) {\n          var canvasPreview = canvasPreviewElement.getContext(\"2d\");\n          canvasPreviewElement.height = video.videoHeight;\n          canvasPreviewElement.width = video.videoWidth;\n          canvasPreview.translate(this.mirrorTranslate[0], this.mirrorTranslate[1]);\n          canvasPreview.scale(this.mirrorScale[0], this.mirrorScale[1]);\n\n          if (this.props.currentState.stateName.localeCompare(\"Countdown\") === 0) {\n            canvasPreview.filter = \"brightness(50%)\";\n          }\n\n          canvasPreview.drawImage(video, 0, 0, canvasPreviewElement.width, canvasPreviewElement.height);\n\n          if (this.props.currentState.stateName.localeCompare(\"Countdown\") === 0) {\n            countdown(canvasPreviewElement, this, countdownCurrent, countdownNext);\n          } //Send each frame to server\n          else if (this.props.currentState.stateName.localeCompare(\"Examination\") === 0) {\n              let frame = canvasPreviewElement.toDataURL(\"image/jpeg\", 0.5);\n\n              if (this.socketCnt < framesPerZip && this.socketCnt > 0) {\n                let name = 'f' + this.socketCnt + '.jpeg';\n                this.zip.file(name, urlToPromise(frame), {\n                  binary: true\n                });\n              } else if (this.socketCnt === framesPerZip) {\n                let el = this;\n                console.log('aca');\n                this.zip.generateAsync({\n                  type: \"blob\"\n                }).then(function (content) {\n                  console.log('zipfile');\n                  var zipFile = new File([content], \"test.zip\");\n                  sendto(zipFile, el);\n                });\n                this.packetsSent++;\n                if (this.packetsSent < packetsSentLimit) this.socketCnt = 0;\n              }\n\n              if (this.socketCnt === 0) {\n                this.zip = new JSZip();\n                this.zip.file('f0.jpeg', urlToPromise(frame), {\n                  binary: true\n                });\n              }\n\n              this.socketCnt++;\n            }\n\n          requestAnimationFrame(this.tick);\n        }\n      }\n    }, 50);\n  }\n\n  startRecording() {\n    var options = {\n      mimeType: \"video/webm;codecs=vp8\"\n    };\n    this.mediaRecorder = new MediaRecorder(this.props.canvasPreview.current.captureStream(), options);\n    this.mediaRecorder.ondataavailable = handleDataAvailable(this);\n    this.mediaRecorder.start();\n  }\n\n  stopRecording() {\n    this.mediaRecorder.stop();\n  }\n\n  downloadVideo() {\n    downloadVideo(this);\n  }\n\n  downloadAll() {\n    downloadAll(this);\n  }\n\n  captureScreenshot() {\n    captureScreenshot(this);\n  }\n\n  downloadScreenshots() {\n    downloadScreenshots(this);\n  }\n\n  mirror(way) {\n    mirror(this, way);\n  }\n\n  fullScreen() {\n    fullScreen(this);\n  }\n\n  organizeScreen() {\n    organizeScreen(this);\n  }\n\n  resetSocketVars() {\n    this.socketCnt = 0; //this.framesArray = [];\n  }\n\n  render() {\n    const isVideoLoading = this.props.currentState.isVideoLoading;\n    const colorScreenshotBtn = this.props.currentState.enableCaptureBtn ? \"white\" : \"grey\";\n\n    if (!isVideoLoading && !this.props.currentState.hideSidePanel && !this.props.currentState.fullScreen) {\n      let btns = document.getElementById(\"buttons\");\n\n      if (btns) {\n        btns.style.top = 50 * 3 / 4 + \"vw\";\n      }\n    }\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"WebcamStream_Wrapper\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"script\", {\n      src: \"adapter.js\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"video\", {\n      ref: this.videoTag,\n      autoPlay: true,\n      id: \"video\",\n      style: {\n        display: \"none\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 9\n      }\n    }), !isVideoLoading && /*#__PURE__*/React.createElement(\"div\", {\n      id: \"canvasDiv\",\n      className: \"canvasRendered\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 11\n      }\n    }, this.props.currentState.canvasAlert && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w_divAlert\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 15\n      }\n    }, \"Verifique\"), this.props.currentState.stateName.localeCompare(\"GetCon\") === 0 && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w_divAlert\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 15\n      }\n    }, \"Estableciendo conexi\\xF3n con el servidor.\"), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"alertsFromServer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 13\n      }\n    }, this.props.currentState.blurAlert && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w_divAlert\",\n      style: {\n        position: 'relative'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 18\n      }\n    }, \"Blurrrrrrrrrr\"), this.props.currentState.domAlert && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w_divAlert\",\n      style: {\n        position: 'relative'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 18\n      }\n    }, \"doooooooooooooom\")), this.props.currentState.renderCanvas && /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"canvas\", {\n      ref: this.props.canvasPreview,\n      id: \"canvasPreview\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 17\n      }\n    }), !this.props.currentState.hideSidePanel && !this.props.currentState.fullScreen && /*#__PURE__*/React.createElement(\"div\", {\n      id: \"div_hideSP\",\n      onClick: () => this.props.hideSidePanel(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 19\n      }\n    }, '>')), this.props.currentState.stateName.localeCompare(\"Countdown\") === 0 && /*#__PURE__*/React.createElement(\"canvas\", {\n      id: \"canvasCountdown\",\n      width: \"1000\",\n      height: \"750\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 15\n      }\n    }), this.props.currentState.renderCanvas && /*#__PURE__*/React.createElement(\"div\", {\n      id: \"buttons\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      id: \"screenshotBtn\",\n      onClick: () => {\n        if (this.props.currentState.enableCaptureBtn) {\n          this.captureScreenshot();\n        }\n      },\n      style: {\n        color: colorScreenshotBtn\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fas fa-camera\",\n      style: {\n        margin: \"0px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 25\n      }\n    })), this.props.currentState.enableCtrlBtn && /*#__PURE__*/React.createElement(\"div\", {\n      id: \"ctrlBtn\",\n      onClick: () => {\n        ctrlBtnFunction(this);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 19\n      }\n    }, this.props.currentState.textCtrlBtn), !this.props.currentState.enableCtrlBtn && /*#__PURE__*/React.createElement(\"div\", {\n      id: \"ctrlBtnDisabled\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 19\n      }\n    }, this.props.currentState.textCtrlBtn), /*#__PURE__*/React.createElement(\"span\", {\n      id: \"fullScreenBtn\",\n      onClick: () => fullScreen(this),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 17\n      }\n    }, !this.props.currentState.fullScreen && /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fas fa-expand\",\n      style: {\n        margin: \"0px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 27\n      }\n    }), this.props.currentState.fullScreen && /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fas fa-compress\",\n      style: {\n        margin: \"0px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 27\n      }\n    })))), isVideoLoading && /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 276,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"canvas\", {\n      id: \"canvasMessage\",\n      className: \"canvasRendered\",\n      width: \"1000\",\n      height: \"750\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 13\n      }\n    })), !this.props.currentState.renderCanvas && /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        width: '100%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"video\", {\n      id: \"recordedVideoElement\",\n      controls: true,\n      src: null,\n      className: \"canvasRendered\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"ctrlStartOver\",\n      onClick: () => {\n        ctrlBtnFunction(this);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 13\n      }\n    }, this.props.currentState.textCtrlBtn)));\n  }\n\n}\n\nfunction urlToPromise(url) {\n  return new Promise(function (resolve, reject) {\n    JSZipUtils.getBinaryContent(url, function (err, data) {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(data);\n      }\n    });\n  });\n}\n\nfunction sendto(content, el) {\n  el.props.sendViaSocket(content); //\tFileSaver.saveAs(content, \"download.zip\");\n}\n\nfunction gotDevices(deviceInfos) {\n  const videoSelect = document.getElementById(\"videoSelectConf\");\n  const selectors = [videoSelect]; // Handles being called several times to update labels. Preserve values.\n\n  const values = selectors.map(select => select.value);\n  selectors.forEach(select => {\n    while (select.firstChild) {\n      select.removeChild(select.firstChild);\n    }\n  });\n\n  for (let i = 0; i !== deviceInfos.length; ++i) {\n    const deviceInfo = deviceInfos[i];\n    const option = document.createElement('option');\n    option.value = deviceInfo.deviceId;\n\n    if (deviceInfo.kind === 'videoinput') {\n      option.text = deviceInfo.label || `camera ${videoSelect.length + 1}`;\n      videoSelect.appendChild(option);\n    }\n  }\n\n  selectors.forEach((select, selectorIndex) => {\n    if (Array.prototype.slice.call(select.childNodes).some(n => n.value === values[selectorIndex])) {\n      select.value = values[selectorIndex];\n    }\n  });\n}\n\nexport default WebcamStream;","map":{"version":3,"sources":["/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/WebcamStream/WebcamStream.js"],"names":["React","JSZipUtils","JSZip","handleDataAvailable","ctrlBtnFunction","countdown","downloadScreenshots","downloadVideo","downloadAll","captureScreenshot","mirror","fullScreen","organizeScreen","framesPerZip","packetsSentLimit","WebcamStream","Component","constructor","props","state","videoTag","createRef","tick","bind","timeStartPressed","mediaRecorder","recordedChunks","videoRecorded","mirrorScale","mirrorTranslate","canvasHeight","canvasWidth","timeout","timeout2","videoSrc","changeFullScreenFrom","framesArray","socketCnt","zip","packetsSent","setStream","console","log","selectVideoSrc","document","getElementById","value","e","navigator","mediaDevices","getUserMedia","video","deviceId","exact","undefined","facingMode","then","stream","current","srcObject","requestAnimationFrame","window","enumerateDevices","gotDevices","catch","countdownCurrent","countdownNext","checkVideoState","setInterval","readyState","HAVE_ENOUGH_DATA","clearInterval","setIsVideoLoading","canvasPreviewElement","canvasPreview","getContext","height","videoHeight","width","videoWidth","translate","scale","currentState","stateName","localeCompare","filter","drawImage","frame","toDataURL","name","file","urlToPromise","binary","el","generateAsync","type","content","zipFile","File","sendto","startRecording","options","mimeType","MediaRecorder","captureStream","ondataavailable","start","stopRecording","stop","way","resetSocketVars","render","isVideoLoading","colorScreenshotBtn","enableCaptureBtn","hideSidePanel","btns","style","top","display","canvasAlert","blurAlert","position","domAlert","renderCanvas","color","margin","enableCtrlBtn","textCtrlBtn","url","Promise","resolve","reject","getBinaryContent","err","data","sendViaSocket","deviceInfos","videoSelect","selectors","values","map","select","forEach","firstChild","removeChild","i","length","deviceInfo","option","createElement","kind","text","label","appendChild","selectorIndex","Array","prototype","slice","call","childNodes","some","n"],"mappings":"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","sourcesContent":["import './WebcamStream.css'\nimport React from 'react';\n//import {Alert} from 'reactstrap';\n\nimport \"@fortawesome/fontawesome-free/css/all.css\"\n\nimport JSZipUtils from 'jszip-utils';\nimport JSZip from 'jszip';\n//import FileSaver from 'file-saver';\nimport {handleDataAvailable, ctrlBtnFunction, countdown, \n        downloadScreenshots, downloadVideo, downloadAll, captureScreenshot, mirror,\n        fullScreen, organizeScreen} from './functions.js';\n        \nconst framesPerZip = 3;\nconst packetsSentLimit = 3;\n\n\n// Agregar variable para almacenar la hora en que se apretó el start.\n// Administrar el fullscreen desde acá ahora.\nclass WebcamStream extends React.Component {\n  constructor(props) {\n    super();\n    this.state = {\n    };\n\n    this.videoTag = React.createRef();\n    this.tick = this.tick.bind(this);\n\n    this.timeStartPressed = null;\n\n    this.mediaRecorder = null;\n    this.recordedChunks= [];\n\t  this.videoRecorded = null;\n\n    this.mirrorScale = [1,1];\n    this.mirrorTranslate = [0,0];\n\n    this.canvasHeight = 0;\n    this.canvasWidth = 0;\n    \n    //Dummy mientras usamos setTimeout para pasar de gecon a exam\n    this.timeout = null;\n    this.timeout2 = null;\n    this.videoSrc = null;\n    \n    this.changeFullScreenFrom = false;\n\n    this.framesArray = [];\n\t\tthis.socketCnt = 0;\n    this.zip = null;\n    this.packetsSent = 0;\n\n  }\n\n  setStream(){\n    console.log('sa');\n    var selectVideoSrc = document.getElementById(\"videoSelectConf\");\n    if(this.videoSrc){\n      try{\n        selectVideoSrc.value = this.videoSrc;\n        }\n      catch(e){console.log(e)}\n    }\n    \n    // Falta cerrar el stream anterior antes de abrir uno nuevo.\n    navigator.mediaDevices.getUserMedia({\n      video: {\n        deviceId: selectVideoSrc? {exact: selectVideoSrc.value}:undefined,\n        facingMode: \"enviroment\"\n      }\n    }).then(stream => {\n      this.videoTag.current.srcObject = stream;\n      requestAnimationFrame(this.tick);\n      window.stream = stream;\n      \n      return navigator.mediaDevices.enumerateDevices();\n    }).then(gotDevices)\n    .catch(function(e){\n        console.log('guardar esto');\n        console.log(e);\n    });\n  }\n\n  tick() {\n    const video = this.videoTag.current;\n    let countdownCurrent;\n    let countdownNext;\n    const checkVideoState = setInterval(() => {\n      if (video.readyState === video.HAVE_ENOUGH_DATA) {\n        clearInterval(checkVideoState);\n        this.props.setIsVideoLoading(false);\n        var canvasPreviewElement = this.props.canvasPreview.current;\n        if(canvasPreviewElement){\n          var canvasPreview = canvasPreviewElement.getContext(\"2d\");\n          canvasPreviewElement.height = video.videoHeight;\n          canvasPreviewElement.width = video.videoWidth;\n          canvasPreview.translate(this.mirrorTranslate[0],this.mirrorTranslate[1]);\n          canvasPreview.scale(this.mirrorScale[0],this.mirrorScale[1]);\n\n          if(this.props.currentState.stateName.localeCompare(\"Countdown\")===0){\n            canvasPreview.filter = \"brightness(50%)\";\n          }\n          canvasPreview.drawImage(\n              video,\n              0,\n              0,\n              canvasPreviewElement.width,\n              canvasPreviewElement.height\n          );\n          if(this.props.currentState.stateName.localeCompare(\"Countdown\")===0){\n            countdown(canvasPreviewElement,this,countdownCurrent, countdownNext);\n          }\n\n          //Send each frame to server\n          else if(this.props.currentState.stateName.localeCompare(\"Examination\") === 0){\n            let frame  = canvasPreviewElement.toDataURL(\"image/jpeg\",0.5);\n            if (this.socketCnt < framesPerZip && this.socketCnt >0){\n                let name = 'f'+this.socketCnt+'.jpeg';\n                this.zip.file(name, urlToPromise(frame),{binary:true});\n            }\n            else if(this.socketCnt === framesPerZip){\n\t\t\t\t\t  \tlet el = this;\n              console.log('aca');\n\t\t\t\t      this.zip.generateAsync({type: \"blob\"}).then(\n                function(content) {\n                  console.log('zipfile');\n                  var zipFile = new File([content], \"test.zip\");\n                  sendto(zipFile,el);\n                });\n              this.packetsSent++;\n              if(this.packetsSent < packetsSentLimit)\n                this.socketCnt = 0;\n            }\n            if(this.socketCnt === 0){\n              this.zip = new JSZip();\n              this.zip.file('f0.jpeg', urlToPromise(frame),{binary:true});\n            }\n            this.socketCnt++;\n          }\n          requestAnimationFrame(this.tick);\n        }\n      }\n    }, 50);\n  }\n  startRecording(){\n      var options = { mimeType: \"video/webm;codecs=vp8\" };\n      this.mediaRecorder = new MediaRecorder(this.props.canvasPreview.current.captureStream(), options);\n      this.mediaRecorder.ondataavailable = handleDataAvailable(this);\n      this.mediaRecorder.start();\n  }\n\n\tstopRecording(){\n    this.mediaRecorder.stop();\n\t}\n\n\tdownloadVideo(){\n\t\tdownloadVideo(this);\t\n\t}\n  downloadAll(){\n    downloadAll(this);\n  }\n  \n  captureScreenshot(){\n    captureScreenshot(this);\n    }\n\n  downloadScreenshots(){\n    downloadScreenshots(this);\n  }\n  \n  mirror(way){\n    mirror(this,way);\n  }\n  fullScreen(){\n    fullScreen(this);\n  }\n  organizeScreen(){\n    organizeScreen(this);\n  }\n  resetSocketVars(){\n    this.socketCnt = 0;\n    //this.framesArray = [];\n  }\n  render() {\n    const isVideoLoading = this.props.currentState.isVideoLoading;\n    const colorScreenshotBtn = (this.props.currentState.enableCaptureBtn)? \"white\" : \"grey\";\n\n    if(!isVideoLoading && !this.props.currentState.hideSidePanel && !this.props.currentState.fullScreen){\n      let btns= document.getElementById(\"buttons\");\n      if(btns){\n        btns.style.top = 50*3/4+\"vw\";}\n    }\n    return (\n      <div id=\"WebcamStream_Wrapper\">\n\n        <script src=\"adapter.js\"></script>\n\n        {/* Dummy video tag to recieve UserMedia stream.*/}\n        <video\n          ref={this.videoTag}\n          autoPlay\n          id = \"video\"\n          style={{ display: \"none\"}}\n        />\n\n        {!isVideoLoading &&\n          <div id=\"canvasDiv\" className=\"canvasRendered\">\n            {this.props.currentState.canvasAlert &&\n              <div className=\"w_divAlert\" >\n                Verifique\n              </div>\n            }\n\n           {this.props.currentState.stateName.localeCompare(\"GetCon\") === 0 &&\n              <div className=\"w_divAlert\" >\n                Estableciendo conexión con el servidor.\n              </div>\n            }\n            <div id='alertsFromServer'>\n              {this.props.currentState.blurAlert &&\n                 <div className=\"w_divAlert\" style={{position: 'relative' }}>\n                   Blurrrrrrrrrr\n                 </div>\n               }\n              {this.props.currentState.domAlert &&\n                 <div className=\"w_divAlert\" style={{position: 'relative'}}>\n                   doooooooooooooom\n                 </div>\n               }\n            </div>\n            \n            {this.props.currentState.renderCanvas &&\n              <div>\n                <canvas ref={this.props.canvasPreview}\n                        id=\"canvasPreview\"/>\n                {!this.props.currentState.hideSidePanel && !this.props.currentState.fullScreen &&\n                  <div id='div_hideSP' onClick={()=>this.props.hideSidePanel()}>{'>'}</div>\n                }\n              </div>\n\n            }\n            {(this.props.currentState.stateName.localeCompare(\"Countdown\") === 0) &&\n              <canvas id=\"canvasCountdown\" width=\"1000\" height=\"750\"/>\n            }\n            {this.props.currentState.renderCanvas &&\n\t\t\t\t      <div id=\"buttons\">\n                <span  id = \"screenshotBtn\"\n                       onClick={() => {if(this.props.currentState.enableCaptureBtn){this.captureScreenshot()}}}\n                       style={{color: colorScreenshotBtn}}>\n                        <i className=\"fas fa-camera\" style={{margin: \"0px\"}}></i>\n                </span>\n                {this.props.currentState.enableCtrlBtn &&\n                  <div id=\"ctrlBtn\"\n                       onClick={()=>{ctrlBtnFunction(this);}}>\n                       {this.props.currentState.textCtrlBtn}\n                  </div>\n                }\n                {!this.props.currentState.enableCtrlBtn &&\n                  <div id=\"ctrlBtnDisabled\">\n                       {this.props.currentState.textCtrlBtn}\n                  </div>\n                }\n                <span  id = \"fullScreenBtn\" \n                       onClick={()=>fullScreen(this)}>\n                       {!this.props.currentState.fullScreen &&\n                          <i className=\"fas fa-expand\" style={{margin: \"0px\"}}></i>}\n                       {this.props.currentState.fullScreen && \n                          <i className=\"fas fa-compress\" style={{margin: \"0px\"}}></i>}\n                </span>\n              </div>\n            }\n          </div>\n        }\n        \n        {isVideoLoading &&\n          <div>\n            <canvas id=\"canvasMessage\"\n                    className=\"canvasRendered\" width=\"1000\" height=\"750\"/>\n          </div>\n        }\n        {!this.props.currentState.renderCanvas &&\n          <div style={{width: '100%'}}>\n            <video id = \"recordedVideoElement\"\n                   controls\n                   src={null}\n                   className=\"canvasRendered\"/>\n            <div id= \"ctrlStartOver\" \n                    onClick={()=>{ctrlBtnFunction(this);}}\n                    >\n                    {this.props.currentState.textCtrlBtn}\n                    </div>\n          </div>\n        }\n      </div>\n    );\n  }\n}\nfunction urlToPromise(url) {\n    return new Promise(function(resolve, reject) {\n      JSZipUtils.getBinaryContent(url, function (err, data) {\n        if(err) {\n          reject(err);\n        }\n        else {\n          resolve(data);\n        }\n      });\n    });\n  }\n\nfunction sendto(content,el){\n\tel.props.sendViaSocket(content);\n//\tFileSaver.saveAs(content, \"download.zip\");\n}\nfunction gotDevices(deviceInfos) {\n  const videoSelect = document.getElementById(\"videoSelectConf\");\n  const selectors = [videoSelect];\n  // Handles being called several times to update labels. Preserve values.\n  const values = selectors.map(select => select.value);\n  selectors.forEach(select => {\n    while (select.firstChild) {\n      select.removeChild(select.firstChild);\n    }\n  });\n  for (let i = 0; i !== deviceInfos.length; ++i) {\n    const deviceInfo = deviceInfos[i];\n    const option = document.createElement('option');\n    option.value = deviceInfo.deviceId;\n    if (deviceInfo.kind === 'videoinput') {\n      option.text = deviceInfo.label || `camera ${videoSelect.length + 1}`;\n      videoSelect.appendChild(option);\n    }   \n  }\n  selectors.forEach((select, selectorIndex) => {\n    if (Array.prototype.slice.call(select.childNodes).some(n => n.value === values[selectorIndex])) {\n      select.value = values[selectorIndex];\n    }\n  });\n}\nexport default WebcamStream;\n"]},"metadata":{},"sourceType":"module"}