{"ast":null,"code":"var _jsxFileName = \"/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/InferenceUI.js\";\nimport './InferenceUI.css';\nimport React from 'react';\nimport WebcamStream from './WebcamStream/WebcamStream.js';\nimport SidePanel from './SidePanel/SidePanel.js';\nimport { manageStates } from './functions.js';\nimport { useState, useEffect } from \"react\";\nimport socketIOClient from \"socket.io-client\";\nconst ENDPOINT = \"http://127.0.0.1:4000\";\n\nclass InferenceUI extends React.Component {\n  constructor(props) {\n    super();\n    this.state = {\n      stateName: \"Idle\",\n      // Render canvas or video\n      renderCanvas: true,\n      // Canvas Message\n      canvasMessage: \"\",\n      canvasAlert: false,\n      // Progress Bar props\n      showProgressBar: false,\n      progress: 0,\n      // Show Spinner\n      showSpinner: false,\n      // Button state\n      textCtrlBtn: \"Empezar\",\n      enableCtrlBtn: true,\n      enableCaptureBtn: false,\n      // Side Panel\n      enableReportTab: false,\n      enableDiagnosisTab: false,\n      enableConfigTab: true,\n      enableGalleryTab: false,\n      GallerySrcLength: 0,\n      GalleryIndexShowing: [0, 0, 0],\n      selectedGalleryPhoto: 0,\n      isVideoLoading: true,\n      hideSidePanel: false,\n      tabOn: 1,\n      fullScreen: false,\n      isDiagnosisReady: false\n    };\n    this.gallerySrc = new Map();\n    this.childWebcamStream = React.createRef();\n    this.childDiagnosis = React.createRef();\n    this.countdownFrom = 5;\n    this.alertTimeout = null;\n    this.videoThumbnail = null;\n    this.canvasPreview = React.createRef();\n  } // En caso de que venga de review y vaya a idle, limpiar las variables.\n\n\n  async stateHandler(nextState) {\n    await this.setState({\n      stateName: nextState\n    });\n    console.log(\"Estado: \" + this.state.stateName);\n\n    if (nextState.localeCompare('Idle') === 0) {\n      this.setState(manageStates(nextState), async () => {\n        this.childDiagnosis.current.listDevices();\n        var selectObj = document.getElementById(\"videoSelectConf\");\n\n        for (var i = 0; i < selectObj.options.length; i++) {\n          if (!selectObj.options[i].text.localeCompare(this.childWebcamStream.current.videoSrc)) {\n            selectObj.options[i].selected = true;\n            break;\n          }\n        }\n\n        document.getElementById(\"countdownFromInput\").value = \"1\";\n      });\n    } else {\n      this.setState(manageStates(nextState));\n    }\n  }\n\n  downloadHandler(media) {\n    if (media.localeCompare(\"video\") === 0) {\n      this.childWebcamStream.current.downloadVideo();\n    } else if (media.localeCompare(\"screenshots\") === 0) {\n      this.childWebcamStream.current.downloadScreenshots();\n    } else if (media.localeCompare(\"all\") === 0) {\n      this.childWebcamStream.current.downloadAll();\n    }\n  }\n\n  async setGalleryIndxShowing(newIndxShowing, indx, newPhoto, dir) {\n    let auxArr = [];\n    let mapKeys = Array.from(this.gallerySrc.keys());\n\n    if (dir.localeCompare('prev') === 0 && this.state.GalleryIndexShowing[0] > mapKeys[0] || newPhoto || dir.localeCompare('reset') === 0 || dir.localeCompare('delete') === 0 || dir.localeCompare('next') === 0 && this.state.GalleryIndexShowing[2] < mapKeys[mapKeys.length - 1] && this.state.GalleryIndexShowing[2] !== 0) {\n      auxArr[0] = this.state.GalleryIndexShowing[0];\n      auxArr[1] = this.state.GalleryIndexShowing[1];\n      auxArr[2] = this.state.GalleryIndexShowing[2];\n\n      for (let i = 0; i < newIndxShowing.length; i++) {\n        auxArr[indx[i]] = newIndxShowing[i];\n      }\n\n      if (dir) {\n        this.childDiagnosis.current.galleryCtrl(dir, auxArr, this.gallerySrc, false, this.state.selectedGalleryPhoto);\n      }\n\n      if (newPhoto) {\n        this.setSelectedGalleryPhoto(newIndxShowing[newIndxShowing.length - 1]);\n\n        if (this.state.GalleryIndexShowing[2] !== 0) {\n          this.childDiagnosis.current.galleryCtrl('next', auxArr, this.gallerySrc, true);\n        }\n      }\n\n      if (dir.localeCompare('delete') === 0) {\n        document.getElementById('img1').src = this.gallerySrc.get(auxArr[0]);\n        document.getElementById('img2').src = this.gallerySrc.get(auxArr[1]);\n        document.getElementById('img3').src = this.gallerySrc.get(auxArr[2]);\n      }\n\n      this.setState({\n        GalleryIndexShowing: auxArr\n      });\n    }\n  }\n\n  setFullScreen(value) {\n    this.setState({\n      fullScreen: value\n    });\n  }\n\n  setTabOn(value) {\n    let tabs = document.getElementsByClassName('tab');\n    tabs[this.state.tabOn - 1].style.backgroundColor = 'var(--main)';\n    tabs[value - 1].style.backgroundColor = 'white';\n    tabs[this.state.tabOn - 1].style.color = 'white';\n    tabs[value - 1].style.color = 'var(--main)';\n    this.setState({\n      tabOn: value\n    });\n    console.log('sto');\n    console.log(value); //    ,()=>{    });\n  }\n\n  setHideSidePanel(value) {\n    this.setState({\n      hideSidePanel: value\n    });\n  }\n\n  setIsVideoLoading(value) {\n    this.setState({\n      isVideoLoading: value\n    });\n  }\n\n  setCountdownFrom(value) {\n    this.countdownFrom = value;\n  }\n\n  setIsDiagnosisReady(value) {\n    this.setState({\n      isDiagnosisReady: value\n    });\n  }\n\n  setSelectedGalleryPhoto(id) {\n    this.setState({\n      selectedGalleryPhoto: id\n    });\n    console.log('selected');\n    console.log(id);\n  }\n\n  async setScreenshots(data) {\n    let newId = this.state.GallerySrcLength + 1;\n    await this.gallerySrc.set(newId, data);\n    this.setState({\n      GallerySrcLength: this.state.GallerySrcLength + 1\n    }, () => {\n      this.childDiagnosis.current.setGallery2();\n    });\n  }\n\n  componentDidMount() {\n    this.childDiagnosis.current.listDevices();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(WebcamStream, {\n      currentState: this.state,\n      gallerySrc: this.gallerySrc,\n      canvasPreview: this.canvasPreview,\n      stateHandler: nextState => this.stateHandler(nextState),\n      countdownFrom: this.countdownFrom,\n      ref: this.childWebcamStream,\n      setScreenshots: data => {\n        this.setScreenshots(data);\n      },\n      setFullScreen: value => this.setFullScreen(value),\n      setTabOn: value => this.setTabOn(value),\n      setHideSidePanel: value => this.setHideSidePanel(value),\n      setIsDiagnosisReady: value => this.setIsDiagnosisReady(value),\n      setIsVideoLoading: value => this.setIsVideoLoading(value),\n      setCountdownFrom: value => this.setCountdownFrom(value),\n      placeProgressBar: flag => placeProgressBar(flag),\n      setGallery: () => this.setGallery(),\n      setGalleryIndxShowing: (newIndxShowing, indx, newPhoto, dir) => this.setGalleryIndxShowing(newIndxShowing, indx, newPhoto, dir),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 10\n      }\n    }), /*#__PURE__*/React.createElement(SidePanel, {\n      currentState: this.state,\n      setStreamFromConfig: () => {\n        this.childWebcamStream.current.setStream();\n      },\n      ref: this.childDiagnosis,\n      downloadHandler: media => this.downloadHandler(media),\n      setTabOn: value => this.setTabOn(value),\n      setHideSidePanel: value => this.setHideSidePanel(value),\n      mirror: way => {\n        this.childWebcamStream.current.mirror(way);\n      },\n      setCountdownFrom: value => this.setCountdownFrom(value),\n      countdownFrom: this.countdownFrom,\n      placeProgressBar: flag => placeProgressBar(flag),\n      setGalleryIndxShowing: (newIndxShowing, indx, newPhoto, dir) => this.setGalleryIndxShowing(newIndxShowing, indx, newPhoto, dir),\n      gallerySrc: this.gallerySrc,\n      setSelectedGalleryPhoto: id => this.setSelectedGalleryPhoto(id),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 10\n      }\n    }));\n  }\n\n}\n/*\nfunction Sockett() {\n  const [response, setResponse] = useState(\"\");\n\n  useEffect(() => {\n    const socket = socketIOClient(ENDPOINT);\n    socket.on(\"FromAPI\", data => {\n      setResponse(data);\n      console.log('aka');\n    });\n    socket.on(\"blur\", () => {\n      console.log('aka');\n    });\n    socket.on('connection', ()=>{\n      console.log('aka');\n        \n    });\n  }, []);\n\n  return (\n    <p style={{position: 'absolute', top: '50vw'}}>\n      It's <time dateTime={response}>{response}</time>\n    </p>\n  );\n}\n*/\n\n\nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nfunction placeProgressBar(flag) {\n  let progress = document.getElementById(\"progressBar\");\n  let canvas = document.getElementById(\"canvasPreview\");\n  let btns = document.getElementById(\"buttons\");\n\n  if (progress) {\n    progress.style.width = canvas.clientWidth * 100 / window.innerWidth + \"vw\";\n\n    if (flag.localeCompare(\"btnsOnCanvas\") === 0) {\n      progress.style.top = canvas.clientHeight * 100 / window.innerHeight + \"vh\";\n      btns.style.top = (canvas.clientHeight - btns.clientHeight) * 100 / window.innerHeight + \"vh\";\n      progress.style.marginLeft = (100 - canvas.clientWidth * 100 / window.innerWidth) / 2 + \"vw\";\n    } else if (flag.localeCompare(\"btnsBelowCanvas\") === 0) {\n      btns.style.top = canvas.clientHeight * 100 / window.innerHeight + \"vh\";\n      progress.style.marginLeft = \"2.5vw\";\n      progress.style.top = (canvas.clientHeight + btns.clientHeight) * 100 / window.innerHeight + \"vh\";\n    } else if (flag.localeCompare(\"btnsFS\") === 0) {\n      progress.style.width = canvas.clientWidth * 100 / window.innerWidth + \"vw\";\n      btns.style.top = (canvas.clientHeight - btns.clientHeight) * 100 / window.innerHeight + \"vh\";\n      progress.style.marginLeft = \"12%\";\n      progress.style.top = \"98vh\";\n    }\n  }\n}\n\nexport default InferenceUI;","map":{"version":3,"sources":["/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/InferenceUI.js"],"names":["React","WebcamStream","SidePanel","manageStates","useState","useEffect","socketIOClient","ENDPOINT","InferenceUI","Component","constructor","props","state","stateName","renderCanvas","canvasMessage","canvasAlert","showProgressBar","progress","showSpinner","textCtrlBtn","enableCtrlBtn","enableCaptureBtn","enableReportTab","enableDiagnosisTab","enableConfigTab","enableGalleryTab","GallerySrcLength","GalleryIndexShowing","selectedGalleryPhoto","isVideoLoading","hideSidePanel","tabOn","fullScreen","isDiagnosisReady","gallerySrc","Map","childWebcamStream","createRef","childDiagnosis","countdownFrom","alertTimeout","videoThumbnail","canvasPreview","stateHandler","nextState","setState","console","log","localeCompare","current","listDevices","selectObj","document","getElementById","i","options","length","text","videoSrc","selected","value","downloadHandler","media","downloadVideo","downloadScreenshots","downloadAll","setGalleryIndxShowing","newIndxShowing","indx","newPhoto","dir","auxArr","mapKeys","Array","from","keys","galleryCtrl","setSelectedGalleryPhoto","src","get","setFullScreen","setTabOn","tabs","getElementsByClassName","style","backgroundColor","color","setHideSidePanel","setIsVideoLoading","setCountdownFrom","setIsDiagnosisReady","id","setScreenshots","data","newId","set","setGallery2","componentDidMount","render","flag","placeProgressBar","setGallery","setStream","way","mirror","sleep","ms","Promise","resolve","setTimeout","canvas","btns","width","clientWidth","window","innerWidth","top","clientHeight","innerHeight","marginLeft"],"mappings":"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","sourcesContent":["import './InferenceUI.css';\nimport React from 'react';\nimport WebcamStream from './WebcamStream/WebcamStream.js'\nimport SidePanel from './SidePanel/SidePanel.js'\nimport {manageStates} from './functions.js'\n\nimport { useState, useEffect } from \"react\";\nimport socketIOClient from \"socket.io-client\";\nconst ENDPOINT = \"http://127.0.0.1:4000\";\nclass InferenceUI extends React.Component {\n  \n  constructor(props){\n    super();\n    this.state = {\n      stateName: \"Idle\",\n\n      // Render canvas or video\n      renderCanvas: true,\n      // Canvas Message\n      canvasMessage: \"\",\n      canvasAlert: false,\n\n      // Progress Bar props\n      showProgressBar: false,\n      progress: 0,\n      // Show Spinner\n      showSpinner: false,\n      // Button state\n      textCtrlBtn: \"Empezar\",\n      enableCtrlBtn: true,\n      enableCaptureBtn: false,\n\n      // Side Panel\n      enableReportTab: false,\n      enableDiagnosisTab: false,\n      enableConfigTab: true,\n      enableGalleryTab: false,\n      GallerySrcLength: 0,\n      GalleryIndexShowing: [0,0,0],\n      selectedGalleryPhoto: 0,\n      isVideoLoading: true,\n      hideSidePanel: false,\n\n      tabOn: 1,\n      fullScreen: false,\n\n      isDiagnosisReady: false\n    }\n    this.gallerySrc = new Map();\n    this.childWebcamStream = React.createRef();\n    this.childDiagnosis = React.createRef();\n    this.countdownFrom = 5;\n    this.alertTimeout = null;\n    this.videoThumbnail = null;\n    this.canvasPreview = React.createRef();\n  }\n\n  // En caso de que venga de review y vaya a idle, limpiar las variables.\n  async stateHandler(nextState){\n    await this.setState({stateName: nextState});\n    console.log(\"Estado: \" + this.state.stateName);\n    if(nextState.localeCompare('Idle') === 0){\n    this.setState(manageStates(nextState) \n    ,async()=>{\n      \n\t\t\tthis.childDiagnosis.current.listDevices();\n      var selectObj = document.getElementById(\"videoSelectConf\");\n\t\t\tfor (var i = 0; i < selectObj.options.length; i++) {\n        if (!selectObj.options[i].text.localeCompare(this.childWebcamStream.current.videoSrc)) {\n            selectObj.options[i].selected = true;\n            break;\n        }\n   \t\t }\n      document.getElementById(\"countdownFromInput\").value=\"1\";\n\n\n    });\n    }\n    else{\n      this.setState(manageStates(nextState));\n    }\n  \n  }\n  \n  downloadHandler(media){\n    if(media.localeCompare(\"video\")===0){\n      this.childWebcamStream.current.downloadVideo();\n    }\n    else if(media.localeCompare(\"screenshots\")===0){\n      this.childWebcamStream.current.downloadScreenshots();\n    }\n    else if(media.localeCompare(\"all\")===0){\n      this.childWebcamStream.current.downloadAll();\n    }\n  }\n\n  async setGalleryIndxShowing(newIndxShowing, indx, newPhoto, dir){\n    let auxArr =[];\n    let mapKeys = Array.from(this.gallerySrc.keys());\n    if((dir.localeCompare('prev') === 0 && this.state.GalleryIndexShowing[0] > mapKeys[0]) \n        || newPhoto || dir.localeCompare('reset') === 0 || dir.localeCompare('delete') === 0 ||\n        (dir.localeCompare('next') === 0 && this.state.GalleryIndexShowing[2] < mapKeys[mapKeys.length-1] && this.state.GalleryIndexShowing[2] !== 0 ) ){\n      auxArr[0] = this.state.GalleryIndexShowing[0];\n      auxArr[1] = this.state.GalleryIndexShowing[1];\n      auxArr[2] = this.state.GalleryIndexShowing[2];\n\n      for (let i=0;i < newIndxShowing.length; i++){\n        auxArr[indx[i]] = newIndxShowing[i];\n      }\n\n      if(dir){\n        this.childDiagnosis.current.galleryCtrl(dir, auxArr, this.gallerySrc, false, this.state.selectedGalleryPhoto);\n      }\n      \n      if(newPhoto){\n        this.setSelectedGalleryPhoto(newIndxShowing[newIndxShowing.length-1]);\n        if(this.state.GalleryIndexShowing[2] !== 0){\n          this.childDiagnosis.current.galleryCtrl('next', auxArr, this.gallerySrc, true);\n        }\n      }\n      if(dir.localeCompare('delete') === 0){\n        document.getElementById('img1').src = this.gallerySrc.get((auxArr[0]));\n        document.getElementById('img2').src = this.gallerySrc.get((auxArr[1]));\n        document.getElementById('img3').src = this.gallerySrc.get((auxArr[2]));\n      }\n      this.setState(\n        {GalleryIndexShowing: auxArr}\n      );\n    }\n  }\n  \n      \n  setFullScreen(value){\n    this.setState({fullScreen: value});\n  }\n  setTabOn(value){\n  let tabs = document.getElementsByClassName('tab');\n  tabs[this.state.tabOn-1].style.backgroundColor = 'var(--main)';\n  tabs[value-1].style.backgroundColor = 'white';\n  tabs[this.state.tabOn-1].style.color= 'white';\n  tabs[value-1].style.color = 'var(--main)';\n    this.setState({tabOn: value});\n    console.log('sto');\n    console.log(value);\n\n//    ,()=>{    });\n  }\n  setHideSidePanel(value){\n    this.setState({hideSidePanel: value});\n  }\n  setIsVideoLoading(value){\n    this.setState({isVideoLoading: value});\n  }\n  setCountdownFrom(value){\n    this.countdownFrom = value;\n  }\n  setIsDiagnosisReady(value){\n    this.setState({isDiagnosisReady: value});\n  }\n  setSelectedGalleryPhoto(id){\n    this.setState({selectedGalleryPhoto: id});\n    console.log('selected');\n    console.log(id);\n  }\n  async setScreenshots(data){\n    let newId =    this.state.GallerySrcLength+1;\n    await this.gallerySrc.set(newId, data);\n    this.setState(\n      {GallerySrcLength: this.state.GallerySrcLength +1 },\n      ()=>{this.childDiagnosis.current.setGallery2()}\n    );\n  }\n\n  componentDidMount(){\n    this.childDiagnosis.current.listDevices();\n  }\n\n  render() {\n    return (\n\t\t\t<div id=\"container\">\n         <WebcamStream currentState={this.state} \n                       gallerySrc = {this.gallerySrc}\n                       canvasPreview={this.canvasPreview}\n                       stateHandler={(nextState)=>this.stateHandler(nextState)} \n                       countdownFrom={this.countdownFrom} \n                       ref={this.childWebcamStream}\n                       setScreenshots={(data)=>{this.setScreenshots(data)}}\n                       setFullScreen={(value)=>this.setFullScreen(value)}\n                       setTabOn={(value)=>this.setTabOn(value)}\n                       setHideSidePanel={(value)=>this.setHideSidePanel(value)}\n                       setIsDiagnosisReady ={(value)=>this.setIsDiagnosisReady(value)}\n                       setIsVideoLoading={(value)=>this.setIsVideoLoading(value)}\n                       setCountdownFrom={(value)=>this.setCountdownFrom(value)}\n\t\t\t\t \t\t\t\t\t\t\t placeProgressBar={(flag)=>placeProgressBar(flag)}\n                       setGallery={()=>this.setGallery()}\n                       setGalleryIndxShowing={(newIndxShowing, indx, newPhoto,dir)=>this.setGalleryIndxShowing(newIndxShowing,indx, newPhoto, dir)}\n                      \n\t\t\t\t />\n         <SidePanel    currentState={this.state}\n                       setStreamFromConfig={()=>{this.childWebcamStream.current.setStream();}}\n                       ref={this.childDiagnosis}\n                       downloadHandler={(media)=>this.downloadHandler(media)}\n                       setTabOn={(value)=>this.setTabOn(value)}\n                       setHideSidePanel={(value)=>this.setHideSidePanel(value)}\n                       mirror={(way)=>{this.childWebcamStream.current.mirror(way)}}\n                       setCountdownFrom={(value)=>this.setCountdownFrom(value)}\n                       countdownFrom={this.countdownFrom} \n\t\t\t\t \t\t\t\t\t\t   placeProgressBar={(flag)=>placeProgressBar(flag)}\n                       setGalleryIndxShowing={(newIndxShowing, indx, newPhoto,dir)=>this.setGalleryIndxShowing(newIndxShowing,indx, newPhoto, dir)}\n                       gallerySrc = {this.gallerySrc}\n                       setSelectedGalleryPhoto = {(id) => this.setSelectedGalleryPhoto(id)}\n                      \n                       \n         />\n\n      </div>\n\t\n      );\n        \n    }\n}\n/*\nfunction Sockett() {\n  const [response, setResponse] = useState(\"\");\n\n  useEffect(() => {\n    const socket = socketIOClient(ENDPOINT);\n    socket.on(\"FromAPI\", data => {\n      setResponse(data);\n      console.log('aka');\n    });\n    socket.on(\"blur\", () => {\n      console.log('aka');\n    });\n    socket.on('connection', ()=>{\n      console.log('aka');\n        \n    });\n  }, []);\n\n  return (\n    <p style={{position: 'absolute', top: '50vw'}}>\n      It's <time dateTime={response}>{response}</time>\n    </p>\n  );\n}\n*/\nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nfunction placeProgressBar(flag){\n  let progress = document.getElementById(\"progressBar\")\n  let canvas = document.getElementById(\"canvasPreview\");\n  let btns = document.getElementById(\"buttons\");\n  if(progress){\n    progress.style.width = canvas.clientWidth*100/window.innerWidth+\"vw\";\n\t\tif(flag.localeCompare(\"btnsOnCanvas\")===0){\n    \tprogress.style.top = (canvas.clientHeight)*100/window.innerHeight + \"vh\";\n    \tbtns.style.top = (canvas.clientHeight - btns.clientHeight)*100/window.innerHeight + \"vh\";\n    \tprogress.style.marginLeft = (100-(canvas.clientWidth*100/window.innerWidth))/2 + \"vw\";\n\t\t}\n\t\telse if(flag.localeCompare(\"btnsBelowCanvas\")===0){\n    \tbtns.style.top = (canvas.clientHeight)*100/window.innerHeight + \"vh\";\n    \tprogress.style.marginLeft = \"2.5vw\";\n    \tprogress.style.top = (canvas.clientHeight+btns.clientHeight)*100/window.innerHeight + \"vh\";\n\t\t}\n\t\telse if(flag.localeCompare(\"btnsFS\")===0){\n      progress.style.width = canvas.clientWidth*100/window.innerWidth+\"vw\";\n    \tbtns.style.top = (canvas.clientHeight-btns.clientHeight)*100/window.innerHeight + \"vh\";\n    \tprogress.style.marginLeft = \"12%\";\n    \tprogress.style.top =  \"98vh\";\n\t\t}\n  }\n}\n\nexport default InferenceUI;\n"]},"metadata":{},"sourceType":"module"}