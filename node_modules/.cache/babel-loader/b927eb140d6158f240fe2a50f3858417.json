{"ast":null,"code":"var _jsxFileName = \"/home/paula/Documentos/Simbiotica/git/acq_interface/src/components/InferenceUI/InferenceUI.js\";\nimport './InferenceUI.css';\nimport React from 'react';\nimport WebcamStream from './WebcamStream/WebcamStream.js';\nimport SidePanel from './SidePanel/SidePanel.js';\nimport { manageStates } from './functions.js';\n\nclass InferenceUI extends React.Component {\n  constructor(props) {\n    super();\n    this.state = {\n      stateName: \"Idle\",\n      // Render canvas or video\n      renderCanvas: true,\n      // Button state\n      textCtrlBtn: \"Empezar\",\n      enableCtrlBtn: true,\n      enableCaptureBtn: false,\n      // Side Panel\n      tabsEnabled: [1, 0, 0, 0],\n      //conf, results, diagnosis, report\n      GallerySrcLength: 0,\n      GalleryIndexShowing: [0, 0, 0],\n      selectedGalleryPhoto: 0,\n      isVideoLoading: true,\n      hideSidePanel: false,\n      tabOn: 1,\n      fullScreen: false,\n      isDiagnosisReady: false\n    };\n    this.gallerySrc = new Map();\n    this.childWebcamStream = React.createRef();\n    this.childDiagnosis = React.createRef();\n    this.countdownFrom = 5;\n    this.canvasPreview = React.createRef();\n    this.acqInfo = [];\n    this.setAcqInfo = this.setAcqInfo.bind(this);\n  } // En caso de que venga de review y vaya a idle, limpiar las variables.\n\n\n  async stateHandler(nextState) {\n    await this.setState({\n      stateName: nextState\n    });\n    console.log(\"Estado: \" + this.state.stateName);\n\n    if (nextState.localeCompare('Idle') === 0 && this.state.tabOn === 2) {\n      this.setState(manageStates(nextState), async () => {\n        this.childDiagnosis.current.listDevices();\n        var selectObj = document.getElementById(\"videoSelectConf\");\n\n        for (var i = 0; i < selectObj.options.length; i++) {\n          if (!selectObj.options[i].text.localeCompare(this.childWebcamStream.current.videoSrc)) {\n            selectObj.options[i].selected = true;\n            break;\n          }\n        }\n\n        document.getElementById(\"countdownFromInput\").value = this.countdownFrom;\n      });\n    } else {\n      await this.setState(manageStates(nextState));\n\n      if (nextState.localeCompare('Countdown') === 0 && this.state.fullScreen) {\n        let cnvs = document.getElementById('canvasCountdown');\n        if (cnvs) cnvs.style.marginLeft = '12%';\n      }\n    }\n\n    if (!this.state.hideSidePanel) {\n      setTabsColor(this.state.tabsEnabled, this.state.tabOn);\n    }\n  }\n\n  async setGalleryIndxShowing(newIndxShowing, indx, newPhoto, dir) {\n    let auxArr = [];\n    let mapKeys = Array.from(this.gallerySrc.keys());\n\n    if (dir.localeCompare('prev') === 0 && this.state.GalleryIndexShowing[0] > mapKeys[0] || newPhoto || dir.localeCompare('reset') === 0 || dir.localeCompare('delete') === 0 || dir.localeCompare('next') === 0 && this.state.GalleryIndexShowing[2] < mapKeys[mapKeys.length - 1] && this.state.GalleryIndexShowing[2] !== 0) {\n      auxArr[0] = this.state.GalleryIndexShowing[0];\n      auxArr[1] = this.state.GalleryIndexShowing[1];\n      auxArr[2] = this.state.GalleryIndexShowing[2];\n\n      for (let i = 0; i < newIndxShowing.length; i++) {\n        auxArr[indx[i]] = newIndxShowing[i];\n      }\n\n      if (dir) {\n        this.childDiagnosis.current.galleryCtrl(dir, auxArr, this.gallerySrc, false, this.state.selectedGalleryPhoto);\n      }\n\n      if (newPhoto) {\n        this.setSelectedGalleryPhoto(newIndxShowing[newIndxShowing.length - 1]);\n\n        if (this.state.GalleryIndexShowing[2] !== 0) {\n          this.childDiagnosis.current.galleryCtrl('next', auxArr, this.gallerySrc, true);\n        }\n      }\n\n      if (dir.localeCompare('delete') === 0) {\n        document.getElementById('img1').src = this.gallerySrc.get(auxArr[0]);\n        document.getElementById('img2').src = this.gallerySrc.get(auxArr[1]);\n        document.getElementById('img3').src = this.gallerySrc.get(auxArr[2]);\n      }\n\n      this.setState({\n        GalleryIndexShowing: auxArr\n      });\n    }\n  }\n\n  setFullScreen(value) {\n    this.setState({\n      fullScreen: value\n    });\n  }\n\n  setTabOn(value) {\n    if (!this.state.hideSidePanel) {\n      let tabs = document.getElementsByClassName('tab');\n      tabs[this.state.tabOn - 1].style.backgroundColor = 'var(--main)';\n      tabs[this.state.tabOn - 1].style.color = 'white';\n      tabs[this.state.tabOn - 1].style.borderBottom = 'black';\n      tabs[value - 1].style.backgroundColor = 'white';\n      tabs[value - 1].style.color = 'var(--main)';\n      tabs[value - 1].style.borderBottom = 'none';\n      this.setState({\n        tabOn: value\n      }, () => {\n        if (value === 2) {\n          this.setState({\n            tabsEnabled: [0, 1, 0, 0]\n          }, () => {\n            document.getElementById(\"countdownFromInput\").value = \"1\";\n            setTabsColor(this.state.tabsEnabled, this.state.tabOn);\n          });\n        } else if (value === 3) {\n          document.getElementById('img1').src = this.gallerySrc.get(this.state.GalleryIndexShowing[0]);\n          document.getElementById('img2').src = this.gallerySrc.get(this.state.GalleryIndexShowing[1]);\n          document.getElementById('img3').src = this.gallerySrc.get(this.state.GalleryIndexShowing[2]);\n\n          if (this.state.stateName.localeCompare('Review') === 0) {}\n        }\n      });\n    } else {\n      this.setState({\n        tabOn: value\n      });\n    }\n  }\n\n  setHideSidePanel(value) {\n    this.setState({\n      hideSidePanel: value\n    }, () => {\n      if (!value) this.setTabOn(this.state.tabOn);\n    });\n  }\n\n  setIsVideoLoading(value) {\n    this.setState({\n      isVideoLoading: value\n    });\n  }\n\n  setCountdownFrom(value) {\n    this.countdownFrom = value;\n  }\n\n  setIsDiagnosisReady(value) {\n    this.setState({\n      isDiagnosisReady: value\n    });\n  }\n\n  setSelectedGalleryPhoto(id) {\n    this.setState({\n      selectedGalleryPhoto: id\n    });\n  }\n\n  async setScreenshots(data) {\n    let newId = this.state.GallerySrcLength + 1;\n    await this.gallerySrc.set(newId, data);\n    this.setState({\n      GallerySrcLength: this.state.GallerySrcLength + 1\n    }, () => {\n      this.childDiagnosis.current.setGallery2();\n    });\n  }\n\n  layout() {\n    this.childWebcamStream.current.organizeScreen(this.childWebcamStream.current);\n  }\n\n  async setAcqInfo(value) {\n    this.acqInfo = this.acqInfo.concat(value);\n\n    if (this.acqInfo.length === 31) {\n      this.generateSheet(this.acqInfo);\n      this.stateHandler('Idle');\n      this.setTabOn(1);\n    }\n  }\n\n  generateSheet(data) {\n    /*not uploaded anywhere yet. \n    Data is array 0f 31 elements. \n    First 27 are in the same order as Database.xls\n    28: which ears is being examinated\n    29: diagnosis normal or anormal\n    30: which condition is selected in anormal\n    31: obs in diagnosis tab\n    */\n    console.log(data);\n  }\n\n  componentDidMount() {\n    this.childDiagnosis.current.listDevices();\n    document.addEventListener('fullscreenchange', event => {\n      this.layout();\n    });\n    document.addEventListener(\"webkitfullscreenchange\", event => {\n      this.layout();\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(WebcamStream, {\n      currentState: this.state,\n      gallerySrc: this.gallerySrc,\n      canvasPreview: this.canvasPreview,\n      stateHandler: nextState => this.stateHandler(nextState),\n      countdownFrom: this.countdownFrom,\n      ref: this.childWebcamStream,\n      setScreenshots: data => {\n        this.setScreenshots(data);\n      },\n      setFullScreen: value => this.setFullScreen(value),\n      setTabOn: value => this.setTabOn(value),\n      setHideSidePanel: value => this.setHideSidePanel(value),\n      setIsDiagnosisReady: value => this.setIsDiagnosisReady(value),\n      setIsVideoLoading: value => this.setIsVideoLoading(value),\n      setCountdownFrom: value => this.setCountdownFrom(value),\n      setGallery: () => this.setGallery(),\n      setGalleryIndxShowing: (newIndxShowing, indx, newPhoto, dir) => this.setGalleryIndxShowing(newIndxShowing, indx, newPhoto, dir),\n      hideSidePanel: () => this.childDiagnosis.current.hideSidePanel(),\n      setAcqInfo: this.setAcqInfo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 10\n      }\n    }), /*#__PURE__*/React.createElement(SidePanel, {\n      currentState: this.state,\n      setStreamFromConfig: () => {\n        this.childWebcamStream.current.setStream();\n      },\n      ref: this.childDiagnosis,\n      setTabOn: value => this.setTabOn(value),\n      setHideSidePanel: value => this.setHideSidePanel(value),\n      mirror: way => {\n        this.childWebcamStream.current.mirror(way);\n      },\n      setCountdownFrom: value => this.setCountdownFrom(value),\n      countdownFrom: this.countdownFrom,\n      setGalleryIndxShowing: (newIndxShowing, indx, newPhoto, dir) => this.setGalleryIndxShowing(newIndxShowing, indx, newPhoto, dir),\n      gallerySrc: this.gallerySrc,\n      setSelectedGalleryPhoto: id => this.setSelectedGalleryPhoto(id),\n      setAcqInfo: this.setAcqInfo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 10\n      }\n    }));\n  }\n\n} //function sleep(ms) {return new Promise(resolve => setTimeout(resolve, ms));}\n\n\nfunction setTabsColor(tabsEnabled, tabOn) {\n  let tabs = document.getElementsByClassName('tab');\n  console.log(tabsEnabled);\n  console.log(tabOn);\n\n  for (let i = 0; i < 4; i++) {\n    if (!tabsEnabled[i]) tabs[i].style.color = 'grey';else {\n      if (i !== tabOn - 1) tabs[i].style.color = 'white';else tabs[i].style.color = 'var(--main)';\n    }\n  }\n}\n\nexport default InferenceUI;","map":{"version":3,"sources":["/home/paula/Documentos/Simbiotica/git/acq_interface/src/components/InferenceUI/InferenceUI.js"],"names":["React","WebcamStream","SidePanel","manageStates","InferenceUI","Component","constructor","props","state","stateName","renderCanvas","textCtrlBtn","enableCtrlBtn","enableCaptureBtn","tabsEnabled","GallerySrcLength","GalleryIndexShowing","selectedGalleryPhoto","isVideoLoading","hideSidePanel","tabOn","fullScreen","isDiagnosisReady","gallerySrc","Map","childWebcamStream","createRef","childDiagnosis","countdownFrom","canvasPreview","acqInfo","setAcqInfo","bind","stateHandler","nextState","setState","console","log","localeCompare","current","listDevices","selectObj","document","getElementById","i","options","length","text","videoSrc","selected","value","cnvs","style","marginLeft","setTabsColor","setGalleryIndxShowing","newIndxShowing","indx","newPhoto","dir","auxArr","mapKeys","Array","from","keys","galleryCtrl","setSelectedGalleryPhoto","src","get","setFullScreen","setTabOn","tabs","getElementsByClassName","backgroundColor","color","borderBottom","setHideSidePanel","setIsVideoLoading","setCountdownFrom","setIsDiagnosisReady","id","setScreenshots","data","newId","set","setGallery2","layout","organizeScreen","concat","generateSheet","componentDidMount","addEventListener","event","render","setGallery","setStream","way","mirror"],"mappings":"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","sourcesContent":["import './InferenceUI.css';\nimport React from 'react';\nimport WebcamStream from './WebcamStream/WebcamStream.js'\nimport SidePanel from './SidePanel/SidePanel.js'\nimport {manageStates} from './functions.js'\n\n\nclass InferenceUI extends React.Component {\n  \n  constructor(props){\n    super();\n    this.state = {\n      stateName: \"Idle\",\n\n      // Render canvas or video\n      renderCanvas: true,\n\n      // Button state\n      textCtrlBtn: \"Empezar\",\n      enableCtrlBtn: true,\n      enableCaptureBtn: false,\n\n      // Side Panel\n      tabsEnabled: [1,0,0,0], //conf, results, diagnosis, report\n      GallerySrcLength: 0,\n      GalleryIndexShowing: [0,0,0],\n      selectedGalleryPhoto: 0,\n      isVideoLoading: true,\n      hideSidePanel: false,\n\n      tabOn: 1,\n      fullScreen: false,\n\n      isDiagnosisReady: false,\n      \n  \t\n    }\n    this.gallerySrc = new Map();\n    this.childWebcamStream = React.createRef();\n    this.childDiagnosis = React.createRef();\n    this.countdownFrom = 5;\n    this.canvasPreview = React.createRef();\n\n    this.acqInfo = []; \n    this.setAcqInfo = this.setAcqInfo.bind(this);\n  }\n  // En caso de que venga de review y vaya a idle, limpiar las variables.\n  async stateHandler(nextState){\n    await this.setState({stateName: nextState});\n    console.log(\"Estado: \" + this.state.stateName);\n    if(nextState.localeCompare('Idle') === 0 && this.state.tabOn === 2){\n      this.setState(manageStates(nextState), async()=>{\n\t\t  \tthis.childDiagnosis.current.listDevices();\n        var selectObj = document.getElementById(\"videoSelectConf\");\n\t\t  \tfor (var i = 0; i < selectObj.options.length; i++) {\n          if (!selectObj.options[i].text.localeCompare(this.childWebcamStream.current.videoSrc)) {\n              selectObj.options[i].selected = true;\n              break;\n          }\n   \t  \t }\n        document.getElementById(\"countdownFromInput\").value=this.countdownFrom;\n      });\n    }\n    else{\n      await this.setState(manageStates(nextState));\n      if(nextState.localeCompare('Countdown') === 0 && this.state.fullScreen){\n        let cnvs = document.getElementById('canvasCountdown');\n        if(cnvs) cnvs.style.marginLeft = '12%';\n\n      }\n    }\n    if(!this.state.hideSidePanel){\n      setTabsColor(this.state.tabsEnabled, this.state.tabOn);\n    }\n      \n\n  \n  }\n  \n\n  async setGalleryIndxShowing(newIndxShowing, indx, newPhoto, dir){\n    let auxArr =[];\n    let mapKeys = Array.from(this.gallerySrc.keys());\n    if((dir.localeCompare('prev') === 0 && this.state.GalleryIndexShowing[0] > mapKeys[0]) \n        || newPhoto || dir.localeCompare('reset') === 0 || dir.localeCompare('delete') === 0 ||\n        (dir.localeCompare('next') === 0 && this.state.GalleryIndexShowing[2] < mapKeys[mapKeys.length-1] && this.state.GalleryIndexShowing[2] !== 0 ) ){\n      auxArr[0] = this.state.GalleryIndexShowing[0];\n      auxArr[1] = this.state.GalleryIndexShowing[1];\n      auxArr[2] = this.state.GalleryIndexShowing[2];\n\n      for (let i=0;i < newIndxShowing.length; i++){\n        auxArr[indx[i]] = newIndxShowing[i];\n      }\n\n      if(dir){\n        this.childDiagnosis.current.galleryCtrl(dir, auxArr, this.gallerySrc, false, this.state.selectedGalleryPhoto);\n      }\n      \n      if(newPhoto){\n        this.setSelectedGalleryPhoto(newIndxShowing[newIndxShowing.length-1]);\n        if(this.state.GalleryIndexShowing[2] !== 0){\n          this.childDiagnosis.current.galleryCtrl('next', auxArr, this.gallerySrc, true);\n        }\n      }\n      if(dir.localeCompare('delete') === 0){\n        document.getElementById('img1').src = this.gallerySrc.get((auxArr[0]));\n        document.getElementById('img2').src = this.gallerySrc.get((auxArr[1]));\n        document.getElementById('img3').src = this.gallerySrc.get((auxArr[2]));\n      }\n      this.setState(\n        {GalleryIndexShowing: auxArr}\n      );\n    }\n  }\n      \n  setFullScreen(value){\n    this.setState({fullScreen: value});\n  }\n  setTabOn(value){\n    if(!this.state.hideSidePanel){\n  \t  let tabs = document.getElementsByClassName('tab');\n  \t  tabs[this.state.tabOn-1].style.backgroundColor = 'var(--main)';\n  \t  tabs[this.state.tabOn-1].style.color= 'white';\n  \t  tabs[this.state.tabOn-1].style.borderBottom = 'black';\n  \t  tabs[value-1].style.backgroundColor = 'white';\n  \t  tabs[value-1].style.color = 'var(--main)';\n  \t  tabs[value-1].style.borderBottom = 'none';\n      this.setState({tabOn: value},()=>{\n        if(value === 2){\n          this.setState({tabsEnabled: [0,1,0,0]},()=>{\n            document.getElementById(\"countdownFromInput\").value=\"1\";\n            setTabsColor(this.state.tabsEnabled, this.state.tabOn);\n          });\n        }\n        else if(value === 3){\n          document.getElementById('img1').src = this.gallerySrc.get((this.state.GalleryIndexShowing[0]));\n          document.getElementById('img2').src = this.gallerySrc.get((this.state.GalleryIndexShowing[1]));\n          document.getElementById('img3').src = this.gallerySrc.get((this.state.GalleryIndexShowing[2]));\n          if(this.state.stateName.localeCompare('Review') === 0){\n          }\n        }\n      });\n    }\n    else{\n      this.setState({tabOn: value});\n    }\n  }\n  setHideSidePanel(value){\n    this.setState({hideSidePanel: value},()=>{if (!value) this.setTabOn(this.state.tabOn)});\n  }\n  setIsVideoLoading(value){\n    this.setState({isVideoLoading: value});\n  }\n  setCountdownFrom(value){\n    this.countdownFrom = value;\n  }\n  setIsDiagnosisReady(value){\n    this.setState({isDiagnosisReady: value});\n  }\n  setSelectedGalleryPhoto(id){\n    this.setState({selectedGalleryPhoto: id});\n  }\n  async setScreenshots(data){\n    let newId =    this.state.GallerySrcLength+1;\n    await this.gallerySrc.set(newId, data);\n    this.setState(\n      {GallerySrcLength: this.state.GallerySrcLength +1 },\n      ()=>{this.childDiagnosis.current.setGallery2()}\n    );\n  }\n\n  layout(){\n    this.childWebcamStream.current.organizeScreen(this.childWebcamStream.current);\n  }\n\n\n  async setAcqInfo(value){\n    this.acqInfo = this.acqInfo.concat(value);\n    if(this.acqInfo.length === 31){\n      this.generateSheet(this.acqInfo);\n      this.stateHandler('Idle');\n      this.setTabOn(1);\n    }\n  }\n  generateSheet(data){\n    /*not uploaded anywhere yet. \n    Data is array 0f 31 elements. \n    First 27 are in the same order as Database.xls\n    28: which ears is being examinated\n    29: diagnosis normal or anormal\n    30: which condition is selected in anormal\n    31: obs in diagnosis tab\n    */\n    console.log(data);\n  }\n  componentDidMount(){\n    this.childDiagnosis.current.listDevices();\n    document.addEventListener('fullscreenchange', (event => {\n      this.layout();\n    }));\n    document.addEventListener(\"webkitfullscreenchange\", (event => {\n      this.layout();\n    }));\n  }\n\n  render() {\n    return (\n\t\t\t<div id=\"container\">\n         <WebcamStream currentState={this.state} \n                       gallerySrc = {this.gallerySrc}\n                       canvasPreview={this.canvasPreview}\n                       stateHandler={(nextState)=>this.stateHandler(nextState)} \n                       countdownFrom={this.countdownFrom} \n                       ref={this.childWebcamStream}\n                       setScreenshots={(data)=>{this.setScreenshots(data)}}\n                       setFullScreen={(value)=>this.setFullScreen(value)}\n                       setTabOn={(value)=>this.setTabOn(value)}\n                       setHideSidePanel={(value)=>this.setHideSidePanel(value)}\n                       setIsDiagnosisReady ={(value)=>this.setIsDiagnosisReady(value)}\n                       setIsVideoLoading={(value)=>this.setIsVideoLoading(value)}\n                       setCountdownFrom={(value)=>this.setCountdownFrom(value)}\n                       setGallery={()=>this.setGallery()}\n                       setGalleryIndxShowing={(newIndxShowing, indx, newPhoto,dir)=>this.setGalleryIndxShowing(newIndxShowing,indx, newPhoto, dir)}\n                       hideSidePanel={()=>this.childDiagnosis.current.hideSidePanel()}\n                       setAcqInfo = {this.setAcqInfo}    \n                      \n\t\t\t\t />\n         <SidePanel    currentState={this.state}\n                       setStreamFromConfig={()=>{this.childWebcamStream.current.setStream();}}\n                       ref={this.childDiagnosis}\n                       setTabOn={(value)=>this.setTabOn(value)}\n                       setHideSidePanel={(value)=>this.setHideSidePanel(value)}\n                       mirror={(way)=>{this.childWebcamStream.current.mirror(way)}}\n                       setCountdownFrom={(value)=>this.setCountdownFrom(value)}\n                       countdownFrom={this.countdownFrom} \n                       setGalleryIndxShowing={(newIndxShowing, indx, newPhoto,dir)=>this.setGalleryIndxShowing(newIndxShowing,indx, newPhoto, dir)}\n                       gallerySrc = {this.gallerySrc}\n                       setSelectedGalleryPhoto = {(id) => this.setSelectedGalleryPhoto(id)}\n                       setAcqInfo = {this.setAcqInfo}    \n                       \n         />\n      </div>\n      );\n    }\n}\n\n//function sleep(ms) {return new Promise(resolve => setTimeout(resolve, ms));}\nfunction setTabsColor(tabsEnabled, tabOn){\n  let tabs = document.getElementsByClassName('tab');\n  console.log(tabsEnabled);\n  console.log(tabOn);\n  for(let i = 0; i <4; i++){\n    if(!tabsEnabled[i])\n      tabs[i].style.color = 'grey';\n    else{\n      if(i !== tabOn-1)\n        tabs[i].style.color = 'white';\n      else\n        tabs[i].style.color = 'var(--main)';\n    }\n  }\n}\nexport default InferenceUI;\n"]},"metadata":{},"sourceType":"module"}