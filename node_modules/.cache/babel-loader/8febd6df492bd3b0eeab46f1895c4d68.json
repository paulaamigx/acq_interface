{"ast":null,"code":"import JSZipUtils from 'jszip-utils';\nimport JSZip from 'jszip';\nimport FileSaver from 'file-saver';\nexport var handleDataAvailable = function (el) {\n  return function (event) {\n    if (event.data && event.data.size > 0) {\n      el.recordedChunks.push(event.data);\n      var blob = new Blob(el.recordedChunks, {\n        type: \"video/webm;codecs=vp8\"\n      });\n      el.videoRecorded = URL.createObjectURL(blob);\n      setVideoRec(el);\n    } else {\n      console.log(\"no data available for recording\");\n    }\n  };\n};\n\nasync function setVideoRec(el) {\n  await sleep(250);\n  var videoElement = document.getElementById(\"recordedVideoElement\");\n  videoElement.src = null;\n  videoElement.srcObject = null;\n  videoElement.src = el.videoRecorded;\n}\n\nexport async function ctrlBtnFunction(el) {\n  switch (el.props.currentState.stateName) {\n    case 'Idle':\n      if (!document.getElementById('c_rightEar').checked && !document.getElementById('c_leftEar').checked) {\n        document.getElementById('earUncheckedWarning').style.display = 'block';\n      } else {\n        let data = document.getElementById('c_leftEar').checked ? 'izquierdo' : 'derecho';\n        el.props.setAcqInfo(data);\n        el.props.stateHandler('Countdown');\n        el.timeStartPressed = Date.now();\n        el.props.setTabOn(3);\n        setCountdownFrom(el);\n      }\n\n      break;\n\n    case 'Countdown':\n      el.props.stateHandler('Idle');\n      el.props.setTabOn(1);\n      break;\n\n    case 'Examination':\n      el.stopRecording();\n\n      if (el.props.currentState.hideSidePanel) {\n        el.props.setHideSidePanel(false);\n      }\n\n      if (el.props.currentState.fullScreen) {\n        fullScreen(el);\n      }\n\n      await sleep(200);\n      el.props.stateHandler('Review');\n      el.props.setTabOn(4); //el.videoSrc = document.getElementById(\"videoSelectConf\").value;\n      // Enviar al servidor la solicitud de diagnóstico.\n\n      let stream = el.videoTag.current.srcObject;\n      let tracks = stream.getTracks();\n      tracks.forEach(function (track) {\n        track.stop();\n      });\n      el.videoTag.current.srcObject = null;\n      break;\n\n    case 'Review':\n      el.props.stateHandler('Idle');\n      el.setStream();\n      el.props.setIsDiagnosisReady(false);\n      el.props.gallerySrc.clear();\n      el.props.setGalleryIndxShowing([0, 0, 0], [0, 1, 2], false, 'reset');\n      el.props.setTabOn(1);\n      restartStateProps(el);\n      break;\n\n    default:\n      console.log(\"Error: Boton apretado en estado que no correspondía.\");\n  }\n}\n\nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nfunction restartStateProps(el) {\n  el.timeStartPressed = null;\n  el.mediaRecorder = null;\n  el.recordedChunks = [];\n  el.videoRecorded = null;\n}\n\nfunction setCountdownFrom(el) {\n  if (!el.props.currentState.fullScreen && !el.props.currentState.hideSidePanel) {\n    el.props.setCountdownFrom(parseInt(document.getElementById(\"countdownFromInput\").value));\n  }\n}\n\nexport function countdown(canvas, el, countdown, countdownNext) {\n  //let context = canvas;\t\n  let cnvs = document.getElementById(\"canvasCountdown\");\n  let countdownFrom = el.props.countdownFrom;\n\n  if (cnvs) {\n    let w = canvas.clientWidth * 100 / window.innerWidth;\n    let h = canvas.clientHeight * 100 / window.innerWidth;\n    cnvs.style.width = w + \"vw\";\n    cnvs.style.height = h + \"vw\";\n    cnvs.style.left = canvas.clientLeft;\n    cnvs.style.top = canvas.clientTop;\n    let context = cnvs.getContext(\"2d\");\n    context.font = cnvs.height / 3 + \"px RobotoThin\";\n    countdownNext = countdownFrom - Math.trunc((-el.timeStartPressed + Date.now()) / 1000);\n\n    if (countdownNext !== countdown) {\n      context.clearRect(0, 0, canvas.clientWidth * 2, canvas.clientHeight * 2);\n    }\n\n    countdown = countdownNext;\n    context.beginPath();\n    context.textAlign = \"center\";\n    context.fillStyle = \"white\";\n\n    if (countdown >= 10) {\n      context.fillText(countdown.toString(10), cnvs.width / 2, cnvs.height / 2 + 80);\n    } else if (countdown >= 1) {\n      context.fillText(countdown.toString(10), cnvs.width / 2, cnvs.height / 2 + 80);\n    }\n\n    context.fill();\n\n    if (countdown < 1) {\n      el.props.stateHandler(\"Examination\");\n      el.startRecording();\n    }\n  }\n}\n\nfunction urlToPromise(url) {\n  return new Promise(function (resolve, reject) {\n    JSZipUtils.getBinaryContent(url, function (err, data) {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(data);\n      }\n    });\n  });\n}\n\nexport function captureScreenshot(el) {\n  var canvas = el.props.canvasPreview.current;\n  var imgAsDataURL = canvas.toDataURL(\"image/jpeg\", 1);\n  /*\n    let newId = el.props.currentState.GallerySrc.length + 1;\n    let newSlidesData = [{src: imgAsDataURL, \n                          id: newId\n                        }];\n    el.props.setScreenshots(newSlidesData); \n    */\n  //    let newId = el.props.currentState.GallerySrcLength + 1;\n\n  el.props.setScreenshots(imgAsDataURL);\n}\nexport function mirror(el, way) {\n  //revisar numeros\n  if (way.localeCompare(\"horizontal\") === 0) {\n    el.mirrorTranslate[0] += el.mirrorScale[0] * 640;\n    el.mirrorScale[0] *= -1;\n  } else if (way.localeCompare(\"vertical\") === 0) {\n    el.mirrorTranslate[1] += el.mirrorScale[1] * 480;\n    el.mirrorScale[1] *= -1;\n  } else if (way.localeCompare(\"reset\") === 0) {\n    el.mirrorTranslate = [0, 0];\n    el.mirrorScale = [1, 1];\n  }\n}\nexport function fullScreen(el) {\n  let div = document.getElementById(\"canvasDiv\");\n  let canvas = document.getElementById(\"canvasPreview\");\n\n  if (!el.props.currentState.fullScreen) {\n    el.canvasWidth = canvas.clientWidth * 100 / window.innerWidth;\n    el.canvasHeight = canvas.clientHeight * 100 / window.innerWidth;\n\n    if (div.webkitRequestFullScreen) {\n      div.webkitRequestFullScreen();\n    } else {\n      div.requestFullscreen();\n    }\n  } else {\n    document.exitFullscreen();\n  }\n}\nexport async function organizeScreen(el) {\n  console.log('os');\n  let div = document.getElementById(\"canvasDiv\");\n  let canvas = document.getElementById(\"canvasPreview\");\n  let btns = document.getElementById(\"buttons\");\n  let canvasCountdown = document.getElementById(\"canvasCountdown\");\n\n  if (div) {\n    /********** organize full screen ************/\n    if (document.fullscreenElement) {\n      console.log('os2');\n      el.props.setFullScreen(true);\n\n      if (!el.props.currentState.hideSidePanel && !el.props.currentState.stateName.localeCompare('Idle')) {\n        el.props.setCountdownFrom(parseInt(document.getElementById(\"countdownFromInput\").value));\n      }\n\n      console.log(window.screen.height);\n      canvas.style.height = window.screen.height + \"px\";\n      canvas.style.width = window.screen.height * el.canvasWidth / el.canvasHeight + \"px\";\n      canvas.style.marginLeft = \"12%\";\n\n      if (canvasCountdown) {\n        canvasCountdown.style.marginLeft = \"12%\";\n      }\n\n      div.appendChild(btns);\n      btns.style.width = getComputedStyle(canvas).width;\n      btns.style.marginLeft = \"12%\";\n      btns.style.top = window.screen.height - btns.clientHeight + \"px\";\n\n      if (!el.props.currentState.hideSidePanel) {\n        canvas.addEventListener(\"mouseover\", showButtons, false);\n        btns.addEventListener(\"mouseover\", showButtons, false);\n        canvas.addEventListener(\"mouseout\", hideButtons, false);\n\n        if (canvasCountdown) {\n          canvasCountdown.addEventListener(\"mouseover\", showButtons, false);\n          canvasCountdown.addEventListener(\"mouseout\", hideButtons, false);\n        }\n      }\n    }\n    /********** organize regular screen ************/\n    else {\n        div.style.width = \"50vw\";\n        canvas.style.width = el.canvasWidth + \"vw\";\n        canvas.style.height = el.canvasHeight + \"vw\";\n        el.props.setFullScreen(false);\n        document.getElementById(\"WebcamStream_Wrapper\").appendChild(btns);\n        canvas.style.height = canvas.clientWidth * (100 / window.innerWidth) * el.canvasHeight / el.canvasWidth + \"vw\";\n        canvas.style.marginLeft = 0;\n\n        if (canvasCountdown) {\n          canvasCountdown.style.marginLeft = 0;\n        }\n\n        if (!el.props.currentState.hideSidePanel) {\n          btns.style.top = el.canvasHeight + \"vw\";\n        } else {\n          btns.style.top = el.canvasHeight - btns.clientHeight * 100 / window.innerWidth + \"vw\";\n        }\n\n        div.appendChild(btns);\n        btns.style.marginLeft = 0;\n        btns.style.width = el.canvasWidth + \"vw\";\n\n        if (!el.props.currentState.hideSidePanel) {\n          canvas.removeEventListener(\"mouseover\", showButtons, false);\n          btns.removeEventListener(\"mouseover\", showButtons, false);\n          canvas.removeEventListener(\"mouseout\", hideButtons, false);\n\n          if (canvasCountdown) {\n            canvasCountdown.addEventListener(\"mouseover\", hideButtons, false);\n            canvasCountdown.addEventListener(\"mouseout\", showButtons, false);\n          }\n        }\n\n        btns.style.opacity = 1;\n      }\n  } else {\n    await sleep(10);\n    organizeScreen(el);\n  }\n}\n\nfunction showButtons() {\n  var btns = document.getElementById(\"buttons\");\n  btns.style.opacity = 0.7;\n}\n\nfunction hideButtons() {\n  var btns = document.getElementById(\"buttons\");\n  btns.style.opacity = 0;\n}\n\nexport default {\n  handleDataAvailable,\n  ctrlBtnFunction,\n  countdown,\n  captureScreenshot,\n  mirror,\n  fullScreen,\n  organizeScreen\n};","map":{"version":3,"sources":["/home/paula/Documentos/Simbiotica/git/acq_interface/src/components/InferenceUI/WebcamStream/functions.js"],"names":["JSZipUtils","JSZip","FileSaver","handleDataAvailable","el","event","data","size","recordedChunks","push","blob","Blob","type","videoRecorded","URL","createObjectURL","setVideoRec","console","log","sleep","videoElement","document","getElementById","src","srcObject","ctrlBtnFunction","props","currentState","stateName","checked","style","display","setAcqInfo","stateHandler","timeStartPressed","Date","now","setTabOn","setCountdownFrom","stopRecording","hideSidePanel","setHideSidePanel","fullScreen","stream","videoTag","current","tracks","getTracks","forEach","track","stop","setStream","setIsDiagnosisReady","gallerySrc","clear","setGalleryIndxShowing","restartStateProps","ms","Promise","resolve","setTimeout","mediaRecorder","parseInt","value","countdown","canvas","countdownNext","cnvs","countdownFrom","w","clientWidth","window","innerWidth","h","clientHeight","width","height","left","clientLeft","top","clientTop","context","getContext","font","Math","trunc","clearRect","beginPath","textAlign","fillStyle","fillText","toString","fill","startRecording","urlToPromise","url","reject","getBinaryContent","err","captureScreenshot","canvasPreview","imgAsDataURL","toDataURL","setScreenshots","mirror","way","localeCompare","mirrorTranslate","mirrorScale","div","canvasWidth","canvasHeight","webkitRequestFullScreen","requestFullscreen","exitFullscreen","organizeScreen","btns","canvasCountdown","fullscreenElement","setFullScreen","screen","marginLeft","appendChild","getComputedStyle","addEventListener","showButtons","hideButtons","removeEventListener","opacity"],"mappings":"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","sourcesContent":["import JSZipUtils from 'jszip-utils';\nimport JSZip from 'jszip';\nimport FileSaver from 'file-saver';\n\n\n\nexport var handleDataAvailable = function(el) {\n  return function (event) {\n    if (event.data && event.data.size > 0) {\n      el.recordedChunks.push(event.data);\n      var blob = new Blob(el.recordedChunks, {\n        type: \"video/webm;codecs=vp8\"\n      });\n      el.videoRecorded = URL.createObjectURL(blob);\n      setVideoRec(el);\n      }\n    else {\n        console.log(\"no data available for recording\");\n      }\n  }\n}\nasync function setVideoRec(el){\n  await sleep(250);\n  var videoElement = document.getElementById(\"recordedVideoElement\");\n  videoElement.src = null;\n  videoElement.srcObject = null;\n  videoElement.src = el.videoRecorded;\n}\n\nexport async function ctrlBtnFunction(el){\n    switch(el.props.currentState.stateName){\n      case 'Idle':\n        if(!document.getElementById('c_rightEar').checked && !document.getElementById('c_leftEar').checked){\n          document.getElementById('earUncheckedWarning').style.display = 'block';\n        }\n        else{\n          let data = (document.getElementById('c_leftEar').checked)? 'izquierdo': 'derecho';\n          el.props.setAcqInfo(data);\n          el.props.stateHandler('Countdown');\n          el.timeStartPressed = Date.now();\n          el.props.setTabOn(3);\n          setCountdownFrom(el);\n          }\n        break;\n\t\t\tcase 'Countdown':\n        el.props.stateHandler('Idle');\n\t\t    el.props.setTabOn(1);\n\t\t\t\tbreak\n      case 'Examination':\n        el.stopRecording();\n        if(el.props.currentState.hideSidePanel){\n\t\t      el.props.setHideSidePanel(false);\n        }\n        if(el.props.currentState.fullScreen){\n         fullScreen(el); \n        }\n        await sleep(200);\n        el.props.stateHandler('Review')\n        el.props.setTabOn(4);\n        //el.videoSrc = document.getElementById(\"videoSelectConf\").value;\n        // Enviar al servidor la solicitud de diagnóstico.\n        let stream = el.videoTag.current.srcObject;\n        let tracks = stream.getTracks();\n        tracks.forEach(function(track) {\n            track.stop();\n        });\n        el.videoTag.current.srcObject = null;\n        break;\n      case 'Review':\n        el.props.stateHandler('Idle');\n        el.setStream();\n        el.props.setIsDiagnosisReady(false);\n        el.props.gallerySrc.clear();\n        el.props.setGalleryIndxShowing([0,0,0],[0,1,2],false,'reset');\n        el.props.setTabOn(1);\n        restartStateProps(el);\n        break;\n      default:\n        console.log(\"Error: Boton apretado en estado que no correspondía.\")\n    }\n  }\n function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms));}\n\n  function restartStateProps(el){\n    el.timeStartPressed = null;\n    el.mediaRecorder = null;\n    el.recordedChunks= [];\n\t  el.videoRecorded = null;\n  }\n\n  function setCountdownFrom(el){\n    if (!el.props.currentState.fullScreen && !el.props.currentState.hideSidePanel){\n      el.props.setCountdownFrom(parseInt(document.getElementById(\"countdownFromInput\").value));\n    }\n  }\n\n  export function countdown(canvas,el, countdown, countdownNext){\n    //let context = canvas;\t\n    let cnvs = document.getElementById(\"canvasCountdown\");\n    let countdownFrom = el.props.countdownFrom;\n\n    if(cnvs){\n      let w =canvas.clientWidth*100/window.innerWidth;\n      let h =canvas.clientHeight*100/window.innerWidth;\n      cnvs.style.width =  w + \"vw\";\n      cnvs.style.height=  h + \"vw\";\n      cnvs.style.left = canvas.clientLeft;\n      cnvs.style.top = canvas.clientTop;\n      let context = cnvs.getContext(\"2d\");\n      context.font = cnvs.height/3 +\"px RobotoThin\"\n             \n      \n      countdownNext = countdownFrom- Math.trunc((-el.timeStartPressed + Date.now())/1000);\n      if(countdownNext !== countdown){\n        context.clearRect(0, 0, canvas.clientWidth*2, canvas.clientHeight*2); \n      }\n      countdown = countdownNext;\n      context.beginPath();\n      context.textAlign = \"center\";\n      context.fillStyle = \"white\";\n      if(countdown >= 10){\n        context.fillText(countdown.toString(10),cnvs.width/2,cnvs.height/2+80);\n      }else if(countdown >= 1){\n        context.fillText(countdown.toString(10),cnvs.width/2 ,cnvs.height/2+80);\n      }\n    \n      context.fill();\n      if (countdown <  1){\n            el.props.stateHandler(\"Examination\");\n            el.startRecording();\n      }\n      }\n  }\n  \nfunction urlToPromise(url) {\n    return new Promise(function(resolve, reject) {\n      JSZipUtils.getBinaryContent(url, function (err, data) {\n        if(err) {\n          reject(err);\n        }\n        else {\n          resolve(data);\n        }\n      });\n    });\n  }\n\n\n  export function captureScreenshot(el){\n    var canvas = el.props.canvasPreview.current; \n    var imgAsDataURL = canvas.toDataURL(\"image/jpeg\",1);\n  /*\n    let newId = el.props.currentState.GallerySrc.length + 1;\n    let newSlidesData = [{src: imgAsDataURL, \n                          id: newId\n                        }];\n    el.props.setScreenshots(newSlidesData); \n    */\n//    let newId = el.props.currentState.GallerySrcLength + 1;\n    el.props.setScreenshots(imgAsDataURL);\n    }\n\nexport function mirror(el,way){\n  //revisar numeros\n\tif(way.localeCompare(\"horizontal\") === 0){\n    el.mirrorTranslate[0] += el.mirrorScale[0]*640;\n    el.mirrorScale[0]*=-1;\n  }\n  else if(way.localeCompare(\"vertical\") === 0){\n    el.mirrorTranslate[1] += el.mirrorScale[1]*480;\n    el.mirrorScale[1]*=-1;\n  }\n  else if(way.localeCompare(\"reset\")===0){\n    el.mirrorTranslate = [0,0];\n    el.mirrorScale = [1,1];\n  }\n}\n\nexport function fullScreen(el){\n    let div = document.getElementById(\"canvasDiv\");\n    let canvas = document.getElementById(\"canvasPreview\");\n\n    if(!el.props.currentState.fullScreen){\n      el.canvasWidth = canvas.clientWidth*100/window.innerWidth;\n      el.canvasHeight =canvas.clientHeight*100/window.innerWidth;\n    \tif(div.webkitRequestFullScreen) {\n    \t\tdiv.webkitRequestFullScreen();\n    \t}\n    \telse {\n    \t\tdiv.requestFullscreen();\n    \t} \n    }\n    else{\n      document.exitFullscreen();\n    }\n}\n\nexport async function organizeScreen(el){\n  console.log('os');\n  let div = document.getElementById(\"canvasDiv\");\n  let canvas = document.getElementById(\"canvasPreview\");\n  let btns= document.getElementById(\"buttons\");\n\n  let canvasCountdown = document.getElementById(\"canvasCountdown\");\n  if(div){\n    /********** organize full screen ************/\n    if (document.fullscreenElement) {\n      console.log('os2');\n\t  \tel.props.setFullScreen(true);\n      if(!el.props.currentState.hideSidePanel && !el.props.currentState.stateName.localeCompare('Idle')){\n        el.props.setCountdownFrom(parseInt(document.getElementById(\"countdownFromInput\").value));\n      }\n      console.log(window.screen.height);\n\t  \tcanvas.style.height = window.screen.height + \"px\";\n\t  \tcanvas.style.width = window.screen.height*el.canvasWidth/el.canvasHeight + \"px\";\n\t  \tcanvas.style.marginLeft = \"12%\";\n\n      if(canvasCountdown){\n        canvasCountdown.style.marginLeft = \"12%\";\n      }\n\t  \tdiv.appendChild(btns);\n\t  \tbtns.style.width = getComputedStyle(canvas).width;\n      btns.style.marginLeft = \"12%\"\n\t  \tbtns.style.top = window.screen.height - btns.clientHeight  + \"px\";\n      if(!el.props.currentState.hideSidePanel){\n\t  \t  canvas.addEventListener(\"mouseover\",showButtons, false);\n\t  \t  btns.addEventListener(\"mouseover\",showButtons, false);\n\t  \t  canvas.addEventListener(\"mouseout\",hideButtons,false);\n        if(canvasCountdown){\n    \t\t  canvasCountdown.addEventListener(\"mouseover\",showButtons, false);\n\t    \t  canvasCountdown.addEventListener(\"mouseout\",hideButtons,false);\n        }\n      }\n\t  }\n\n    /********** organize regular screen ************/\n\t  else{\n      div.style.width=  \"50vw\";\n\t  \tcanvas.style.width = el.canvasWidth + \"vw\";\n\t  \tcanvas.style.height = el.canvasHeight + \"vw\";\n\t  \tel.props.setFullScreen(false);\n\t  \tdocument.getElementById(\"WebcamStream_Wrapper\").appendChild(btns);\n      canvas.style.height = canvas.clientWidth*(100/window.innerWidth)*el.canvasHeight/el.canvasWidth + \"vw\";\n\t  \tcanvas.style.marginLeft = 0;\n      if(canvasCountdown){\n        canvasCountdown.style.marginLeft = 0;\n      }\n      if(!el.props.currentState.hideSidePanel){\n\t  \t  btns.style.top = el.canvasHeight + \"vw\";\n      }\n      else{\n\t  \t  btns.style.top = el.canvasHeight - btns.clientHeight*100/window.innerWidth+ \"vw\";\n      }\n\t  \tdiv.appendChild(btns);\n      btns.style.marginLeft = 0;\n      btns.style.width = el.canvasWidth + \"vw\";\n      if(!el.props.currentState.hideSidePanel){\n    \t\tcanvas.removeEventListener(\"mouseover\",showButtons,false);\n    \t\tbtns.removeEventListener(\"mouseover\",showButtons,false);\n    \t\tcanvas.removeEventListener(\"mouseout\",hideButtons,false);\n        if(canvasCountdown){\n    \t\t  canvasCountdown.addEventListener(\"mouseover\",hideButtons, false);\n\t    \t  canvasCountdown.addEventListener(\"mouseout\",showButtons,false);\n        }\n      }\n\t  \tbtns.style.opacity = 1;\n\t  }\n  }\n  else{\n    await sleep(10);\n    organizeScreen(el);\n  }\n}\nfunction showButtons(){\n\tvar btns= document.getElementById(\"buttons\");\n\tbtns.style.opacity=0.7;\n}\n\nfunction hideButtons(){\n\tvar btns= document.getElementById(\"buttons\");\n\tbtns.style.opacity=0;\n}\n\n  export default {handleDataAvailable, ctrlBtnFunction, countdown,\n                 captureScreenshot, mirror, fullScreen, organizeScreen}\n\n"]},"metadata":{},"sourceType":"module"}