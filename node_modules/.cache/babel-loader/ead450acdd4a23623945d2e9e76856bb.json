{"ast":null,"code":"var _jsxFileName = \"/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/InferenceUI.js\";\nimport './InferenceUI.css';\nimport { Container, Button, Modal, ModalHeader, ModalBody, ModalFooter, Progress, Spinner } from 'reactstrap';\nimport React, { useState } from 'react'; //import io from 'socket.io-client';\n//import WebcamStream from './WebcamStream.js'\n\nimport \"react-responsive-carousel/lib/styles/carousel.min.css\";\n\nclass WebcamStream extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isVideoLoading: true\n    };\n    this.videoTag = React.createRef();\n    this.canvasPreview = React.createRef();\n    this.selectVideoSrc = React.createRef();\n    this.tick = this.tick.bind(this);\n  }\n\n  componentDidMount() {\n    navigator.mediaDevices.enumerateDevices().then(deviceInfos => {\n      for (let i = 0; i !== deviceInfos.length; ++i) {\n        const deviceInfo = deviceInfos[i];\n        const option = document.createElement('option');\n        option.value = deviceInfo.deviceId;\n\n        if (deviceInfo.kind === 'videoinput') {\n          option.text = deviceInfo.label || 'camera ' + (this.selectVideoSrc.current.length + 1);\n          this.selectVideoSrc.current.appendChild(option);\n        }\n      }\n    }).then(navigator.mediaDevices.getUserMedia({\n      video: {\n        facingMode: \"environment\"\n      }\n    }).then(stream => {\n      this.videoTag.current.srcObject = stream;\n      requestAnimationFrame(this.tick);\n      window.stream = stream;\n    }));\n  }\n\n  tick() {\n    const video = this.videoTag.current;\n    const checkVideoState = setInterval(() => {\n      if (video.readyState === video.HAVE_ENOUGH_DATA) {\n        clearInterval(checkVideoState);\n        this.setState({\n          isVideoLoading: false\n        });\n        const canvasPreviewElement = this.canvasPreview.current;\n        const canvasPreview = canvasPreviewElement.getContext(\"2d\");\n        canvasPreviewElement.height = video.videoHeight;\n        canvasPreviewElement.width = video.videoWidth;\n        canvasPreview.drawImage(video, 0, 0, canvasPreviewElement.width, canvasPreviewElement.height);\n\n        if (this.props.currentState.almostStreaming) {\n          canvasPreview.font = \"200px Arial\";\n          countdown(canvasPreview, this);\n        }\n\n        requestAnimationFrame(this.tick);\n      }\n    }, 50);\n  }\n\n  render() {\n    const {\n      isVideoLoading\n    } = this.state;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"video\", {\n      ref: this.videoTag,\n      width: \"400\",\n      height: \"400\",\n      autoPlay: true,\n      style: {\n        display: \"none\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }\n    }), !isVideoLoading && /*#__PURE__*/React.createElement(\"canvas\", {\n      ref: this.canvasPreview,\n      id: \"canvasPreview\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 29\n      }\n    }), isVideoLoading && /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 28\n      }\n    }, \"Please wait while we load the video stream.\"), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"videoSelectDiv\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"select\", {\n      ref: this.selectVideoSrc,\n      style: {\n        width: 300\n      },\n      id: \"videoSelect\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      color: \"primary\",\n      onClick: () => {\n        console.log(this.props);\n        document.getElementById(\"videoSelectDiv\").remove();\n        this.props.handler(\"OnConnection\");\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 6\n      }\n    }, \"Ok\")));\n  }\n\n}\n\nfunction countdown(canvas, el) {\n  let context = canvas;\n  let countdown = el.props.countdownFrom - Math.trunc((-el.props.currentState.timeStartPressed + Date.now()) / 1000);\n  context.beginPath();\n  context.arc(320, 240, 130, 0, 2 * Math.PI);\n  context.fillStyle = \"rgba(255, 255, 255, 0.8)\";\n  ;\n  context.fill();\n  context.beginPath();\n  context.fillStyle = \"black\";\n\n  if (countdown >= 10) {\n    context.fillText(countdown.toString(10), 200, 315);\n  } else if (countdown >= 1) {\n    context.fillText(countdown.toString(10), 270, 308, 100);\n  }\n\n  context.fill();\n\n  if (countdown < 1) {\n    el.props.currentState.almostStreaming = false;\n    el.props.currentState.streaming = true;\n    el.props.handler(\"Streaming\");\n  }\n}\n\nvar Carousel = require('react-responsive-carousel').Carousel;\n\nconst ModalDiagnosis = props => {\n  const {\n    className\n  } = props;\n  const [modal, setModal] = useState(true);\n\n  const toggle = () => {\n    setModal(!modal);\n    props.handlerSuper();\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Modal, {\n    isOpen: modal,\n    toggle: toggle,\n    className: className,\n    size: 'xl',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(ModalHeader, {\n    toggle: toggle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 9\n    }\n  }, \"Modal title\"), /*#__PURE__*/React.createElement(ModalBody, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Spinner, {\n    color: \"info\",\n    style: {\n      position: 'absolute',\n      margin: 'auto'\n    },\n    size: 'xl',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 6\n    }\n  }))));\n};\n\nconst ModalScreenshots = props => {\n  const {\n    className,\n    data\n  } = props;\n  const [modal, setModal] = useState(true);\n\n  const toggle = () => {\n    setModal(!modal);\n    props.handler();\n  };\n\n  console.log(\"sadsa\");\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Modal, {\n    isOpen: modal,\n    toggle: toggle,\n    className: className,\n    size: 'xl',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(ModalHeader, {\n    toggle: toggle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 9\n    }\n  }, \"Modal title\"), /*#__PURE__*/React.createElement(ModalBody, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Carousel, {\n    showArrows: true,\n    selectedItem: 0,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 9\n    }\n  }, data.map(slide => /*#__PURE__*/React.createElement(\"div\", {\n    key: 0,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    className: \"slick-slide-image\",\n    src: slide.src,\n    alt: \"Error\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 15\n    }\n  }))))), /*#__PURE__*/React.createElement(ModalFooter, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 9\n    }\n  })));\n};\n\nclass Screenshots extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.captureScreenshot = async () => {\n      var canvas = document.querySelector(\"#canvasPreview\");\n      var imgAsDataURL = canvas.toDataURL(\"image/jpeg\", 1);\n      let newSlidesData = [{\n        src: imgAsDataURL\n      }];\n      this.setState({\n        slidesData: this.state.slidesData.concat(newSlidesData)\n      });\n      await this.setState({\n        lastScreenshotID: this.state.lastScreenshotID + 1\n      });\n      let btnsCarousel = document.getElementsByClassName(\"control-arrow\");\n      document.querySelector(\".carousel-slider\").style.display = 'none';\n      let thumbs = document.getElementsByClassName(\"thumb\");\n\n      thumbs[thumbs.length - 1].onclick = async () => {\n        if (this.props.currentState.showModalScreenshots) {\n          this.props.handler(\"Screenshots\");\n          this.state.modalOn = true;\n        }\n      };\n\n      console.log(\"qq\" + this.props.currentState.current);\n\n      try {\n        btnsCarousel[2].style.backgroundColor = 'black';\n        btnsCarousel[3].style.backgroundColor = 'black';\n      } catch {}\n    };\n\n    this.state = {\n      lastScreenshotID: 0,\n      modalOn: false,\n      slidesData: []\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 4\n      }\n    }, this.state.modalOn && /*#__PURE__*/React.createElement(ModalScreenshots, {\n      handler: () => {\n        this.setState({\n          modalOn: false\n        });\n      },\n      data: this.state.slidesData,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 28\n      }\n    }), /*#__PURE__*/React.createElement(Carousel, {\n      showArrows: true,\n      selectedItem: this.state.lastScreenshotID,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }\n    }, this.state.slidesData.map(slide => /*#__PURE__*/React.createElement(\"div\", {\n      key: this.state.lastScreenshotID,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      className: \"slick-slide-image\",\n      src: slide.src,\n      alt: \"\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 15\n      }\n    })))));\n  }\n\n}\n\nfunction startStopFunction(btn) {\n  if (btn.props.currentState.textMainBtn.localeCompare(\"Start\") === 0) {\n    btn.props.handler(\"Countdown\");\n    startFunction(btn);\n    return;\n  }\n\n  btn.props.handler(\"StopStream\"); //stopFunction();\n}\n\nfunction startFunction(btn) {\n  btn.props.currentState.almostStreaming = true; //btn.props.timeStartPressed = Date.now();\n}\n\nclass Diagnosis extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {};\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 4\n      }\n    }, this.props.currentState.showModalDiagnosis && /*#__PURE__*/React.createElement(ModalDiagnosis, {\n      handlerSuper: () => {\n        this.props.handler(\"closeDiagnosis\");\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 52\n      }\n    }));\n  }\n\n}\n\nclass ComponentsMain extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {};\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 4\n      }\n    }, this.props.currentState.showStartBtn && /*#__PURE__*/React.createElement(Button, {\n      color: \"primary\",\n      onClick: () => startStopFunction(this),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 45\n      }\n    }, this.props.currentState.textMainBtn), this.props.currentState.showCaptureBtn && /*#__PURE__*/React.createElement(Button, {\n      color: \"primary\",\n      disabled: this.props.currentState.disableBtnCapture,\n      onClick: () => this.props.captureScreenshot(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 47\n      }\n    }, \"Capture Screenshot\"), this.props.currentState.showProgressBar && /*#__PURE__*/React.createElement(Progress, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 48\n      }\n    }));\n  }\n\n}\n\nclass InferenceUI extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      current: \"SelectingSource\",\n      textMainBtn: \"Start\",\n      showStartBtn: false,\n      showCaptureBtn: false,\n      showVideoSelect: false,\n      showProgressBar: false,\n      showModalScreenshots: false,\n      //if requested\n      showModalDiagnosis: false,\n      disableBtnCapture: false,\n      streaming: false,\n      almostStreaming: false,\n      timeStartPressed: 0,\n      triggerCaptureScreenshot: false\n    };\n    this.child = React.createRef();\n    this.countdownFrom = 10;\n  }\n\n  async handler(nextState) {\n    console.log(\"hanfler\");\n    await this.setState({\n      current: nextState\n    });\n    this.showWeas();\n  }\n\n  showWeas() {\n    console.log(\"estado en switch: \" + this.state.current);\n\n    switch (this.state.current) {\n      case 'OnConnection':\n        this.setState({\n          textMainBtn: \"Start\",\n          showStartBtn: true,\n          showCaptureBtn: true,\n          showVideoSelect: false,\n          showProgressBar: false,\n          showModalScreenshots: true,\n          //if requested\n          showModalDiagnosis: false,\n          disableBtnCapture: false,\n          streaming: false,\n          almostStreaming: false\n        });\n        break;\n\n      case 'Countdown':\n        this.setState({\n          textMainBtn: \"Stop\",\n          showStartBtn: true,\n          showCaptureBtn: true,\n          showVideoSelect: false,\n          showProgressBar: true,\n          showModalScreenshots: false,\n          //if requested\n          showModalDiagnosis: false,\n          disableBtnCapture: true,\n          streaming: false,\n          almostStreaming: true,\n          timeStartPressed: Date.now()\n        });\n        break;\n\n      case 'Streaming':\n        this.setState({\n          textMainBtn: \"Stop\",\n          showStartBtn: true,\n          showCaptureBtn: true,\n          showVideoSelect: false,\n          showProgressBar: true,\n          showModalScreenshots: false,\n          //if requested\n          showModalDiagnosis: false,\n          disableBtnCapture: false,\n          streaming: true,\n          almostStreaming: false\n        });\n        break;\n\n      case 'StopStream':\n        this.setState({\n          textMainBtn: \"Start\",\n          showStartBtn: true,\n          showCaptureBtn: true,\n          showVideoSelect: false,\n          showProgressBar: true,\n          showModalScreenshots: false,\n          //if requested\n          showModalDiagnosis: false,\n          disableBtnCapture: true,\n          streaming: false,\n          almostStreaming: true\n        });\n        break;\n\n      case 'Screenshots':\n        this.setState({\n          almostStreaming: true,\n          showModalScreenshots: true\n        });\n        break;\n\n      case 'closeDiagnosis':\n        this.setState({\n          showModalDiagnosis: false\n        });\n        break;\n\n      default:\n        console.log('State not defined');\n    }\n  }\n\n  captureScreenshot() {\n    this.child.current.captureScreenshot();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(Container, {\n      id: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(WebcamStream, {\n      id: \"WebcamStream\",\n      currentState: this.state,\n      handler: nextState => this.handler(nextState),\n      countdownFrom: this.countdownFrom,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 415,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(ComponentsMain, {\n      currentState: this.state,\n      handler: nextState => this.handler(nextState),\n      captureScreenshot: () => this.captureScreenshot(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 416,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(Screenshots, {\n      currentState: this.state,\n      handler: nextState => this.handler(nextState),\n      ref: this.child,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 417,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(Diagnosis, {\n      currentState: this.state,\n      handler: nextState => this.handler(nextState),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 418,\n        columnNumber: 7\n      }\n    }));\n  }\n\n}\n\nexport default InferenceUI;","map":{"version":3,"sources":["/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/InferenceUI.js"],"names":["Container","Button","Modal","ModalHeader","ModalBody","ModalFooter","Progress","Spinner","React","useState","WebcamStream","Component","constructor","props","state","isVideoLoading","videoTag","createRef","canvasPreview","selectVideoSrc","tick","bind","componentDidMount","navigator","mediaDevices","enumerateDevices","then","deviceInfos","i","length","deviceInfo","option","document","createElement","value","deviceId","kind","text","label","current","appendChild","getUserMedia","video","facingMode","stream","srcObject","requestAnimationFrame","window","checkVideoState","setInterval","readyState","HAVE_ENOUGH_DATA","clearInterval","setState","canvasPreviewElement","getContext","height","videoHeight","width","videoWidth","drawImage","currentState","almostStreaming","font","countdown","render","display","console","log","getElementById","remove","handler","canvas","el","context","countdownFrom","Math","trunc","timeStartPressed","Date","now","beginPath","arc","PI","fillStyle","fill","fillText","toString","streaming","Carousel","require","ModalDiagnosis","className","modal","setModal","toggle","handlerSuper","position","margin","ModalScreenshots","data","map","slide","src","Screenshots","captureScreenshot","querySelector","imgAsDataURL","toDataURL","newSlidesData","slidesData","concat","lastScreenshotID","btnsCarousel","getElementsByClassName","style","thumbs","onclick","showModalScreenshots","modalOn","backgroundColor","startStopFunction","btn","textMainBtn","localeCompare","startFunction","Diagnosis","showModalDiagnosis","ComponentsMain","showStartBtn","showCaptureBtn","disableBtnCapture","showProgressBar","InferenceUI","showVideoSelect","triggerCaptureScreenshot","child","nextState","showWeas"],"mappings":";AAAA,OAAO,mBAAP;AACA,SAAQA,SAAR,EAAmBC,MAAnB,EAA2BC,KAA3B,EAAkCC,WAAlC,EAA+CC,SAA/C,EAA0DC,WAA1D,EAAuEC,QAAvE,EAAiFC,OAAjF,QACW,YADX;AAEA,OAAOC,KAAP,IAAeC,QAAf,QAA6B,OAA7B,C,CACA;AACA;;AACA,OAAO,uDAAP;;AAGA,MAAMC,YAAN,SAA2BF,KAAK,CAACG,SAAjC,CAA2C;AACzCC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AACA,SAAKC,KAAL,GAAa;AACXC,MAAAA,cAAc,EAAE;AADL,KAAb;AAIA,SAAKC,QAAL,GAAgBR,KAAK,CAACS,SAAN,EAAhB;AACA,SAAKC,aAAL,GAAqBV,KAAK,CAACS,SAAN,EAArB;AACF,SAAKE,cAAL,GAAsBX,KAAK,CAACS,SAAN,EAAtB;AACE,SAAKG,IAAL,GAAY,KAAKA,IAAL,CAAUC,IAAV,CAAe,IAAf,CAAZ;AACD;;AACDC,EAAAA,iBAAiB,GAAG;AAClBC,IAAAA,SAAS,CAACC,YAAV,CACDC,gBADC,GAEDC,IAFC,CAEKC,WAAW,IAAI;AACpB,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,KAAKD,WAAW,CAACE,MAAlC,EAA0C,EAAED,CAA5C,EAA+C;AAC9C,cAAME,UAAU,GAAGH,WAAW,CAACC,CAAD,CAA9B;AACA,cAAMG,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf;AACAF,QAAAA,MAAM,CAACG,KAAP,GAAeJ,UAAU,CAACK,QAA1B;;AACA,YAAIL,UAAU,CAACM,IAAX,KAAoB,YAAxB,EAAsC;AACrCL,UAAAA,MAAM,CAACM,IAAP,GAAcP,UAAU,CAACQ,KAAX,IAAoB,aAChC,KAAKnB,cAAL,CAAoBoB,OAApB,CAA4BV,MAA5B,GAAqC,CADL,CAAlC;AAEA,eAAKV,cAAL,CAAoBoB,OAApB,CAA4BC,WAA5B,CAAwCT,MAAxC;AACA;AACD;AACF,KAbC,EAcDL,IAdC,CAcIH,SAAS,CAACC,YAAV,CAEDiB,YAFC,CAEY;AAAEC,MAAAA,KAAK,EAAE;AAAEC,QAAAA,UAAU,EAAE;AAAd;AAAT,KAFZ,EAGDjB,IAHC,CAGIkB,MAAM,IAAI;AACd,WAAK5B,QAAL,CAAcuB,OAAd,CAAsBM,SAAtB,GAAkCD,MAAlC;AACAE,MAAAA,qBAAqB,CAAC,KAAK1B,IAAN,CAArB;AACA2B,MAAAA,MAAM,CAACH,MAAP,GAAgBA,MAAhB;AACD,KAPC,CAdJ;AAuBD;;AAGDxB,EAAAA,IAAI,GAAG;AACL,UAAMsB,KAAK,GAAG,KAAK1B,QAAL,CAAcuB,OAA5B;AAEA,UAAMS,eAAe,GAAGC,WAAW,CAAC,MAAM;AACxC,UAAIP,KAAK,CAACQ,UAAN,KAAqBR,KAAK,CAACS,gBAA/B,EAAiD;AAC/CC,QAAAA,aAAa,CAACJ,eAAD,CAAb;AAEA,aAAKK,QAAL,CAAc;AAAEtC,UAAAA,cAAc,EAAE;AAAlB,SAAd;AAEE,cAAMuC,oBAAoB,GAAG,KAAKpC,aAAL,CAAmBqB,OAAhD;AACA,cAAMrB,aAAa,GAAGoC,oBAAoB,CAACC,UAArB,CAAgC,IAAhC,CAAtB;AAEAD,QAAAA,oBAAoB,CAACE,MAArB,GAA8Bd,KAAK,CAACe,WAApC;AACAH,QAAAA,oBAAoB,CAACI,KAArB,GAA6BhB,KAAK,CAACiB,UAAnC;AACAzC,QAAAA,aAAa,CAAC0C,SAAd,CACElB,KADF,EAEE,CAFF,EAGE,CAHF,EAIEY,oBAAoB,CAACI,KAJvB,EAKEJ,oBAAoB,CAACE,MALvB;;AAOL,YAAG,KAAK3C,KAAL,CAAWgD,YAAX,CAAwBC,eAA3B,EAA2C;AAC1C5C,UAAAA,aAAa,CAAC6C,IAAd,GAAqB,aAArB;AACAC,UAAAA,SAAS,CAAC9C,aAAD,EAAe,IAAf,CAAT;AACA;;AACE4B,QAAAA,qBAAqB,CAAC,KAAK1B,IAAN,CAArB;AACD;AACF,KAxBkC,EAwBhC,EAxBgC,CAAnC;AAyBD;;AAED6C,EAAAA,MAAM,GAAG;AACP,UAAM;AAAElD,MAAAA;AAAF,QAAqB,KAAKD,KAAhC;AAEA,wBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AACE,MAAA,GAAG,EAAE,KAAKE,QADZ;AAEE,MAAA,KAAK,EAAC,KAFR;AAGE,MAAA,MAAM,EAAC,KAHT;AAIE,MAAA,QAAQ,MAJV;AAKE,MAAA,KAAK,EAAE;AAAEkD,QAAAA,OAAO,EAAE;AAAX,OALT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,EASG,CAACnD,cAAD,iBAAmB;AAAQ,MAAA,GAAG,EAAE,KAAKG,aAAlB;AAAiC,MAAA,EAAE,EAAC,eAApC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MATtB,EAWGH,cAAc,iBAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qDAXrB,eAYF;AAAK,MAAA,EAAE,EAAC,gBAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACC;AAAQ,MAAA,GAAG,EAAE,KAAKI,cAAlB;AACI,MAAA,KAAK,EAAE;AAACuC,QAAAA,KAAK,EAAE;AAAR,OADX;AAEI,MAAA,EAAE,EAAC,aAFP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADD,eAMC,oBAAC,MAAD;AAAQ,MAAA,KAAK,EAAC,SAAd;AAAwB,MAAA,OAAO,EAAE,MAAI;AAChCS,QAAAA,OAAO,CAACC,GAAR,CAAY,KAAKvD,KAAjB;AACAmB,QAAAA,QAAQ,CAACqC,cAAT,CAAwB,gBAAxB,EAA0CC,MAA1C;AAEA,aAAKzD,KAAL,CAAW0D,OAAX,CAAmB,cAAnB;AACJ,OALD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAND,CAZE,CADF;AA6BD;;AArGwC;;AAuG3C,SAASP,SAAT,CAAmBQ,MAAnB,EAA0BC,EAA1B,EAA6B;AAC5B,MAAIC,OAAO,GAAGF,MAAd;AACA,MAAIR,SAAS,GAAGS,EAAE,CAAC5D,KAAH,CAAS8D,aAAT,GAAwBC,IAAI,CAACC,KAAL,CAAW,CAAC,CAACJ,EAAE,CAAC5D,KAAH,CAASgD,YAAT,CAAsBiB,gBAAvB,GAA0CC,IAAI,CAACC,GAAL,EAA3C,IAAuD,IAAlE,CAAxC;AACCN,EAAAA,OAAO,CAACO,SAAR;AACAP,EAAAA,OAAO,CAACQ,GAAR,CAAY,GAAZ,EAAiB,GAAjB,EAAsB,GAAtB,EAA2B,CAA3B,EAA8B,IAAIN,IAAI,CAACO,EAAvC;AACAT,EAAAA,OAAO,CAACU,SAAR,GAAoB,0BAApB;AAA+C;AAC/CV,EAAAA,OAAO,CAACW,IAAR;AACAX,EAAAA,OAAO,CAACO,SAAR;AACAP,EAAAA,OAAO,CAACU,SAAR,GAAoB,OAApB;;AACA,MAAGpB,SAAS,IAAI,EAAhB,EAAmB;AACjBU,IAAAA,OAAO,CAACY,QAAR,CAAiBtB,SAAS,CAACuB,QAAV,CAAmB,EAAnB,CAAjB,EAAwC,GAAxC,EAA4C,GAA5C;AACD,GAFD,MAEM,IAAGvB,SAAS,IAAI,CAAhB,EAAkB;AACtBU,IAAAA,OAAO,CAACY,QAAR,CAAiBtB,SAAS,CAACuB,QAAV,CAAmB,EAAnB,CAAjB,EAAwC,GAAxC,EAA4C,GAA5C,EAAgD,GAAhD;AACD;;AAEDb,EAAAA,OAAO,CAACW,IAAR;;AACA,MAAIrB,SAAS,GAAI,CAAjB,EAAmB;AACjBS,IAAAA,EAAE,CAAC5D,KAAH,CAASgD,YAAT,CAAsBC,eAAtB,GAAwC,KAAxC;AACAW,IAAAA,EAAE,CAAC5D,KAAH,CAASgD,YAAT,CAAsB2B,SAAtB,GAAkC,IAAlC;AACFf,IAAAA,EAAE,CAAC5D,KAAH,CAAS0D,OAAT,CAAiB,WAAjB;AACC;AAEF;;AACD,IAAIkB,QAAQ,GAAGC,OAAO,CAAC,2BAAD,CAAP,CAAqCD,QAApD;;AACA,MAAME,cAAc,GAAG9E,KAAD,IAAW;AAC/B,QAAM;AACJ+E,IAAAA;AADI,MAEF/E,KAFJ;AAIA,QAAM,CAACgF,KAAD,EAAQC,QAAR,IAAoBrF,QAAQ,CAAC,IAAD,CAAlC;;AAEA,QAAMsF,MAAM,GAAG,MAAM;AACpBD,IAAAA,QAAQ,CAAC,CAACD,KAAF,CAAR;AACDhF,IAAAA,KAAK,CAACmF,YAAN;AACA,GAHA;;AAIA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,KAAD;AAAO,IAAA,MAAM,EAAEH,KAAf;AAAsB,IAAA,MAAM,EAAEE,MAA9B;AAAsC,IAAA,SAAS,EAAEH,SAAjD;AAA4D,IAAA,IAAI,EAAE,IAAlE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,WAAD;AAAa,IAAA,MAAM,EAAEG,MAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADF,eAEE,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACH,oBAAC,OAAD;AAAS,IAAA,KAAK,EAAC,MAAf;AAAsB,IAAA,KAAK,EAAE;AAAEE,MAAAA,QAAQ,EAAE,UAAZ;AAAuBC,MAAAA,MAAM,EAAE;AAA/B,KAA7B;AAAsE,IAAA,IAAI,EAAE,IAA5E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADG,CAFF,CADF,CADF;AAUD,CArBD;;AAuBA,MAAMC,gBAAgB,GAAItF,KAAD,IAAW;AAClC,QAAM;AACJ+E,IAAAA,SADI;AAEJQ,IAAAA;AAFI,MAGFvF,KAHJ;AAIA,QAAM,CAACgF,KAAD,EAAQC,QAAR,IAAoBrF,QAAQ,CAAC,IAAD,CAAlC;;AAEA,QAAMsF,MAAM,GAAG,MAAM;AACnBD,IAAAA,QAAQ,CAAC,CAACD,KAAF,CAAR;AACFhF,IAAAA,KAAK,CAAC0D,OAAN;AACC,GAHD;;AAIAJ,EAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,KAAD;AAAO,IAAA,MAAM,EAAEyB,KAAf;AAAsB,IAAA,MAAM,EAAEE,MAA9B;AAAsC,IAAA,SAAS,EAAEH,SAAjD;AAA4D,IAAA,IAAI,EAAE,IAAlE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,WAAD;AAAa,IAAA,MAAM,EAAEG,MAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADF,eAEE,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACA,oBAAC,QAAD;AAAU,IAAA,UAAU,EAAE,IAAtB;AAA4B,IAAA,YAAY,EAAE,CAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGK,IAAI,CAACC,GAAL,CAAUC,KAAD,iBACR;AAAK,IAAA,GAAG,EAAE,CAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAK,IAAA,SAAS,EAAC,mBAAf;AAAmC,IAAA,GAAG,EAAEA,KAAK,CAACC,GAA9C;AAAmD,IAAA,GAAG,EAAC,OAAvD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADD,CADH,CADA,CAFF,eAWE,oBAAC,WAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAXF,CADF,CADF;AAkBD,CA9BD;;AA+BA,MAAMC,WAAN,SAA0BhG,KAAK,CAACG,SAAhC,CAAyC;AACvCC,EAAAA,WAAW,CAACC,KAAD,EAAO;AAChB,UAAMA,KAAN;;AADgB,SASnB4F,iBATmB,GASC,YAAY;AAC/B,UAAIjC,MAAM,GAAGxC,QAAQ,CAAC0E,aAAT,CAAuB,gBAAvB,CAAb;AACA,UAAIC,YAAY,GAAGnC,MAAM,CAACoC,SAAP,CAAiB,YAAjB,EAA8B,CAA9B,CAAnB;AACE,UAAIC,aAAa,GAAG,CAAC;AAACN,QAAAA,GAAG,EAAEI;AAAN,OAAD,CAApB;AACF,WAAKtD,QAAL,CAAc;AAACyD,QAAAA,UAAU,EAAE,KAAKhG,KAAL,CAAWgG,UAAX,CAAsBC,MAAtB,CAA6BF,aAA7B;AAAb,OAAd;AACA,YAAM,KAAKxD,QAAL,CAAc;AAAC2D,QAAAA,gBAAgB,EAAE,KAAKlG,KAAL,CAAWkG,gBAAX,GAA4B;AAA/C,OAAd,CAAN;AACA,UAAIC,YAAY,GAAGjF,QAAQ,CAACkF,sBAAT,CAAgC,eAAhC,CAAnB;AACAlF,MAAAA,QAAQ,CAAC0E,aAAT,CAAuB,kBAAvB,EAA2CS,KAA3C,CAAiDjD,OAAjD,GAA2D,MAA3D;AACC,UAAIkD,MAAM,GAAGpF,QAAQ,CAACkF,sBAAT,CAAgC,OAAhC,CAAb;;AACDE,MAAAA,MAAM,CAACA,MAAM,CAACvF,MAAP,GAAc,CAAf,CAAN,CAAwBwF,OAAxB,GAAkC,YAAW;AAC5C,YAAG,KAAKxG,KAAL,CAAWgD,YAAX,CAAwByD,oBAA3B,EAAgD;AAC/C,eAAKzG,KAAL,CAAW0D,OAAX,CAAmB,aAAnB;AACA,eAAKzD,KAAL,CAAWyG,OAAX,GAAqB,IAArB;AACA;AACD,OALD;;AAMApD,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAO,KAAKvD,KAAL,CAAWgD,YAAX,CAAwBtB,OAA3C;;AACA,UAAG;AACF0E,QAAAA,YAAY,CAAC,CAAD,CAAZ,CAAgBE,KAAhB,CAAsBK,eAAtB,GAAuC,OAAvC;AACAP,QAAAA,YAAY,CAAC,CAAD,CAAZ,CAAgBE,KAAhB,CAAsBK,eAAtB,GAAuC,OAAvC;AACA,OAHD,CAIA,MAAK,CAEJ;AAEF,KAjCmB;;AAEhB,SAAK1G,KAAL,GAAa;AACXkG,MAAAA,gBAAgB,EAAE,CADP;AAEXO,MAAAA,OAAO,EAAE,KAFE;AAGXT,MAAAA,UAAU,EAAE;AAHD,KAAb;AAKD;;AA2BF7C,EAAAA,MAAM,GAAE;AACL,wBACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,KAAKnD,KAAL,CAAWyG,OAAX,iBAAsB,oBAAC,gBAAD;AAAkB,MAAA,OAAO,EAAE,MAAI;AAAC,aAAKlE,QAAL,CAAc;AAACkE,UAAAA,OAAO,EAAC;AAAT,SAAd;AAA+B,OAA/D;AAAiE,MAAA,IAAI,EAAE,KAAKzG,KAAL,CAAWgG,UAAlF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADxB,eAEK,oBAAC,QAAD;AAAU,MAAA,UAAU,EAAE,IAAtB;AAA4B,MAAA,YAAY,EAAE,KAAKhG,KAAL,CAAWkG,gBAArD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG,KAAKlG,KAAL,CAAWgG,UAAX,CAAsBT,GAAtB,CAA2BC,KAAD,iBACzB;AAAK,MAAA,GAAG,EAAE,KAAKxF,KAAL,CAAWkG,gBAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,SAAS,EAAC,mBAAf;AAAmC,MAAA,GAAG,EAAEV,KAAK,CAACC,GAA9C;AAAmD,MAAA,GAAG,EAAC,EAAvD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CADD,CADH,CAFL,CADC;AAYF;;AAhDuC;;AAmDzC,SAASkB,iBAAT,CAA2BC,GAA3B,EAA+B;AAC7B,MAAIA,GAAG,CAAC7G,KAAJ,CAAUgD,YAAV,CAAuB8D,WAAvB,CAAmCC,aAAnC,CAAiD,OAAjD,MAA8D,CAAlE,EAAoE;AACpEF,IAAAA,GAAG,CAAC7G,KAAJ,CAAU0D,OAAV,CAAkB,WAAlB;AACEsD,IAAAA,aAAa,CAACH,GAAD,CAAb;AACA;AACD;;AACFA,EAAAA,GAAG,CAAC7G,KAAJ,CAAU0D,OAAV,CAAkB,YAAlB,EAN8B,CAO7B;AACD;;AACD,SAASsD,aAAT,CAAuBH,GAAvB,EAA2B;AAE1BA,EAAAA,GAAG,CAAC7G,KAAJ,CAAUgD,YAAV,CAAuBC,eAAvB,GAAyC,IAAzC,CAF0B,CAGzB;AAED;;AACD,MAAMgE,SAAN,SAAwBtH,KAAK,CAACG,SAA9B,CAAuC;AACtCC,EAAAA,WAAW,CAACC,KAAD,EAAO;AACjB,UAAMA,KAAN;AACA,SAAKC,KAAL,GAAa,EAAb;AAGA;;AAEDmD,EAAAA,MAAM,GAAE;AACP,wBACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,KAAKpD,KAAL,CAAWgD,YAAX,CAAwBkE,kBAAxB,iBAA8C,oBAAC,cAAD;AAAgB,MAAA,YAAY,EAAE,MAAI;AAAC,aAAKlH,KAAL,CAAW0D,OAAX,CAAmB,gBAAnB;AAAqC,OAAxE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADhD,CADD;AAKA;;AAdqC;;AAgBvC,MAAMyD,cAAN,SAA6BxH,KAAK,CAACG,SAAnC,CAA4C;AAC3CC,EAAAA,WAAW,CAACC,KAAD,EAAO;AACjB,UAAMA,KAAN;AACA,SAAKC,KAAL,GAAa,EAAb;AAEA;;AAGDmD,EAAAA,MAAM,GAAE;AACP,wBACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,KAAKpD,KAAL,CAAWgD,YAAX,CAAwBoE,YAAxB,iBAAwC,oBAAC,MAAD;AAAQ,MAAA,KAAK,EAAC,SAAd;AAAwB,MAAA,OAAO,EAAE,MAAMR,iBAAiB,CAAC,IAAD,CAAxD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAiE,KAAK5G,KAAL,CAAWgD,YAAX,CAAwB8D,WAAzF,CADzC,EAEC,KAAK9G,KAAL,CAAWgD,YAAX,CAAwBqE,cAAxB,iBAA0C,oBAAC,MAAD;AAAQ,MAAA,KAAK,EAAC,SAAd;AAAwB,MAAA,QAAQ,EAAE,KAAKrH,KAAL,CAAWgD,YAAX,CAAwBsE,iBAA1D;AAA8E,MAAA,OAAO,EAAE,MAAM,KAAKtH,KAAL,CAAW4F,iBAAX,EAA7F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAA8H,oBAA9H,CAF3C,EAGC,KAAK5F,KAAL,CAAWgD,YAAX,CAAwBuE,eAAxB,iBAA2C,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAH5C,CADD;AAOA;;AAhB0C;;AAkB5C,MAAMC,WAAN,SAA0B7H,KAAK,CAACG,SAAhC,CAA0C;AACtCC,EAAAA,WAAW,CAACC,KAAD,EAAO;AACd,UAAMA,KAAN;AACA,SAAKC,KAAL,GAAa;AACbyB,MAAAA,OAAO,EAAE,iBADI;AAGhBoF,MAAAA,WAAW,EAAE,OAHG;AAIhBM,MAAAA,YAAY,EAAE,KAJE;AAKhBC,MAAAA,cAAc,EAAE,KALA;AAMhBI,MAAAA,eAAe,EAAE,KAND;AAOhBF,MAAAA,eAAe,EAAE,KAPD;AAQhBd,MAAAA,oBAAoB,EAAE,KARN;AAQa;AAC7BS,MAAAA,kBAAkB,EAAE,KATJ;AAUhBI,MAAAA,iBAAiB,EAAE,KAVH;AAYX3C,MAAAA,SAAS,EAAE,KAZA;AAaX1B,MAAAA,eAAe,EAAE,KAbN;AAehBgB,MAAAA,gBAAgB,EAAE,CAfF;AAiBhByD,MAAAA,wBAAwB,EAAE;AAjBV,KAAb;AAmBL,SAAKC,KAAL,GAAahI,KAAK,CAACS,SAAN,EAAb;AACA,SAAK0D,aAAL,GAAqB,EAArB;AACE;;AAEH,QAAMJ,OAAN,CAAckE,SAAd,EAAwB;AACvBtE,IAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AACA,UAAM,KAAKf,QAAL,CAAc;AAACd,MAAAA,OAAO,EAAEkG;AAAV,KAAd,CAAN;AACA,SAAKC,QAAL;AACA;;AAGAA,EAAAA,QAAQ,GAAE;AAETvE,IAAAA,OAAO,CAACC,GAAR,CAAY,uBAAuB,KAAKtD,KAAL,CAAWyB,OAA9C;;AACC,YAAO,KAAKzB,KAAL,CAAWyB,OAAlB;AACE,WAAK,cAAL;AACE,aAAKc,QAAL,CAAc;AACjBsE,UAAAA,WAAW,EAAE,OADI;AAEjBM,UAAAA,YAAY,EAAE,IAFG;AAGjBC,UAAAA,cAAc,EAAE,IAHC;AAIjBI,UAAAA,eAAe,EAAE,KAJA;AAKjBF,UAAAA,eAAe,EAAE,KALA;AAMjBd,UAAAA,oBAAoB,EAAE,IANL;AAMW;AAC5BS,UAAAA,kBAAkB,EAAE,KAPH;AAQjBI,UAAAA,iBAAiB,EAAE,KARF;AAUjB3C,UAAAA,SAAS,EAAE,KAVM;AAWjB1B,UAAAA,eAAe,EAAE;AAXA,SAAd;AAaJ;;AACD,WAAK,WAAL;AACC,aAAKT,QAAL,CAAc;AACbsE,UAAAA,WAAW,EAAE,MADA;AAEbM,UAAAA,YAAY,EAAE,IAFD;AAGbC,UAAAA,cAAc,EAAE,IAHH;AAIbI,UAAAA,eAAe,EAAE,KAJJ;AAKbF,UAAAA,eAAe,EAAE,IALJ;AAMbd,UAAAA,oBAAoB,EAAE,KANT;AAMgB;AAC7BS,UAAAA,kBAAkB,EAAE,KAPP;AAQbI,UAAAA,iBAAiB,EAAE,IARN;AAUb3C,UAAAA,SAAS,EAAE,KAVE;AAWb1B,UAAAA,eAAe,EAAE,IAXJ;AAabgB,UAAAA,gBAAgB,EAAEC,IAAI,CAACC,GAAL;AAbL,SAAd;AAeC;;AACF,WAAK,WAAL;AACC,aAAK3B,QAAL,CAAc;AACbsE,UAAAA,WAAW,EAAE,MADA;AAEbM,UAAAA,YAAY,EAAE,IAFD;AAGbC,UAAAA,cAAc,EAAE,IAHH;AAIbI,UAAAA,eAAe,EAAE,KAJJ;AAKbF,UAAAA,eAAe,EAAE,IALJ;AAMbd,UAAAA,oBAAoB,EAAE,KANT;AAMgB;AAC7BS,UAAAA,kBAAkB,EAAE,KAPP;AAQbI,UAAAA,iBAAiB,EAAE,KARN;AAUb3C,UAAAA,SAAS,EAAE,IAVE;AAWb1B,UAAAA,eAAe,EAAE;AAXJ,SAAd;AAcA;;AACD,WAAK,YAAL;AACC,aAAKT,QAAL,CAAc;AACbsE,UAAAA,WAAW,EAAE,OADA;AAEbM,UAAAA,YAAY,EAAE,IAFD;AAGbC,UAAAA,cAAc,EAAE,IAHH;AAIbI,UAAAA,eAAe,EAAE,KAJJ;AAKbF,UAAAA,eAAe,EAAE,IALJ;AAMbd,UAAAA,oBAAoB,EAAE,KANT;AAMgB;AAC7BS,UAAAA,kBAAkB,EAAE,KAPP;AAQbI,UAAAA,iBAAiB,EAAE,IARN;AAUb3C,UAAAA,SAAS,EAAE,KAVE;AAWb1B,UAAAA,eAAe,EAAE;AAXJ,SAAd;AAaA;;AACD,WAAK,aAAL;AACC,aAAKT,QAAL,CAAc;AACbS,UAAAA,eAAe,EAAE,IADJ;AAEbwD,UAAAA,oBAAoB,EAAE;AAFT,SAAd;AAIA;;AACD,WAAK,gBAAL;AACC,aAAKjE,QAAL,CAAc;AACb0E,UAAAA,kBAAkB,EAAE;AADP,SAAd;AAGA;;AACD;AACC5D,QAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AA5EA;AA+EF;;AAEDqC,EAAAA,iBAAiB,GAAE;AAClB,SAAK+B,KAAL,CAAWjG,OAAX,CAAmBkE,iBAAnB;AACA;;AACCxC,EAAAA,MAAM,GAAG;AACP,wBACD,oBAAC,SAAD;AAAW,MAAA,EAAE,EAAC,WAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAEC,oBAAC,YAAD;AAAc,MAAA,EAAE,EAAC,cAAjB;AAAgC,MAAA,YAAY,EAAE,KAAKnD,KAAnD;AAA0D,MAAA,OAAO,EAAG2H,SAAD,IAAa,KAAKlE,OAAL,CAAakE,SAAb,CAAhF;AAAyG,MAAA,aAAa,EAAE,KAAK9D,aAA7H;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFD,eAGC,oBAAC,cAAD;AAAgB,MAAA,YAAY,EAAE,KAAK7D,KAAnC;AAA0C,MAAA,OAAO,EAAG2H,SAAD,IAAa,KAAKlE,OAAL,CAAakE,SAAb,CAAhE;AAAyF,MAAA,iBAAiB,EAAE,MAAI,KAAKhC,iBAAL,EAAhH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAHD,eAIC,oBAAC,WAAD;AAAa,MAAA,YAAY,EAAE,KAAK3F,KAAhC;AAAuC,MAAA,OAAO,EAAG2H,SAAD,IAAa,KAAKlE,OAAL,CAAakE,SAAb,CAA7D;AAAsF,MAAA,GAAG,EAAE,KAAKD,KAAhG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAJD,eAKC,oBAAC,SAAD;AAAW,MAAA,YAAY,EAAE,KAAK1H,KAA9B;AAAqC,MAAA,OAAO,EAAG2H,SAAD,IAAa,KAAKlE,OAAL,CAAakE,SAAb,CAA3D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MALD,CADC;AAWD;;AApIqC;;AAuI1C,eAAeJ,WAAf","sourcesContent":["import './InferenceUI.css';\nimport {Container, Button, Modal, ModalHeader, ModalBody, ModalFooter, Progress, Spinner\n    } from 'reactstrap';\nimport React, {useState}from 'react';\n//import io from 'socket.io-client';\n//import WebcamStream from './WebcamStream.js'\nimport \"react-responsive-carousel/lib/styles/carousel.min.css\";\n\n\nclass WebcamStream extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isVideoLoading: true\n    };\n\n    this.videoTag = React.createRef();\n    this.canvasPreview = React.createRef();\n\t\tthis.selectVideoSrc = React.createRef();\n    this.tick = this.tick.bind(this);\n  }\n  componentDidMount() {\n    navigator.mediaDevices\n\t\t.enumerateDevices()\n\t\t.then( deviceInfos => {\n\t\t\t\tfor (let i = 0; i !== deviceInfos.length; ++i) {\n\t\t\t\t\tconst deviceInfo = deviceInfos[i];\n\t\t\t\t\tconst option = document.createElement('option');\n\t\t\t\t\toption.value = deviceInfo.deviceId;\n\t\t\t\t\tif (deviceInfo.kind === 'videoinput') {\n\t\t\t\t\t\toption.text = deviceInfo.label || 'camera ' +\n\t\t\t\t\t\t\t(this.selectVideoSrc.current.length + 1);\n\t\t\t\t\t\tthis.selectVideoSrc.current.appendChild(option);\n\t\t\t\t\t} \n\t\t\t\t}\n\t\t})\t\t\t\t \n\t\t.then(navigator.mediaDevices\n\n      .getUserMedia({ video: { facingMode: \"environment\" } })\n      .then(stream => {\n        this.videoTag.current.srcObject = stream;\n        requestAnimationFrame(this.tick);\n        window.stream = stream;\n      })\n\t\t);\n  }\n\n\n  tick() {\n    const video = this.videoTag.current;\n\n    const checkVideoState = setInterval(() => {\n      if (video.readyState === video.HAVE_ENOUGH_DATA) {\n        clearInterval(checkVideoState);\n\n        this.setState({ isVideoLoading: false });\n\n          const canvasPreviewElement = this.canvasPreview.current;\n          const canvasPreview = canvasPreviewElement.getContext(\"2d\");\n\n          canvasPreviewElement.height = video.videoHeight;\n          canvasPreviewElement.width = video.videoWidth;\n          canvasPreview.drawImage(\n            video,\n            0,\n            0,\n            canvasPreviewElement.width,\n            canvasPreviewElement.height\n          );\n\t\t\t\t\tif(this.props.currentState.almostStreaming){\n\t\t\t\t\t\tcanvasPreview.font = \"200px Arial\"\n\t\t\t\t\t\tcountdown(canvasPreview,this);\n\t\t\t\t\t}\n        requestAnimationFrame(this.tick);\n      }\n    }, 50);\n  }\n\n  render() {\n    const { isVideoLoading } = this.state;\n\n    return (\n      <div>\n        <video\n          ref={this.videoTag}\n          width=\"400\"\n          height=\"400\"\n          autoPlay\n          style={{ display: \"none\" }}\n        />\n\n        {!isVideoLoading && <canvas ref={this.canvasPreview} id=\"canvasPreview\" />}\n\n        {isVideoLoading && <p>Please wait while we load the video stream.</p>}\n\t\t\t\t<div id=\"videoSelectDiv\">\n\t\t\t\t\t<select ref={this.selectVideoSrc}\n\t\t\t\t\t\t\t\t\tstyle={{width: 300 }}\n\t\t\t\t\t\t\t\t\tid=\"videoSelect\"\n\t\t\t\t\t\t\t\n\t\t\t\t\t/>\n\t\t\t\t\t<Button color='primary' onClick={()=>{\n\t\t\t\t\t\t\t\t\t\tconsole.log(this.props);\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById(\"videoSelectDiv\").remove();\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tthis.props.handler(\"OnConnection\");\n\t\t\t\t\t}}>Ok</Button>\n\t\t\t\t</div>\n\n      </div>\n    );\n  }\n}\nfunction countdown(canvas,el){\n\tlet context = canvas;\t\n\tlet countdown = el.props.countdownFrom- Math.trunc((-el.props.currentState.timeStartPressed + Date.now())/1000);\n  context.beginPath();\n  context.arc(320, 240, 130, 0, 2 * Math.PI);\n  context.fillStyle = \"rgba(255, 255, 255, 0.8)\";;\n  context.fill();\n  context.beginPath();\n  context.fillStyle = \"black\";\n  if(countdown >= 10){\n    context.fillText(countdown.toString(10),200,315);\n  }else if(countdown >= 1){\n    context.fillText(countdown.toString(10),270,308,100);\n  }\n\n  context.fill();\n  if (countdown <  1){\n    el.props.currentState.almostStreaming = false;\n    el.props.currentState.streaming = true;\n\t\tel.props.handler(\"Streaming\");\n  }\n\t\n}\nvar Carousel = require('react-responsive-carousel').Carousel;\nconst ModalDiagnosis= (props) => {\n  const {\n    className\n  } = props;\n\n  const [modal, setModal] = useState(true);\n\n  const toggle = () => {\n  \tsetModal(!modal);\n\t\tprops.handlerSuper();\n\t}\n  return (\n    <div>\n      <Modal isOpen={modal} toggle={toggle} className={className} size={'xl'}>\n        <ModalHeader toggle={toggle}>Modal title</ModalHeader>\n        <ModalBody>\n\t\t\t\t\t<Spinner color=\"info\" style={{ position: 'absolute',margin: 'auto' }} size={'xl'}/>\n        </ModalBody>\n      </Modal>\n    </div>\n  );\n}\n\nconst ModalScreenshots = (props) => {\n  const {\n    className,\n    data,\t\n  } = props;\n  const [modal, setModal] = useState(true);\n\n  const toggle = () => {\n    setModal(!modal); \n\t\tprops.handler();\n  }\n \tconsole.log(\"sadsa\") \n  return (\n    <div>\n      <Modal isOpen={modal} toggle={toggle} className={className} size={'xl'}>\n        <ModalHeader toggle={toggle}>Modal title</ModalHeader>\n        <ModalBody>\n        <Carousel showArrows={true} selectedItem={0} >\n          {data.map((slide) =>\n            <div key={0}>\n              <img className=\"slick-slide-image\" src={slide.src} alt='Error' />\n            </div>\n          )}\n        </Carousel>\n        </ModalBody>\n        <ModalFooter>\n        </ModalFooter>\n      </Modal>\n    </div>\n  );\n}\nclass Screenshots extends React.Component{\n  constructor(props){\n    super(props);\n    this.state = {\n      lastScreenshotID: 0,\n      modalOn: false,\n      slidesData: []\n    };\n  }\n\n\tcaptureScreenshot = async () => {\n\t\tvar canvas = document.querySelector(\"#canvasPreview\");\n\t\tvar imgAsDataURL = canvas.toDataURL(\"image/jpeg\",1);\n    let newSlidesData = [{src: imgAsDataURL}];\n\t\tthis.setState({slidesData: this.state.slidesData.concat(newSlidesData)});\n\t\tawait this.setState({lastScreenshotID: this.state.lastScreenshotID+1});\n\t\tlet btnsCarousel = document.getElementsByClassName(\"control-arrow\");\n\t\tdocument.querySelector(\".carousel-slider\").style.display = 'none';\n\t  let thumbs = document.getElementsByClassName(\"thumb\");\n\t\tthumbs[thumbs.length-1].onclick = async() => {\n\t\t\tif(this.props.currentState.showModalScreenshots){\n\t\t\t\tthis.props.handler(\"Screenshots\")\n\t\t\t\tthis.state.modalOn = true;\n\t\t\t}\n\t\t};\t\n\t\tconsole.log(\"qq\" + this.props.currentState.current);\n\t\ttry{\n\t\t\tbtnsCarousel[2].style.backgroundColor= 'black';\n\t\t\tbtnsCarousel[3].style.backgroundColor= 'black';\n\t\t}\n\t\tcatch{\n\t\t\n\t\t}\n\n}\n\trender(){\n    return(\n\t\t\t<div>\n\t\t\t\t{this.state.modalOn && <ModalScreenshots handler={()=>{this.setState({modalOn:false})}} data={this.state.slidesData}/>}\n        <Carousel showArrows={true} selectedItem={this.state.lastScreenshotID} >\n          {this.state.slidesData.map((slide) =>\n            <div key={this.state.lastScreenshotID}>\n              <img className=\"slick-slide-image\" src={slide.src} alt='' />\n            </div>\n          )}\n        </Carousel>\n\t\t\t</div>\n    );\n\t}\n\n}\nfunction startStopFunction(btn){\n  if (btn.props.currentState.textMainBtn.localeCompare(\"Start\") === 0){\n\t\tbtn.props.handler(\"Countdown\");\n    startFunction(btn);\n    return;\n  }\n\tbtn.props.handler(\"StopStream\");\n  //stopFunction();\n}\nfunction startFunction(btn){\n\t\n\tbtn.props.currentState.almostStreaming = true;\n  //btn.props.timeStartPressed = Date.now();\n\n}\nclass Diagnosis extends React.Component{\n\tconstructor(props){\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t}\n\t\t\n\t}\n\n\trender(){\n\t\treturn(\n\t\t\t<div>\n\t\t\t\t{this.props.currentState.showModalDiagnosis && <ModalDiagnosis handlerSuper={()=>{this.props.handler(\"closeDiagnosis\")}}/>}\n\t\t\t</div>\n\t\t);\n\t}\n}\nclass ComponentsMain extends React.Component{\n\tconstructor(props){\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t}\n\t}\n  \n\n\trender(){\n\t\treturn(\n\t\t\t<div>\n\t\t\t{this.props.currentState.showStartBtn && <Button color=\"primary\" onClick={() => startStopFunction(this)}>{this.props.currentState.textMainBtn}</Button>}\n\t\t\t{this.props.currentState.showCaptureBtn && <Button color=\"primary\" disabled={this.props.currentState.disableBtnCapture}  onClick={() => this.props.captureScreenshot()}>{\"Capture Screenshot\"}</Button>}\n\t\t\t{this.props.currentState.showProgressBar && <Progress/>}\n\t\t\t</div>\n\t\t);\n\t}\n}\nclass InferenceUI extends React.Component {\n    constructor(props){\n        super(props);\n        this.state = {\n      \t\tcurrent: \"SelectingSource\",\n\n\t\t\t\t\ttextMainBtn: \"Start\",\n\t\t\t\t\tshowStartBtn: false,\n\t\t\t\t\tshowCaptureBtn: false,\n\t\t\t\t\tshowVideoSelect: false,\n\t\t\t\t\tshowProgressBar: false,\n\t\t\t\t\tshowModalScreenshots: false, //if requested\n\t\t\t\t\tshowModalDiagnosis: false,\n\t\t\t\t\tdisableBtnCapture: false,\n\n          streaming: false,\n          almostStreaming: false,          \n\n\t\t\t\t\ttimeStartPressed: 0,\n\n\t\t\t\t\ttriggerCaptureScreenshot: false\n        }\n\t\t\tthis.child = React.createRef();\n\t\t\tthis.countdownFrom = 10;\n    }\n\n\t\tasync handler(nextState){\n\t\t\tconsole.log(\"hanfler\");\n\t\t\tawait this.setState({current: nextState});\n\t\t\tthis.showWeas();\n\t\t} \n\n\n  \tshowWeas(){\n    \n\t\t  console.log(\"estado en switch: \" + this.state.current);\n    \tswitch(this.state.current){\n      \tcase 'OnConnection':\n        \tthis.setState({\n\t\t\t\t\t\ttextMainBtn: \"Start\",\n\t\t\t\t\t\tshowStartBtn: true,\n\t\t\t\t\t\tshowCaptureBtn: true,\n\t\t\t\t\t\tshowVideoSelect: false,\n\t\t\t\t\t\tshowProgressBar: false,\n\t\t\t\t\t\tshowModalScreenshots: true, //if requested\n\t\t\t\t\t\tshowModalDiagnosis: false,\n\t\t\t\t\t\tdisableBtnCapture: false,\n\n\t\t\t\t\t\tstreaming: false,\n\t\t\t\t\t\talmostStreaming: false,          \n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Countdown':\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\ttextMainBtn: \"Stop\",\n\t\t\t\t\t\tshowStartBtn: true,\n\t\t\t\t\t\tshowCaptureBtn: true,\n\t\t\t\t\t\tshowVideoSelect: false,\n\t\t\t\t\t\tshowProgressBar: true,\n\t\t\t\t\t\tshowModalScreenshots: false, //if requested\n\t\t\t\t\t\tshowModalDiagnosis: false,\n\t\t\t\t\t\tdisableBtnCapture: true,\n\n\t\t\t\t\t\tstreaming: false,\n\t\t\t\t\t\talmostStreaming: true,          \n\t\t\t\t\t\t\n\t\t\t\t\t\ttimeStartPressed: Date.now()\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\tcase 'Streaming':\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\ttextMainBtn: \"Stop\",\n\t\t\t\t\t\tshowStartBtn: true,\n\t\t\t\t\t\tshowCaptureBtn: true,\n\t\t\t\t\t\tshowVideoSelect: false,\n\t\t\t\t\t\tshowProgressBar: true,\n\t\t\t\t\t\tshowModalScreenshots: false, //if requested\n\t\t\t\t\t\tshowModalDiagnosis: false,\n\t\t\t\t\t\tdisableBtnCapture: false,\n\n\t\t\t\t\t\tstreaming: true,\n\t\t\t\t\t\talmostStreaming: false,          \n\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'StopStream':\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\ttextMainBtn: \"Start\",\n\t\t\t\t\t\tshowStartBtn: true,\n\t\t\t\t\t\tshowCaptureBtn: true,\n\t\t\t\t\t\tshowVideoSelect: false,\n\t\t\t\t\t\tshowProgressBar: true,\n\t\t\t\t\t\tshowModalScreenshots: false, //if requested\n\t\t\t\t\t\tshowModalDiagnosis: false,\n\t\t\t\t\t\tdisableBtnCapture: true,\n\n\t\t\t\t\t\tstreaming: false,\n\t\t\t\t\t\talmostStreaming: true,          \n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Screenshots':\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\talmostStreaming: true,          \n\t\t\t\t\t\tshowModalScreenshots: true,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'closeDiagnosis':\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\tshowModalDiagnosis: false\n\t\t\t\t\t});\t\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.log('State not defined');\n\n\t\t\t}\n\t\t}\n\n\t\tcaptureScreenshot(){\n\t\t\tthis.child.current.captureScreenshot();\n\t\t}\n    render() {\n      return (\n\t\t\t\t\t<Container id=\"container\">\n\t\t\t\t\t\t\n\t\t\t\t\t\t<WebcamStream id=\"WebcamStream\" currentState={this.state} handler={(nextState)=>this.handler(nextState)} countdownFrom={this.countdownFrom}/>\n\t\t\t\t\t\t<ComponentsMain currentState={this.state} handler={(nextState)=>this.handler(nextState)} captureScreenshot={()=>this.captureScreenshot()}/> \n\t\t\t\t\t\t<Screenshots currentState={this.state} handler={(nextState)=>this.handler(nextState)} ref={this.child} />\n\t\t\t\t\t\t<Diagnosis currentState={this.state} handler={(nextState)=>this.handler(nextState)}/>\n\t\t\t\t  </Container>\n\t\n        );\n        \n    }\n}\n\nexport default InferenceUI;\n"]},"metadata":{},"sourceType":"module"}