{"ast":null,"code":"var _jsxFileName = \"/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/WebcamStream/WebcamStream.js\";\nimport './WebcamStream.css';\nimport React from 'react';\nimport { Button, Alert, Progress } from 'reactstrap';\nimport { handleDataAvailable, setProgressBarColor, ctrlBtnFunction, countdown, urlToPromise, downloadScreenshots, downloadVideo, captureScreenshot } from './functions.js'; // Agregar variable para almacenar la hora en que se apretó el start.\n// Administrar el fullscreen desde acá ahora.\n\nclass WebcamStream extends React.Component {\n  constructor(props) {\n    super();\n    this.state = {\n      isVideoLoading: true\n    };\n    this.videoTag = React.createRef();\n    this.canvasPreview = React.createRef();\n    this.selectVideoSrc = React.createRef();\n    this.tick = this.tick.bind(this);\n    this.countdownFrom = 1;\n    this.timeStartPressed = null;\n    this.mediaRecorder = null;\n    this.recordedChunks = [];\n    this.videoRecorded = null;\n    this.mirrorCount = 0;\n  }\n\n  setStream() {\n    var selectVideoSrc = document.getElementById(\"videoSelectConf\"); // Falta cerrar el stream anterior antes de abrir uno nuevo.\n\n    navigator.mediaDevices.getUserMedia({\n      video: {\n        deviceId: selectVideoSrc.value ? {\n          exact: selectVideoSrc.value\n        } : undefined,\n        facingMode: \"enviroment\"\n      }\n    }).then(stream => {\n      this.videoTag.current.srcObject = stream;\n      requestAnimationFrame(this.tick);\n      window.stream = stream;\n      var options = {\n        mimeType: \"video/webm;codecs=vp8\"\n      };\n      this.mediaRecorder = new MediaRecorder(stream, options);\n    });\n  }\n\n  tick() {\n    const video = this.videoTag.current;\n    const checkVideoState = setInterval(() => {\n      if (video.readyState === video.HAVE_ENOUGH_DATA) {\n        clearInterval(checkVideoState);\n        this.setState({\n          isVideoLoading: false\n        });\n        const canvasPreviewElement = this.canvasPreview.current;\n\n        if (canvasPreviewElement) {\n          const canvasPreview = canvasPreviewElement.getContext(\"2d\");\n          canvasPreviewElement.height = video.videoHeight;\n          canvasPreviewElement.width = video.videoWidth;\n          canvasPreview.drawImage(video, 0, 0, canvasPreviewElement.width, canvasPreviewElement.height);\n\n          if (this.props.currentState.stateName.localeCompare(\"Countdown\") === 0) {\n            canvasPreview.font = \"200px Arial\";\n            countdown(canvasPreview, this);\n          }\n\n          requestAnimationFrame(this.tick);\n        }\n      }\n    }, 50);\n  }\n\n  startRecording() {\n    this.mediaRecorder.ondataavailable = handleDataAvailable(this);\n    this.mediaRecorder.start();\n    this.props.getVideoThumbnail(this.canvasPreview.current.toDataURL(\"image/jpeg\", 1));\n  }\n\n  stopRecording() {\n    this.mediaRecorder.stop();\n  }\n\n  downloadVideo() {\n    downloadVideo(this);\n  }\n\n  captureScreenshot() {\n    captureScreenshot(this);\n  }\n\n  downloadScreenshots() {\n    downloadScreenshots(this);\n  }\n\n  mirror() {\n    mirror(this);\n  }\n\n  componentDidMount() {\n    //initial message on canvas\n    let cnvs = document.getElementById(\"canvasMessage\");\n    cnvs.style.height = cnvs.clientWidth * 3 / 4 + \"px\";\n    cnvs.style.backgroundColor = \"black\";\n    var ctx = cnvs.getContext(\"2d\");\n    ctx.font = \"10px Arial\";\n    ctx.fillStyle = \"white\";\n    ctx.fillText(\"Seleccione un dispositivo de imagen en\", cnvs.width / 10, 3 * cnvs.height / 8);\n    ctx.fillText(\"el panel de  configuración.\", cnvs.width / 10, 4 * cnvs.height / 8);\n  }\n\n  render() {\n    const isVideoLoading = this.state.isVideoLoading;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"WebcamStream_Wrapper\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"video\", {\n      ref: this.videoTag,\n      autoPlay: true,\n      id: \"video\",\n      style: {\n        display: \"none\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 9\n      }\n    }), !isVideoLoading && /*#__PURE__*/React.createElement(\"div\", {\n      id: \"canvasDiv\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 13\n      }\n    }, this.props.currentState.canvasAlert && /*#__PURE__*/React.createElement(\"div\", {\n      id: \"alert\",\n      style: {\n        position: 'absolute',\n        zIndex: 2\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Alert, {\n      color: \"warning\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 19\n      }\n    }, \"Verifique el enfoque del dispositivo.\")), this.props.currentState.stateName.localeCompare(\"GetCon\") === 0 && /*#__PURE__*/React.createElement(\"div\", {\n      id: \"alert\",\n      style: {\n        position: 'absolute',\n        zIndex: 2\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Alert, {\n      color: \"info\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 19\n      }\n    }, \"Estableciendo conexi\\xF3n con el servidor.\")), this.props.currentState.renderCanvas && /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"canvas\", {\n      ref: this.canvasPreview,\n      id: \"canvasPreview\",\n      className: \"canvasRendered\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 19\n      }\n    })), !this.props.currentState.renderCanvas && /*#__PURE__*/React.createElement(\"video\", {\n      id: \"recordedVideoElement\",\n      controls: true,\n      srcObject: null,\n      src: null,\n      className: \"canvasRendered\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 17\n      }\n    })), isVideoLoading && /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"canvas\", {\n      id: \"canvasMessage\",\n      className: \"canvasRendered\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 11\n      }\n    }, \"Seleccione un dispositivo de imagen en el panel de configuraci\\xF3n.\")), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"buttons\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      color: \"primary\",\n      size: \"xl\",\n      onClick: () => {\n        ctrlBtnFunction(this);\n      },\n      disabled: !this.props.currentState.enableCtrlBtn,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 11\n      }\n    }, this.props.currentState.textCtrlBtn), /*#__PURE__*/React.createElement(Button, {\n      color: \"primary\",\n      size: \"l\",\n      disabled: !this.props.currentState.enableCaptureBtn,\n      onClick: () => this.captureScreenshot(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 11\n      }\n    }, \"Capturar Pantalla\"), this.props.currentState.showProgressBar && /*#__PURE__*/React.createElement(Progress, {\n      value: this.props.currentState.progress,\n      color: setProgressBarColor(this),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 11\n      }\n    })));\n  }\n\n}\n\nfunction mirror(el) {\n  let canvas = document.querySelector(\"#canvasPreview\");\n\n  if (el.mirrorCount % 2 === 0) {\n    canvas.style.transform = \"translate(640,0)\";\n    canvas.style.transform = \"scale(-1,1)\";\n  } else {\n    canvas.style.transform = \"none\";\n  }\n\n  el.mirrorCount++;\n}\n\nexport default WebcamStream;","map":{"version":3,"sources":["/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/WebcamStream/WebcamStream.js"],"names":["React","Button","Alert","Progress","handleDataAvailable","setProgressBarColor","ctrlBtnFunction","countdown","urlToPromise","downloadScreenshots","downloadVideo","captureScreenshot","WebcamStream","Component","constructor","props","state","isVideoLoading","videoTag","createRef","canvasPreview","selectVideoSrc","tick","bind","countdownFrom","timeStartPressed","mediaRecorder","recordedChunks","videoRecorded","mirrorCount","setStream","document","getElementById","navigator","mediaDevices","getUserMedia","video","deviceId","value","exact","undefined","facingMode","then","stream","current","srcObject","requestAnimationFrame","window","options","mimeType","MediaRecorder","checkVideoState","setInterval","readyState","HAVE_ENOUGH_DATA","clearInterval","setState","canvasPreviewElement","getContext","height","videoHeight","width","videoWidth","drawImage","currentState","stateName","localeCompare","font","startRecording","ondataavailable","start","getVideoThumbnail","toDataURL","stopRecording","stop","mirror","componentDidMount","cnvs","style","clientWidth","backgroundColor","ctx","fillStyle","fillText","render","display","canvasAlert","position","zIndex","renderCanvas","enableCtrlBtn","textCtrlBtn","enableCaptureBtn","showProgressBar","progress","el","canvas","querySelector","transform"],"mappings":"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","sourcesContent":["import './WebcamStream.css'\nimport React from 'react';\nimport {Button, Alert, Progress} from 'reactstrap';\n\n\n\nimport {handleDataAvailable, setProgressBarColor, ctrlBtnFunction, countdown, \n        urlToPromise, downloadScreenshots, downloadVideo, captureScreenshot} from './functions.js';\n\n// Agregar variable para almacenar la hora en que se apretó el start.\n// Administrar el fullscreen desde acá ahora.\nclass WebcamStream extends React.Component {\n  constructor(props) {\n    super();\n    this.state = {\n      isVideoLoading: true\n    };\n\n    this.videoTag = React.createRef();\n    this.canvasPreview = React.createRef();\n\t\tthis.selectVideoSrc = React.createRef();\n    this.tick = this.tick.bind(this);\n\n    this.countdownFrom = 1;\n    this.timeStartPressed = null;\n\n    this.mediaRecorder = null;\n    this.recordedChunks= [];\n\t  this.videoRecorded = null;\n\n    this.mirrorCount = 0;\n  }\n\n  setStream(){\n    var selectVideoSrc = document.getElementById(\"videoSelectConf\");\n    // Falta cerrar el stream anterior antes de abrir uno nuevo.\n    navigator.mediaDevices.getUserMedia({\n      video: {\n        deviceId: selectVideoSrc.value? {exact: selectVideoSrc.value}:undefined,\n        facingMode: \"enviroment\"\n      }\n    }).then(stream => {\n      this.videoTag.current.srcObject = stream;\n      requestAnimationFrame(this.tick);\n      window.stream = stream;\n      var options = { mimeType: \"video/webm;codecs=vp8\" };\n      this.mediaRecorder = new MediaRecorder(stream, options);\n    });\n  }\n\n  tick() {\n    const video = this.videoTag.current;\n    const checkVideoState = setInterval(() => {\n      if (video.readyState === video.HAVE_ENOUGH_DATA) {\n        clearInterval(checkVideoState);\n\n        this.setState({ isVideoLoading: false });\n          const canvasPreviewElement = this.canvasPreview.current;\n          if(canvasPreviewElement){\n          const canvasPreview = canvasPreviewElement.getContext(\"2d\");\n\n          canvasPreviewElement.height = video.videoHeight;\n          canvasPreviewElement.width = video.videoWidth;\n          canvasPreview.drawImage(\n              video,\n              0,\n              0,\n              canvasPreviewElement.width,\n              canvasPreviewElement.height\n           );\n           if(this.props.currentState.stateName.localeCompare(\"Countdown\")===0){\n             canvasPreview.font = \"200px Arial\"\n             countdown(canvasPreview,this);\n           }\n           requestAnimationFrame(this.tick);\n           }\n      }\n    }, 50);\n  }\n\n  startRecording(){\n      this.mediaRecorder.ondataavailable = handleDataAvailable(this);\n      this.mediaRecorder.start();\n      this.props.getVideoThumbnail(this.canvasPreview.current.toDataURL(\"image/jpeg\",1));\n  }\n\n\tstopRecording(){\n    this.mediaRecorder.stop();\n\t}\n\n\tdownloadVideo(){\n\t\tdownloadVideo(this);\t\n\t}\n  \n  captureScreenshot(){\n    captureScreenshot(this);\n    }\n\n  downloadScreenshots(){\n    downloadScreenshots(this);\n  }\n  \n  mirror(){\n    mirror(this);\n  }\n  componentDidMount(){\n\t\t//initial message on canvas\n    let cnvs = document.getElementById(\"canvasMessage\");\n    cnvs.style.height = cnvs.clientWidth*3/4+\"px\";\n\t\tcnvs.style.backgroundColor= \"black\";\n\t\tvar ctx = cnvs.getContext(\"2d\");\n\t\tctx.font = \"10px Arial\";\n\t\tctx.fillStyle = \"white\";\n\t\tctx.fillText(\"Seleccione un dispositivo de imagen en\" , cnvs.width/10, 3*cnvs.height/8);\n\t\tctx.fillText(\"el panel de  configuración.\", cnvs.width/10, 4*cnvs.height/8);\n  }\n\n  render() {\n    const isVideoLoading = this.state.isVideoLoading;\n    return (\n      <div className=\"WebcamStream_Wrapper\">\n        {/* Dummy video tag to recieve UserMedia stream.*/}\n        <video\n          ref={this.videoTag}\n          autoPlay\n          id = \"video\"\n          style={{ display: \"none\"}}\n        />\n\n        {!isVideoLoading &&\n            <div id=\"canvasDiv\">\n              {this.props.currentState.canvasAlert &&\n                <div id=\"alert\" style={{position: 'absolute', zIndex: 2}}>\n                  <Alert color=\"warning\">Verifique el enfoque del dispositivo.</Alert>\n                </div>\n              }\n\n              {this.props.currentState.stateName.localeCompare(\"GetCon\") === 0 &&\n                <div id=\"alert\" style={{position: 'absolute', zIndex: 2}}>\n                  <Alert color=\"info\">Estableciendo conexión con el servidor.</Alert>\n                </div>\n              }\n              \n              {this.props.currentState.renderCanvas &&\n                <div>\n                  <canvas ref={this.canvasPreview}\n                          id=\"canvasPreview\"\n                          className=\"canvasRendered\"/>\n\n                </div>\n              }\n              {!this.props.currentState.renderCanvas &&\n                <video\n                  id = \"recordedVideoElement\"\n                  controls\n                  srcObject = {null}\n                  src={null}\n                  className=\"canvasRendered\"/>\n              }\n            </div>\n        }\n        {isVideoLoading &&\n          <div>\n            <canvas id=\"canvasMessage\"\n                    className=\"canvasRendered\"/>\n          <p>Seleccione un dispositivo de imagen en el panel de configuración.</p>\n            \n          </div>\n        }\n\t\t\t\t<div id=\"buttons\">\n          <Button color=\"primary\"\n                  size=\"xl\"\n                  onClick={()=>{ctrlBtnFunction(this);}}\n                  disabled={!this.props.currentState.enableCtrlBtn}>\n                  {this.props.currentState.textCtrlBtn}</Button>\n          <Button color=\"primary\" \n                  size = \"l\"\n                  disabled={!this.props.currentState.enableCaptureBtn}  \n                  onClick={() => this.captureScreenshot()}>\n            {\"Capturar Pantalla\"}</Button>\n        {this.props.currentState.showProgressBar && \n          <Progress value={this.props.currentState.progress} \n                    color={setProgressBarColor(this)}/>}\n        </div>\n      </div>\n    );\n  }\n}\n\nfunction mirror(el){\n  let canvas = document.querySelector(\"#canvasPreview\");\n  if (el.mirrorCount%2 === 0){\n    canvas.style.transform = \"translate(640,0)\";\n    canvas.style.transform = \"scale(-1,1)\";\n  }\n  else{\n   canvas.style.transform = \"none\";\n  }\n  el.mirrorCount ++;\n}\n\n\nexport default WebcamStream;\n"]},"metadata":{},"sourceType":"module"}