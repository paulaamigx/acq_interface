{"ast":null,"code":"import JSZipUtils from 'jszip-utils';\nimport JSZip from 'jszip';\nimport FileSaver from 'file-saver';\nexport var handleDataAvailable = function (el) {\n  return function (event) {\n    console.log('handleDataAvailable');\n\n    if (event.data && event.data.size > 0) {\n      el.recordedChunks.push(event.data);\n      var blob = new Blob(el.recordedChunks, {\n        type: \"video/webm\"\n      });\n      el.videoRecorded = URL.createObjectURL(blob);\n      var videoElement = document.getElementById(\"recordedVideoElement\");\n      videoElement.src = null;\n      videoElement.srcObject = null;\n      videoElement.src = el.videoRecorded;\n    } else {\n      console.log(\"no data available for recording\");\n    }\n  };\n};\nexport function setProgressBarColor(ctxt) {\n  let p = parseInt(ctxt.props.currentState.progress, 10);\n\n  if (p < 80) {\n    ctxt.progressBarColor = \"info\";\n  } else if (p < 100) {\n    ctxt.progressBarColor = \"success\";\n  } else {\n    ctxt.progressBarColor = \"danger\";\n  }\n\n  return ctxt.progressBarColor;\n}\nexport async function ctrlBtnFunction(el) {\n  switch (el.props.currentState.stateName) {\n    case 'Idle':\n      el.props.stateHandler('GetCon'); // Dummy, despues vendra del servidor.\n\n      el.timeout = setTimeout(function () {\n        el.props.stateHandler('Countdown');\n        el.timeStartPressed = Date.now();\n      }, 1000); // Enviar al servidor la solicitud de conexión.\n\n      el.props.setTabOn(2);\n      setCountdownFrom(el);\n      break;\n\n    case 'GetCon':\n      clearTimeout(el.timeout);\n      el.props.stateHandler('Idle');\n      break;\n\n    case 'Countdown':\n      clearTimeout(el.timeout);\n      el.props.stateHandler('Idle');\n      break;\n\n    case 'Examination':\n      el.stopRecording();\n\n      if (el.props.currentState.hideSidePanel) {\n        el.props.setHideSidePanel(false);\n      }\n\n      if (el.props.currentState.fullScreen) {\n        fullScreen(el);\n      }\n\n      el.props.stateHandler('Review');\n      el.props.setTabOn(4); //el.videoSrc = document.getElementById(\"videoSelectConf\").value;\n\n      el.timeout2 = setTimeout(function () {\n        el.props.setIsDiagnosisReady(true);\n      }, 3000); // Enviar al servidor la solicitud de diagnóstico.\n\n      break;\n\n    case 'Review':\n      el.props.stateHandler('Idle');\n      el.setStream();\n      el.props.setIsDiagnosisReady(false);\n      el.props.gallerySrc.clear();\n      el.props.setGalleryIndxShowing([0, 0, 0], [0, 1, 2], false, 'reset');\n      /*\n      document.getElementById('img1').src = '';\n      document.getElementById('img2').src = '';\n      document.getElementById('img3').src = '';\n      document.getElementById('img1').style.borderStyle = 'none';\n      document.getElementById('img2').style.borderStyle = 'none';\n      document.getElementById('img3').style.borderStyle = 'none';\n      */\n\n      el.props.setTabOn(1);\n      restartStateProps(el);\n      break;\n\n    default:\n      console.log(\"Error: Boton apretado en estado que no correspondía.\");\n  }\n}\n\nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nfunction restartStateProps(el) {\n  el.timeStartPressed = null;\n  el.mediaRecorder = null;\n  el.recordedChunks = [];\n  el.videoRecorded = null;\n}\n\nfunction setCountdownFrom(el) {\n  if (!el.props.currentState.fullScreen && !el.props.currentState.hideSidePanel) {\n    el.props.setCountdownFrom(parseInt(document.getElementById(\"countdownFromInput\").value));\n  }\n}\n\nexport function countdown(canvas, el, countdown, countdownNext) {\n  //let context = canvas;\t\n  let cnvs = document.getElementById(\"canvasCountdown\");\n  let countdownFrom = el.props.countdownFrom;\n\n  if (cnvs) {\n    let w = canvas.clientWidth * 100 / window.innerWidth;\n    let h = canvas.clientHeight * 100 / window.innerWidth;\n    cnvs.style.width = w + \"vw\";\n    cnvs.style.height = h + \"vw\";\n    cnvs.style.left = canvas.clientLeft;\n    cnvs.style.top = canvas.clientTop;\n    let context = cnvs.getContext(\"2d\");\n    context.font = cnvs.height / 3 + \"px RobotoThin\";\n    countdownNext = countdownFrom - Math.trunc((-el.timeStartPressed + Date.now()) / 1000);\n\n    if (countdownNext !== countdown) {\n      context.clearRect(0, 0, canvas.clientWidth * 2, canvas.clientHeight * 2);\n    }\n\n    countdown = countdownNext;\n    context.beginPath();\n    context.fillStyle = \"white\";\n\n    if (countdown >= 10) {\n      context.fillText(countdown.toString(10), cnvs.width / 2 - 130, cnvs.height / 2 + 80);\n    } else if (countdown >= 1) {\n      context.fillText(countdown.toString(10), cnvs.width / 2 - 70, cnvs.height / 2 + 80);\n    }\n\n    context.fill();\n\n    if (countdown < 1) {\n      el.props.stateHandler(\"Examination\");\n      el.startRecording();\n    }\n  }\n}\n\nfunction urlToPromise(url) {\n  return new Promise(function (resolve, reject) {\n    JSZipUtils.getBinaryContent(url, function (err, data) {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(data);\n      }\n    });\n  });\n}\n\nexport function downloadScreenshots(el) {\n  let zip = new JSZip();\n  /*\n  for(let i=0;i < el.props.gallerySrc.length; i++){\n    let name = \"Screenshot_\" + i + \".jpeg\";\n    zip.file(name,urlToPromise(el.props.gallerySrc[i].src),{binary:true});\n  }\n  */\n\n  el.props.gallerySrc.forEach((values, keys) => {\n    let name = \"Screenshot_\" + keys + \".jpeg\";\n    zip.file(name, urlToPromise(values), {\n      binary: true\n    });\n  });\n  zip.generateAsync({\n    type: \"blob\"\n  }).then(function (content) {\n    FileSaver.saveAs(content, \"download.zip\");\n  });\n}\nexport function downloadVideo(el) {\n  var aux = document.createElement(\"a\");\n  document.body.appendChild(aux);\n  aux.style = \"display: none\";\n  aux.href = el.videoRecorded;\n  aux.download = \"test.webm\";\n  document.body.appendChild(aux);\n  aux.click();\n}\nexport function downloadAll(el) {\n  let zip = new JSZip();\n  /*\n  for(let i=0;i < el.props.currentState.GallerySrc.length; i++){\n    let name = \"Screenshot_\" + i + \".jpeg\";\n    zip.file(name,urlToPromise(el.props.currentState.GallerySrc[i].src),{binary:true});\n  }*/\n\n  el.props.gallerySrc.forEach((values, keys) => {\n    let name = \"Screenshot_\" + keys + \".jpeg\";\n    zip.file(name, urlToPromise(values), {\n      binary: true\n    });\n  });\n  zip.file(\"video.webm\", el.videoRecorded);\n  zip.generateAsync({\n    type: \"blob\"\n  }).then(function (content) {\n    FileSaver.saveAs(content, \"download.zip\");\n  });\n}\nexport function captureScreenshot(el) {\n  var canvas = el.props.canvasPreview.current;\n  var imgAsDataURL = canvas.toDataURL(\"image/jpeg\", 1);\n  /*\n    let newId = el.props.currentState.GallerySrc.length + 1;\n    let newSlidesData = [{src: imgAsDataURL, \n                          id: newId\n                        }];\n    el.props.setScreenshots(newSlidesData); \n    */\n  //    let newId = el.props.currentState.GallerySrcLength + 1;\n\n  el.props.setScreenshots(imgAsDataURL);\n}\nexport function mirror(el, way) {\n  //revisar numeros\n  if (way.localeCompare(\"horizontal\") === 0) {\n    el.mirrorTranslate[0] += el.mirrorScale[0] * 640;\n    el.mirrorScale[0] *= -1;\n  } else if (way.localeCompare(\"vertical\") === 0) {\n    el.mirrorTranslate[1] += el.mirrorScale[1] * 480;\n    el.mirrorScale[1] *= -1;\n  } else if (way.localeCompare(\"reset\") === 0) {\n    el.mirrorTranslate = [0, 0];\n    el.mirrorScale = [1, 1];\n  }\n}\nexport function fullScreen(el) {\n  let div = document.getElementById(\"canvasDiv\");\n  let canvas = document.getElementById(\"canvasPreview\");\n  console.log('fs');\n\n  if (!el.props.currentState.fullScreen) {\n    el.canvasWidth = canvas.clientWidth * 100 / window.innerWidth;\n    el.canvasHeight = canvas.clientHeight * 100 / window.innerWidth;\n    console.log('in');\n\n    if (div.webkitRequestFullScreen) {\n      div.webkitRequestFullScreen();\n      console.log('in1');\n    } else {\n      div.requestFullscreen();\n      console.log('in2');\n    }\n  } else {\n    document.exitFullscreen();\n    console.log('ex');\n  }\n}\nexport function organizeScreen(el) {\n  let div = document.getElementById(\"canvasDiv\");\n  let canvas = document.getElementById(\"canvasPreview\");\n  let btns = document.getElementById(\"buttons\");\n  /********** organize full screen ************/\n\n  if (document.fullscreenElement || !window.screenTop && !window.screenY) {\n    el.props.setFullScreen(true);\n\n    if (!el.props.currentState.hideSidePanel && !el.props.currentState.stateName.localeCompare('Idle')) {\n      el.props.setCountdownFrom(parseInt(document.getElementById(\"countdownFromInput\").value));\n    }\n\n    canvas.style.height = window.screen.height + \"px\";\n    canvas.style.width = window.screen.height * el.canvasWidth / el.canvasHeight + \"px\";\n    canvas.style.marginLeft = \"12%\";\n    div.appendChild(btns);\n    btns.style.width = getComputedStyle(canvas).width;\n    btns.style.marginLeft = \"12%\";\n    btns.style.top = window.screen.height - btns.clientHeight + \"px\";\n\n    if (!el.props.currentState.hideSidePanel) {\n      canvas.addEventListener(\"mouseover\", showButtons, false);\n      btns.addEventListener(\"mouseover\", showButtons, false);\n      canvas.addEventListener(\"mouseout\", hideButtons, false);\n    }\n  }\n  /********** organize regular screen ************/\n  else {\n      div.style.width = \"50vw\";\n      canvas.style.width = el.canvasWidth + \"vw\";\n      canvas.style.height = el.canvasHeight + \"vw\";\n      el.props.setFullScreen(false);\n      document.getElementById(\"WebcamStream_Wrapper\").appendChild(btns);\n      canvas.style.height = canvas.clientWidth * (100 / window.innerWidth) * el.canvasHeight / el.canvasWidth + \"vw\";\n      canvas.style.marginLeft = 0;\n\n      if (!el.props.currentState.hideSidePanel) {\n        btns.style.top = el.canvasHeight + \"vw\";\n      } else {\n        btns.style.top = el.canvasHeight - btns.clientHeight * 100 / window.innerWidth + \"vw\";\n      }\n\n      div.appendChild(btns);\n      btns.style.marginLeft = 0;\n      btns.style.width = el.canvasWidth + \"vw\";\n\n      if (!el.props.currentState.hideSidePanel) {\n        canvas.removeEventListener(\"mouseover\", showButtons, false);\n        btns.removeEventListener(\"mouseover\", showButtons, false);\n        canvas.removeEventListener(\"mouseout\", hideButtons, false);\n      }\n\n      btns.style.opacity = 1;\n    }\n}\n\nfunction showButtons() {\n  var btns = document.getElementById(\"buttons\");\n  btns.style.opacity = 0.7;\n}\n\nfunction hideButtons() {\n  var btns = document.getElementById(\"buttons\");\n  btns.style.opacity = 0;\n}\n\nexport default {\n  handleDataAvailable,\n  setProgressBarColor,\n  ctrlBtnFunction,\n  countdown,\n  downloadScreenshots,\n  downloadVideo,\n  captureScreenshot,\n  mirror,\n  fullScreen,\n  organizeScreen\n};","map":{"version":3,"sources":["/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/WebcamStream/functions.js"],"names":["JSZipUtils","JSZip","FileSaver","handleDataAvailable","el","event","console","log","data","size","recordedChunks","push","blob","Blob","type","videoRecorded","URL","createObjectURL","videoElement","document","getElementById","src","srcObject","setProgressBarColor","ctxt","p","parseInt","props","currentState","progress","progressBarColor","ctrlBtnFunction","stateName","stateHandler","timeout","setTimeout","timeStartPressed","Date","now","setTabOn","setCountdownFrom","clearTimeout","stopRecording","hideSidePanel","setHideSidePanel","fullScreen","timeout2","setIsDiagnosisReady","setStream","gallerySrc","clear","setGalleryIndxShowing","restartStateProps","sleep","ms","Promise","resolve","mediaRecorder","value","countdown","canvas","countdownNext","cnvs","countdownFrom","w","clientWidth","window","innerWidth","h","clientHeight","style","width","height","left","clientLeft","top","clientTop","context","getContext","font","Math","trunc","clearRect","beginPath","fillStyle","fillText","toString","fill","startRecording","urlToPromise","url","reject","getBinaryContent","err","downloadScreenshots","zip","forEach","values","keys","name","file","binary","generateAsync","then","content","saveAs","downloadVideo","aux","createElement","body","appendChild","href","download","click","downloadAll","captureScreenshot","canvasPreview","current","imgAsDataURL","toDataURL","setScreenshots","mirror","way","localeCompare","mirrorTranslate","mirrorScale","div","canvasWidth","canvasHeight","webkitRequestFullScreen","requestFullscreen","exitFullscreen","organizeScreen","btns","fullscreenElement","screenTop","screenY","setFullScreen","screen","marginLeft","getComputedStyle","addEventListener","showButtons","hideButtons","removeEventListener","opacity"],"mappings":"AAAA,OAAOA,UAAP,MAAuB,aAAvB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AAEA,OAAO,IAAIC,mBAAmB,GAAG,UAASC,EAAT,EAAa;AAC5C,SAAO,UAAUC,KAAV,EAAiB;AACtBC,IAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;;AACE,QAAIF,KAAK,CAACG,IAAN,IAAcH,KAAK,CAACG,IAAN,CAAWC,IAAX,GAAkB,CAApC,EAAuC;AACvCL,MAAAA,EAAE,CAACM,cAAH,CAAkBC,IAAlB,CAAuBN,KAAK,CAACG,IAA7B;AACA,UAAII,IAAI,GAAG,IAAIC,IAAJ,CAAST,EAAE,CAACM,cAAZ,EAA4B;AACrCI,QAAAA,IAAI,EAAE;AAD+B,OAA5B,CAAX;AAGAV,MAAAA,EAAE,CAACW,aAAH,GAAmBC,GAAG,CAACC,eAAJ,CAAoBL,IAApB,CAAnB;AACA,UAAIM,YAAY,GAAGC,QAAQ,CAACC,cAAT,CAAwB,sBAAxB,CAAnB;AACAF,MAAAA,YAAY,CAACG,GAAb,GAAmB,IAAnB;AACAH,MAAAA,YAAY,CAACI,SAAb,GAAyB,IAAzB;AACAJ,MAAAA,YAAY,CAACG,GAAb,GAAmBjB,EAAE,CAACW,aAAtB;AACC,KAVD,MAWO;AACLT,MAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ;AACD;AACJ,GAhBD;AAiBD,CAlBM;AAoBL,OAAO,SAASgB,mBAAT,CAA6BC,IAA7B,EAAkC;AACvC,MAAIC,CAAC,GAAEC,QAAQ,CAACF,IAAI,CAACG,KAAL,CAAWC,YAAX,CAAwBC,QAAzB,EAAkC,EAAlC,CAAf;;AACA,MAAIJ,CAAC,GAAG,EAAR,EAAW;AACTD,IAAAA,IAAI,CAACM,gBAAL,GAAwB,MAAxB;AACD,GAFD,MAGK,IAAIL,CAAC,GAAG,GAAR,EAAY;AACfD,IAAAA,IAAI,CAACM,gBAAL,GAAwB,SAAxB;AACD,GAFI,MAGD;AACFN,IAAAA,IAAI,CAACM,gBAAL,GAAwB,QAAxB;AACD;;AACD,SAAON,IAAI,CAACM,gBAAZ;AACD;AAED,OAAO,eAAeC,eAAf,CAA+B3B,EAA/B,EAAkC;AAEvC,UAAOA,EAAE,CAACuB,KAAH,CAASC,YAAT,CAAsBI,SAA7B;AACE,SAAK,MAAL;AACE5B,MAAAA,EAAE,CAACuB,KAAH,CAASM,YAAT,CAAsB,QAAtB,EADF,CAEE;;AACA7B,MAAAA,EAAE,CAAC8B,OAAH,GAAaC,UAAU,CAAC,YAAU;AAAC/B,QAAAA,EAAE,CAACuB,KAAH,CAASM,YAAT,CAAsB,WAAtB;AAAmC7B,QAAAA,EAAE,CAACgC,gBAAH,GAAsBC,IAAI,CAACC,GAAL,EAAtB;AAAkC,OAAjF,EAAmF,IAAnF,CAAvB,CAHF,CAIE;;AACFlC,MAAAA,EAAE,CAACuB,KAAH,CAASY,QAAT,CAAkB,CAAlB;AACEC,MAAAA,gBAAgB,CAACpC,EAAD,CAAhB;AACA;;AACF,SAAK,QAAL;AACFqC,MAAAA,YAAY,CAACrC,EAAE,CAAC8B,OAAJ,CAAZ;AACI9B,MAAAA,EAAE,CAACuB,KAAH,CAASM,YAAT,CAAsB,MAAtB;AAEA;;AACL,SAAK,WAAL;AACCQ,MAAAA,YAAY,CAACrC,EAAE,CAAC8B,OAAJ,CAAZ;AACI9B,MAAAA,EAAE,CAACuB,KAAH,CAASM,YAAT,CAAsB,MAAtB;AACJ;;AACE,SAAK,aAAL;AACE7B,MAAAA,EAAE,CAACsC,aAAH;;AACA,UAAGtC,EAAE,CAACuB,KAAH,CAASC,YAAT,CAAsBe,aAAzB,EAAuC;AACvCvC,QAAAA,EAAE,CAACuB,KAAH,CAASiB,gBAAT,CAA0B,KAA1B;AACC;;AACD,UAAGxC,EAAE,CAACuB,KAAH,CAASC,YAAT,CAAsBiB,UAAzB,EAAoC;AACnCA,QAAAA,UAAU,CAACzC,EAAD,CAAV;AACA;;AACDA,MAAAA,EAAE,CAACuB,KAAH,CAASM,YAAT,CAAsB,QAAtB;AACF7B,MAAAA,EAAE,CAACuB,KAAH,CAASY,QAAT,CAAkB,CAAlB,EATA,CAUE;;AACAnC,MAAAA,EAAE,CAAC0C,QAAH,GAAcX,UAAU,CAAC,YAAU;AAAC/B,QAAAA,EAAE,CAACuB,KAAH,CAASoB,mBAAT,CAA6B,IAA7B;AAAmC,OAA/C,EAAiD,IAAjD,CAAxB,CAXF,CAYE;;AACA;;AACF,SAAK,QAAL;AACE3C,MAAAA,EAAE,CAACuB,KAAH,CAASM,YAAT,CAAsB,MAAtB;AACA7B,MAAAA,EAAE,CAAC4C,SAAH;AACA5C,MAAAA,EAAE,CAACuB,KAAH,CAASoB,mBAAT,CAA6B,KAA7B;AACA3C,MAAAA,EAAE,CAACuB,KAAH,CAASsB,UAAT,CAAoBC,KAApB;AACA9C,MAAAA,EAAE,CAACuB,KAAH,CAASwB,qBAAT,CAA+B,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAA/B,EAAuC,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAvC,EAA+C,KAA/C,EAAqD,OAArD;AACA;;;;;;;;;AAQA/C,MAAAA,EAAE,CAACuB,KAAH,CAASY,QAAT,CAAkB,CAAlB;AACAa,MAAAA,iBAAiB,CAAChD,EAAD,CAAjB;AACA;;AACF;AACEE,MAAAA,OAAO,CAACC,GAAR,CAAY,sDAAZ;AAlDJ;AAoDD;;AACH,SAAS8C,KAAT,CAAeC,EAAf,EAAmB;AACjB,SAAO,IAAIC,OAAJ,CAAYC,OAAO,IAAIrB,UAAU,CAACqB,OAAD,EAAUF,EAAV,CAAjC,CAAP;AACD;;AACC,SAASF,iBAAT,CAA2BhD,EAA3B,EAA8B;AAC5BA,EAAAA,EAAE,CAACgC,gBAAH,GAAsB,IAAtB;AACAhC,EAAAA,EAAE,CAACqD,aAAH,GAAmB,IAAnB;AACArD,EAAAA,EAAE,CAACM,cAAH,GAAmB,EAAnB;AACDN,EAAAA,EAAE,CAACW,aAAH,GAAmB,IAAnB;AACA;;AAED,SAASyB,gBAAT,CAA0BpC,EAA1B,EAA6B;AAC3B,MAAI,CAACA,EAAE,CAACuB,KAAH,CAASC,YAAT,CAAsBiB,UAAvB,IAAqC,CAACzC,EAAE,CAACuB,KAAH,CAASC,YAAT,CAAsBe,aAAhE,EAA8E;AAC5EvC,IAAAA,EAAE,CAACuB,KAAH,CAASa,gBAAT,CAA0Bd,QAAQ,CAACP,QAAQ,CAACC,cAAT,CAAwB,oBAAxB,EAA8CsC,KAA/C,CAAlC;AACD;AACF;;AAED,OAAO,SAASC,SAAT,CAAmBC,MAAnB,EAA0BxD,EAA1B,EAA8BuD,SAA9B,EAAyCE,aAAzC,EAAuD;AAC5D;AACA,MAAIC,IAAI,GAAG3C,QAAQ,CAACC,cAAT,CAAwB,iBAAxB,CAAX;AACA,MAAI2C,aAAa,GAAG3D,EAAE,CAACuB,KAAH,CAASoC,aAA7B;;AAEA,MAAGD,IAAH,EAAQ;AACN,QAAIE,CAAC,GAAEJ,MAAM,CAACK,WAAP,GAAmB,GAAnB,GAAuBC,MAAM,CAACC,UAArC;AACA,QAAIC,CAAC,GAAER,MAAM,CAACS,YAAP,GAAoB,GAApB,GAAwBH,MAAM,CAACC,UAAtC;AACAL,IAAAA,IAAI,CAACQ,KAAL,CAAWC,KAAX,GAAoBP,CAAC,GAAG,IAAxB;AACAF,IAAAA,IAAI,CAACQ,KAAL,CAAWE,MAAX,GAAoBJ,CAAC,GAAG,IAAxB;AACAN,IAAAA,IAAI,CAACQ,KAAL,CAAWG,IAAX,GAAkBb,MAAM,CAACc,UAAzB;AACAZ,IAAAA,IAAI,CAACQ,KAAL,CAAWK,GAAX,GAAiBf,MAAM,CAACgB,SAAxB;AACA,QAAIC,OAAO,GAAGf,IAAI,CAACgB,UAAL,CAAgB,IAAhB,CAAd;AACAD,IAAAA,OAAO,CAACE,IAAR,GAAejB,IAAI,CAACU,MAAL,GAAY,CAAZ,GAAe,eAA9B;AAGAX,IAAAA,aAAa,GAAGE,aAAa,GAAEiB,IAAI,CAACC,KAAL,CAAW,CAAC,CAAC7E,EAAE,CAACgC,gBAAJ,GAAuBC,IAAI,CAACC,GAAL,EAAxB,IAAoC,IAA/C,CAA/B;;AACE,QAAGuB,aAAa,KAAKF,SAArB,EAA+B;AAC/BkB,MAAAA,OAAO,CAACK,SAAR,CAAkB,CAAlB,EAAqB,CAArB,EAAwBtB,MAAM,CAACK,WAAP,GAAmB,CAA3C,EAA8CL,MAAM,CAACS,YAAP,GAAoB,CAAlE;AACD;;AACDV,IAAAA,SAAS,GAAGE,aAAZ;AACAgB,IAAAA,OAAO,CAACM,SAAR;AACAN,IAAAA,OAAO,CAACO,SAAR,GAAoB,OAApB;;AACA,QAAGzB,SAAS,IAAI,EAAhB,EAAmB;AACjBkB,MAAAA,OAAO,CAACQ,QAAR,CAAiB1B,SAAS,CAAC2B,QAAV,CAAmB,EAAnB,CAAjB,EAAwCxB,IAAI,CAACS,KAAL,GAAW,CAAX,GAAa,GAArD,EAAyDT,IAAI,CAACU,MAAL,GAAY,CAAZ,GAAc,EAAvE;AACD,KAFD,MAEM,IAAGb,SAAS,IAAI,CAAhB,EAAkB;AACtBkB,MAAAA,OAAO,CAACQ,QAAR,CAAiB1B,SAAS,CAAC2B,QAAV,CAAmB,EAAnB,CAAjB,EAAwCxB,IAAI,CAACS,KAAL,GAAW,CAAX,GAAc,EAAtD,EAA0DT,IAAI,CAACU,MAAL,GAAY,CAAZ,GAAc,EAAxE;AACD;;AAEDK,IAAAA,OAAO,CAACU,IAAR;;AACA,QAAI5B,SAAS,GAAI,CAAjB,EAAmB;AACbvD,MAAAA,EAAE,CAACuB,KAAH,CAASM,YAAT,CAAsB,aAAtB;AACA7B,MAAAA,EAAE,CAACoF,cAAH;AACL;AACA;AACJ;;AAEH,SAASC,YAAT,CAAsBC,GAAtB,EAA2B;AACvB,SAAO,IAAInC,OAAJ,CAAY,UAASC,OAAT,EAAkBmC,MAAlB,EAA0B;AAC3C3F,IAAAA,UAAU,CAAC4F,gBAAX,CAA4BF,GAA5B,EAAiC,UAAUG,GAAV,EAAerF,IAAf,EAAqB;AACpD,UAAGqF,GAAH,EAAQ;AACNF,QAAAA,MAAM,CAACE,GAAD,CAAN;AACD,OAFD,MAGK;AACHrC,QAAAA,OAAO,CAAChD,IAAD,CAAP;AACD;AACF,KAPD;AAQD,GATM,CAAP;AAUD;;AAED,OAAO,SAASsF,mBAAT,CAA6B1F,EAA7B,EAAgC;AACrC,MAAI2F,GAAG,GAAG,IAAI9F,KAAJ,EAAV;AACA;;;;;;;AAMAG,EAAAA,EAAE,CAACuB,KAAH,CAASsB,UAAT,CAAoB+C,OAApB,CAA4B,CAACC,MAAD,EAAQC,IAAR,KAAe;AACzC,QAAIC,IAAI,GAAG,gBAAgBD,IAAhB,GAAuB,OAAlC;AACAH,IAAAA,GAAG,CAACK,IAAJ,CAASD,IAAT,EAAcV,YAAY,CAACQ,MAAD,CAA1B,EAAmC;AAACI,MAAAA,MAAM,EAAC;AAAR,KAAnC;AACC,GAHH;AAMAN,EAAAA,GAAG,CAACO,aAAJ,CAAkB;AAACxF,IAAAA,IAAI,EAAE;AAAP,GAAlB,EAAkCyF,IAAlC,CAAuC,UAASC,OAAT,EAAkB;AACvDtG,IAAAA,SAAS,CAACuG,MAAV,CAAiBD,OAAjB,EAA0B,cAA1B;AACD,GAFD;AAGD;AAED,OAAO,SAASE,aAAT,CAAuBtG,EAAvB,EAA0B;AAC/B,MAAIuG,GAAG,GAAGxF,QAAQ,CAACyF,aAAT,CAAuB,GAAvB,CAAV;AACAzF,EAAAA,QAAQ,CAAC0F,IAAT,CAAcC,WAAd,CAA0BH,GAA1B;AACAA,EAAAA,GAAG,CAACrC,KAAJ,GAAY,eAAZ;AACAqC,EAAAA,GAAG,CAACI,IAAJ,GAAW3G,EAAE,CAACW,aAAd;AACA4F,EAAAA,GAAG,CAACK,QAAJ,GAAe,WAAf;AACA7F,EAAAA,QAAQ,CAAC0F,IAAT,CAAcC,WAAd,CAA0BH,GAA1B;AACAA,EAAAA,GAAG,CAACM,KAAJ;AACD;AAED,OAAO,SAASC,WAAT,CAAqB9G,EAArB,EAAwB;AAC7B,MAAI2F,GAAG,GAAG,IAAI9F,KAAJ,EAAV;AACA;;;;;;AAKAG,EAAAA,EAAE,CAACuB,KAAH,CAASsB,UAAT,CAAoB+C,OAApB,CAA4B,CAACC,MAAD,EAAQC,IAAR,KAAe;AACzC,QAAIC,IAAI,GAAG,gBAAgBD,IAAhB,GAAuB,OAAlC;AACAH,IAAAA,GAAG,CAACK,IAAJ,CAASD,IAAT,EAAcV,YAAY,CAACQ,MAAD,CAA1B,EAAmC;AAACI,MAAAA,MAAM,EAAC;AAAR,KAAnC;AACC,GAHH;AAIAN,EAAAA,GAAG,CAACK,IAAJ,CAAS,YAAT,EAAuBhG,EAAE,CAACW,aAA1B;AACAgF,EAAAA,GAAG,CAACO,aAAJ,CAAkB;AAACxF,IAAAA,IAAI,EAAE;AAAP,GAAlB,EAAkCyF,IAAlC,CAAuC,UAASC,OAAT,EAAkB;AACvDtG,IAAAA,SAAS,CAACuG,MAAV,CAAiBD,OAAjB,EAA0B,cAA1B;AACD,GAFD;AAGD;AAED,OAAO,SAASW,iBAAT,CAA2B/G,EAA3B,EAA8B;AACnC,MAAIwD,MAAM,GAAGxD,EAAE,CAACuB,KAAH,CAASyF,aAAT,CAAuBC,OAApC;AACA,MAAIC,YAAY,GAAG1D,MAAM,CAAC2D,SAAP,CAAiB,YAAjB,EAA8B,CAA9B,CAAnB;AACF;;;;;;;AAOF;;AACInH,EAAAA,EAAE,CAACuB,KAAH,CAAS6F,cAAT,CAAwBF,YAAxB;AACC;AAEL,OAAO,SAASG,MAAT,CAAgBrH,EAAhB,EAAmBsH,GAAnB,EAAuB;AAC5B;AACD,MAAGA,GAAG,CAACC,aAAJ,CAAkB,YAAlB,MAAoC,CAAvC,EAAyC;AACtCvH,IAAAA,EAAE,CAACwH,eAAH,CAAmB,CAAnB,KAAyBxH,EAAE,CAACyH,WAAH,CAAe,CAAf,IAAkB,GAA3C;AACAzH,IAAAA,EAAE,CAACyH,WAAH,CAAe,CAAf,KAAmB,CAAC,CAApB;AACD,GAHF,MAIM,IAAGH,GAAG,CAACC,aAAJ,CAAkB,UAAlB,MAAkC,CAArC,EAAuC;AAC1CvH,IAAAA,EAAE,CAACwH,eAAH,CAAmB,CAAnB,KAAyBxH,EAAE,CAACyH,WAAH,CAAe,CAAf,IAAkB,GAA3C;AACAzH,IAAAA,EAAE,CAACyH,WAAH,CAAe,CAAf,KAAmB,CAAC,CAApB;AACD,GAHI,MAIA,IAAGH,GAAG,CAACC,aAAJ,CAAkB,OAAlB,MAA6B,CAAhC,EAAkC;AACrCvH,IAAAA,EAAE,CAACwH,eAAH,GAAqB,CAAC,CAAD,EAAG,CAAH,CAArB;AACAxH,IAAAA,EAAE,CAACyH,WAAH,GAAiB,CAAC,CAAD,EAAG,CAAH,CAAjB;AACD;AACF;AAED,OAAO,SAAShF,UAAT,CAAoBzC,EAApB,EAAuB;AAC5B,MAAI0H,GAAG,GAAG3G,QAAQ,CAACC,cAAT,CAAwB,WAAxB,CAAV;AACA,MAAIwC,MAAM,GAAGzC,QAAQ,CAACC,cAAT,CAAwB,eAAxB,CAAb;AAEAd,EAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;;AACD,MAAG,CAACH,EAAE,CAACuB,KAAH,CAASC,YAAT,CAAsBiB,UAA1B,EAAqC;AAClCzC,IAAAA,EAAE,CAAC2H,WAAH,GAAiBnE,MAAM,CAACK,WAAP,GAAmB,GAAnB,GAAuBC,MAAM,CAACC,UAA/C;AACA/D,IAAAA,EAAE,CAAC4H,YAAH,GAAiBpE,MAAM,CAACS,YAAP,GAAoB,GAApB,GAAwBH,MAAM,CAACC,UAAhD;AACA7D,IAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;;AACF,QAAGuH,GAAG,CAACG,uBAAP,EAAgC;AAC/BH,MAAAA,GAAG,CAACG,uBAAJ;AACG3H,MAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ;AACH,KAHD,MAIK;AACJuH,MAAAA,GAAG,CAACI,iBAAJ;AACG5H,MAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ;AACH;AACD,GAZD,MAcI;AACDY,IAAAA,QAAQ,CAACgH,cAAT;AACA7H,IAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACD;AACF;AACD,OAAO,SAAS6H,cAAT,CAAwBhI,EAAxB,EAA2B;AAChC,MAAI0H,GAAG,GAAG3G,QAAQ,CAACC,cAAT,CAAwB,WAAxB,CAAV;AACA,MAAIwC,MAAM,GAAGzC,QAAQ,CAACC,cAAT,CAAwB,eAAxB,CAAb;AACA,MAAIiH,IAAI,GAAElH,QAAQ,CAACC,cAAT,CAAwB,SAAxB,CAAV;AAEA;;AACA,MAAID,QAAQ,CAACmH,iBAAT,IAA+B,CAACpE,MAAM,CAACqE,SAAR,IAAqB,CAACrE,MAAM,CAACsE,OAAhE,EAA0E;AAC1EpI,IAAAA,EAAE,CAACuB,KAAH,CAAS8G,aAAT,CAAuB,IAAvB;;AACE,QAAG,CAACrI,EAAE,CAACuB,KAAH,CAASC,YAAT,CAAsBe,aAAvB,IAAwC,CAACvC,EAAE,CAACuB,KAAH,CAASC,YAAT,CAAsBI,SAAtB,CAAgC2F,aAAhC,CAA8C,MAA9C,CAA5C,EAAkG;AAChGvH,MAAAA,EAAE,CAACuB,KAAH,CAASa,gBAAT,CAA0Bd,QAAQ,CAACP,QAAQ,CAACC,cAAT,CAAwB,oBAAxB,EAA8CsC,KAA/C,CAAlC;AACD;;AACHE,IAAAA,MAAM,CAACU,KAAP,CAAaE,MAAb,GAAsBN,MAAM,CAACwE,MAAP,CAAclE,MAAd,GAAuB,IAA7C;AACAZ,IAAAA,MAAM,CAACU,KAAP,CAAaC,KAAb,GAAqBL,MAAM,CAACwE,MAAP,CAAclE,MAAd,GAAqBpE,EAAE,CAAC2H,WAAxB,GAAoC3H,EAAE,CAAC4H,YAAvC,GAAsD,IAA3E;AACApE,IAAAA,MAAM,CAACU,KAAP,CAAaqE,UAAb,GAA0B,KAA1B;AAEAb,IAAAA,GAAG,CAAChB,WAAJ,CAAgBuB,IAAhB;AACAA,IAAAA,IAAI,CAAC/D,KAAL,CAAWC,KAAX,GAAmBqE,gBAAgB,CAAChF,MAAD,CAAhB,CAAyBW,KAA5C;AACE8D,IAAAA,IAAI,CAAC/D,KAAL,CAAWqE,UAAX,GAAwB,KAAxB;AACFN,IAAAA,IAAI,CAAC/D,KAAL,CAAWK,GAAX,GAAiBT,MAAM,CAACwE,MAAP,CAAclE,MAAd,GAAuB6D,IAAI,CAAChE,YAA5B,GAA4C,IAA7D;;AACE,QAAG,CAACjE,EAAE,CAACuB,KAAH,CAASC,YAAT,CAAsBe,aAA1B,EAAwC;AACxCiB,MAAAA,MAAM,CAACiF,gBAAP,CAAwB,WAAxB,EAAoCC,WAApC,EAAiD,KAAjD;AACAT,MAAAA,IAAI,CAACQ,gBAAL,CAAsB,WAAtB,EAAkCC,WAAlC,EAA+C,KAA/C;AACAlF,MAAAA,MAAM,CAACiF,gBAAP,CAAwB,UAAxB,EAAmCE,WAAnC,EAA+C,KAA/C;AACC;AACH;AAEA;AApBA,OAqBG;AACDjB,MAAAA,GAAG,CAACxD,KAAJ,CAAUC,KAAV,GAAkB,MAAlB;AACFX,MAAAA,MAAM,CAACU,KAAP,CAAaC,KAAb,GAAqBnE,EAAE,CAAC2H,WAAH,GAAiB,IAAtC;AACAnE,MAAAA,MAAM,CAACU,KAAP,CAAaE,MAAb,GAAsBpE,EAAE,CAAC4H,YAAH,GAAkB,IAAxC;AACA5H,MAAAA,EAAE,CAACuB,KAAH,CAAS8G,aAAT,CAAuB,KAAvB;AACAtH,MAAAA,QAAQ,CAACC,cAAT,CAAwB,sBAAxB,EAAgD0F,WAAhD,CAA4DuB,IAA5D;AACEzE,MAAAA,MAAM,CAACU,KAAP,CAAaE,MAAb,GAAsBZ,MAAM,CAACK,WAAP,IAAoB,MAAIC,MAAM,CAACC,UAA/B,IAA2C/D,EAAE,CAAC4H,YAA9C,GAA2D5H,EAAE,CAAC2H,WAA9D,GAA4E,IAAlG;AACFnE,MAAAA,MAAM,CAACU,KAAP,CAAaqE,UAAb,GAA0B,CAA1B;;AACE,UAAG,CAACvI,EAAE,CAACuB,KAAH,CAASC,YAAT,CAAsBe,aAA1B,EAAwC;AACxC0F,QAAAA,IAAI,CAAC/D,KAAL,CAAWK,GAAX,GAAiBvE,EAAE,CAAC4H,YAAH,GAAkB,IAAnC;AACC,OAFD,MAGI;AACJK,QAAAA,IAAI,CAAC/D,KAAL,CAAWK,GAAX,GAAiBvE,EAAE,CAAC4H,YAAH,GAAkBK,IAAI,CAAChE,YAAL,GAAkB,GAAlB,GAAsBH,MAAM,CAACC,UAA/C,GAA2D,IAA5E;AACC;;AACH2D,MAAAA,GAAG,CAAChB,WAAJ,CAAgBuB,IAAhB;AACEA,MAAAA,IAAI,CAAC/D,KAAL,CAAWqE,UAAX,GAAwB,CAAxB;AACAN,MAAAA,IAAI,CAAC/D,KAAL,CAAWC,KAAX,GAAmBnE,EAAE,CAAC2H,WAAH,GAAiB,IAApC;;AACA,UAAG,CAAC3H,EAAE,CAACuB,KAAH,CAASC,YAAT,CAAsBe,aAA1B,EAAwC;AACxCiB,QAAAA,MAAM,CAACoF,mBAAP,CAA2B,WAA3B,EAAuCF,WAAvC,EAAmD,KAAnD;AACAT,QAAAA,IAAI,CAACW,mBAAL,CAAyB,WAAzB,EAAqCF,WAArC,EAAiD,KAAjD;AACAlF,QAAAA,MAAM,CAACoF,mBAAP,CAA2B,UAA3B,EAAsCD,WAAtC,EAAkD,KAAlD;AACC;;AACHV,MAAAA,IAAI,CAAC/D,KAAL,CAAW2E,OAAX,GAAqB,CAArB;AACA;AACD;;AACD,SAASH,WAAT,GAAsB;AACrB,MAAIT,IAAI,GAAElH,QAAQ,CAACC,cAAT,CAAwB,SAAxB,CAAV;AACAiH,EAAAA,IAAI,CAAC/D,KAAL,CAAW2E,OAAX,GAAmB,GAAnB;AACA;;AAED,SAASF,WAAT,GAAsB;AACrB,MAAIV,IAAI,GAAElH,QAAQ,CAACC,cAAT,CAAwB,SAAxB,CAAV;AACAiH,EAAAA,IAAI,CAAC/D,KAAL,CAAW2E,OAAX,GAAmB,CAAnB;AACA;;AAEC,eAAe;AAAC9I,EAAAA,mBAAD;AAAsBoB,EAAAA,mBAAtB;AAA2CQ,EAAAA,eAA3C;AAA4D4B,EAAAA,SAA5D;AACAmC,EAAAA,mBADA;AACqBY,EAAAA,aADrB;AACoCS,EAAAA,iBADpC;AACuDM,EAAAA,MADvD;AAC+D5E,EAAAA,UAD/D;AAC2EuF,EAAAA;AAD3E,CAAf","sourcesContent":["import JSZipUtils from 'jszip-utils';\nimport JSZip from 'jszip';\nimport FileSaver from 'file-saver';\n\nexport var handleDataAvailable = function(el) {\n  return function (event) {\n    console.log('handleDataAvailable');\n      if (event.data && event.data.size > 0) {\n      el.recordedChunks.push(event.data);\n      var blob = new Blob(el.recordedChunks, {\n        type: \"video/webm\"\n      });\n      el.videoRecorded = URL.createObjectURL(blob);\n      var videoElement = document.getElementById(\"recordedVideoElement\");\n      videoElement.src = null;\n      videoElement.srcObject = null;\n      videoElement.src = el.videoRecorded;\n      }\n        else {\n        console.log(\"no data available for recording\");\n      }\n  }\n}\n\n  export function setProgressBarColor(ctxt){\n    let p =parseInt(ctxt.props.currentState.progress,10);\n    if (p < 80){\n      ctxt.progressBarColor = \"info\";\n    }\n    else if (p < 100){\n      ctxt.progressBarColor = \"success\";\n    }\n    else{\n      ctxt.progressBarColor = \"danger\";\n    }\n    return ctxt.progressBarColor;\n  }\n  \n  export async function ctrlBtnFunction(el){\n\t\t\n    switch(el.props.currentState.stateName){\n      case 'Idle':\n        el.props.stateHandler('GetCon');\n        // Dummy, despues vendra del servidor.\n        el.timeout = setTimeout(function(){el.props.stateHandler('Countdown');el.timeStartPressed = Date.now();}, 1000);\n        // Enviar al servidor la solicitud de conexión.\n\t\t    el.props.setTabOn(2);\n        setCountdownFrom(el);\n        break;\n      case 'GetCon':\n\t\t\t\tclearTimeout(el.timeout);\n        el.props.stateHandler('Idle');\n\t\t\t\t\n        break;\n\t\t\tcase 'Countdown':\n\t\t\t\tclearTimeout(el.timeout);\n        el.props.stateHandler('Idle');\n\t\t\t\tbreak\n      case 'Examination':\n        el.stopRecording();\n        if(el.props.currentState.hideSidePanel){\n\t\t      el.props.setHideSidePanel(false);\n        }\n        if(el.props.currentState.fullScreen){\n         fullScreen(el); \n        }\n        el.props.stateHandler('Review');\n\t\t    el.props.setTabOn(4);\n        //el.videoSrc = document.getElementById(\"videoSelectConf\").value;\n        el.timeout2 = setTimeout(function(){el.props.setIsDiagnosisReady(true)}, 3000);\n        // Enviar al servidor la solicitud de diagnóstico.\n        break;\n      case 'Review':\n        el.props.stateHandler('Idle');\n        el.setStream();\n        el.props.setIsDiagnosisReady(false);\n        el.props.gallerySrc.clear();\n        el.props.setGalleryIndxShowing([0,0,0],[0,1,2],false,'reset');\n        /*\n        document.getElementById('img1').src = '';\n        document.getElementById('img2').src = '';\n        document.getElementById('img3').src = '';\n        document.getElementById('img1').style.borderStyle = 'none';\n        document.getElementById('img2').style.borderStyle = 'none';\n        document.getElementById('img3').style.borderStyle = 'none';\n        */\n        el.props.setTabOn(1);\n        restartStateProps(el);\n        break;\n      default:\n        console.log(\"Error: Boton apretado en estado que no correspondía.\")\n    }\n  }\nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n  function restartStateProps(el){\n    el.timeStartPressed = null;\n    el.mediaRecorder = null;\n    el.recordedChunks= [];\n\t  el.videoRecorded = null;\n  }\n\n  function setCountdownFrom(el){\n    if (!el.props.currentState.fullScreen && !el.props.currentState.hideSidePanel){\n      el.props.setCountdownFrom(parseInt(document.getElementById(\"countdownFromInput\").value));\n    }\n  }\n\n  export function countdown(canvas,el, countdown, countdownNext){\n    //let context = canvas;\t\n    let cnvs = document.getElementById(\"canvasCountdown\");\n    let countdownFrom = el.props.countdownFrom;\n\n    if(cnvs){\n      let w =canvas.clientWidth*100/window.innerWidth;\n      let h =canvas.clientHeight*100/window.innerWidth;\n      cnvs.style.width =  w + \"vw\";\n      cnvs.style.height=  h + \"vw\";\n      cnvs.style.left = canvas.clientLeft;\n      cnvs.style.top = canvas.clientTop;\n      let context = cnvs.getContext(\"2d\");\n      context.font = cnvs.height/3 +\"px RobotoThin\"\n             \n      \n      countdownNext = countdownFrom- Math.trunc((-el.timeStartPressed + Date.now())/1000);\n        if(countdownNext !== countdown){\n        context.clearRect(0, 0, canvas.clientWidth*2, canvas.clientHeight*2); \n      }\n      countdown = countdownNext;\n      context.beginPath();\n      context.fillStyle = \"white\";\n      if(countdown >= 10){\n        context.fillText(countdown.toString(10),cnvs.width/2-130,cnvs.height/2+80);\n      }else if(countdown >= 1){\n        context.fillText(countdown.toString(10),cnvs.width/2 -70 ,cnvs.height/2+80);\n      }\n    \n      context.fill();\n      if (countdown <  1){\n            el.props.stateHandler(\"Examination\");\n            el.startRecording();\n      }\n      }\n  }\n  \nfunction urlToPromise(url) {\n    return new Promise(function(resolve, reject) {\n      JSZipUtils.getBinaryContent(url, function (err, data) {\n        if(err) {\n          reject(err);\n        }\n        else {\n          resolve(data);\n        }\n      });\n    });\n  }\n\n  export function downloadScreenshots(el){\n    let zip = new JSZip();\n    /*\n    for(let i=0;i < el.props.gallerySrc.length; i++){\n      let name = \"Screenshot_\" + i + \".jpeg\";\n      zip.file(name,urlToPromise(el.props.gallerySrc[i].src),{binary:true});\n    }\n    */\n    el.props.gallerySrc.forEach((values,keys)=>{\n      let name = \"Screenshot_\" + keys + \".jpeg\";\n      zip.file(name,urlToPromise(values),{binary:true});\n      }\n\n    );\n    zip.generateAsync({type: \"blob\"}).then(function(content) {\n      FileSaver.saveAs(content, \"download.zip\");\n    });\n  }\n\n  export function downloadVideo(el){\n    var aux = document.createElement(\"a\");\n    document.body.appendChild(aux);\n    aux.style = \"display: none\";\n    aux.href = el.videoRecorded;\n    aux.download = \"test.webm\";\n    document.body.appendChild(aux);\n    aux.click();\t\t\n  }\n\n  export function downloadAll(el){\n    let zip = new JSZip();\n    /*\n    for(let i=0;i < el.props.currentState.GallerySrc.length; i++){\n      let name = \"Screenshot_\" + i + \".jpeg\";\n      zip.file(name,urlToPromise(el.props.currentState.GallerySrc[i].src),{binary:true});\n    }*/\n    el.props.gallerySrc.forEach((values,keys)=>{\n      let name = \"Screenshot_\" + keys + \".jpeg\";\n      zip.file(name,urlToPromise(values),{binary:true});\n      });\n    zip.file(\"video.webm\", el.videoRecorded);\n    zip.generateAsync({type: \"blob\"}).then(function(content) {\n      FileSaver.saveAs(content, \"download.zip\");\n    });\n  }\n\n  export function captureScreenshot(el){\n    var canvas = el.props.canvasPreview.current; \n    var imgAsDataURL = canvas.toDataURL(\"image/jpeg\",1);\n  /*\n    let newId = el.props.currentState.GallerySrc.length + 1;\n    let newSlidesData = [{src: imgAsDataURL, \n                          id: newId\n                        }];\n    el.props.setScreenshots(newSlidesData); \n    */\n//    let newId = el.props.currentState.GallerySrcLength + 1;\n    el.props.setScreenshots(imgAsDataURL);\n    }\n\nexport function mirror(el,way){\n  //revisar numeros\n\tif(way.localeCompare(\"horizontal\") === 0){\n    el.mirrorTranslate[0] += el.mirrorScale[0]*640;\n    el.mirrorScale[0]*=-1;\n  }\n  else if(way.localeCompare(\"vertical\") === 0){\n    el.mirrorTranslate[1] += el.mirrorScale[1]*480;\n    el.mirrorScale[1]*=-1;\n  }\n  else if(way.localeCompare(\"reset\")===0){\n    el.mirrorTranslate = [0,0];\n    el.mirrorScale = [1,1];\n  }\n}\n\nexport function fullScreen(el){\n  let div = document.getElementById(\"canvasDiv\");\n  let canvas = document.getElementById(\"canvasPreview\");\n\n  console.log('fs');\n\tif(!el.props.currentState.fullScreen){\n    el.canvasWidth = canvas.clientWidth*100/window.innerWidth;\n    el.canvasHeight =canvas.clientHeight*100/window.innerWidth;\n    console.log('in');\n\t\tif(div.webkitRequestFullScreen) {\n\t\t\tdiv.webkitRequestFullScreen(); \n      console.log('in1');\n\t\t}\n\t\telse {\n\t\t\tdiv.requestFullscreen();\n      console.log('in2');\n\t\t} \n\t}\n\n\telse{\n    document.exitFullscreen();\n    console.log('ex');\n  }\n}\nexport function organizeScreen(el){\n  let div = document.getElementById(\"canvasDiv\");\n  let canvas = document.getElementById(\"canvasPreview\");\n  let btns= document.getElementById(\"buttons\");\n\n  /********** organize full screen ************/\n  if (document.fullscreenElement || (!window.screenTop && !window.screenY)) {\n\t\tel.props.setFullScreen(true);\n    if(!el.props.currentState.hideSidePanel && !el.props.currentState.stateName.localeCompare('Idle')){\n      el.props.setCountdownFrom(parseInt(document.getElementById(\"countdownFromInput\").value));\n    }\n\t\tcanvas.style.height = window.screen.height + \"px\";\n\t\tcanvas.style.width = window.screen.height*el.canvasWidth/el.canvasHeight + \"px\";\n\t\tcanvas.style.marginLeft = \"12%\";\n\n\t\tdiv.appendChild(btns);\n\t\tbtns.style.width = getComputedStyle(canvas).width;\n    btns.style.marginLeft = \"12%\"\n\t\tbtns.style.top = window.screen.height - btns.clientHeight  + \"px\";\n    if(!el.props.currentState.hideSidePanel){\n\t\t  canvas.addEventListener(\"mouseover\",showButtons, false);\n\t\t  btns.addEventListener(\"mouseover\",showButtons, false);\n\t\t  canvas.addEventListener(\"mouseout\",hideButtons,false);\n    }\n\t}\n\n  /********** organize regular screen ************/\n\telse{\n    div.style.width=  \"50vw\";\n\t\tcanvas.style.width = el.canvasWidth + \"vw\";\n\t\tcanvas.style.height = el.canvasHeight + \"vw\";\n\t\tel.props.setFullScreen(false);\n\t\tdocument.getElementById(\"WebcamStream_Wrapper\").appendChild(btns);\n    canvas.style.height = canvas.clientWidth*(100/window.innerWidth)*el.canvasHeight/el.canvasWidth + \"vw\";\n\t\tcanvas.style.marginLeft = 0;\n    if(!el.props.currentState.hideSidePanel){\n\t\t  btns.style.top = el.canvasHeight + \"vw\";\n    }\n    else{\n\t\t  btns.style.top = el.canvasHeight - btns.clientHeight*100/window.innerWidth+ \"vw\";\n    }\n\t\tdiv.appendChild(btns);\n    btns.style.marginLeft = 0;\n    btns.style.width = el.canvasWidth + \"vw\";\n    if(!el.props.currentState.hideSidePanel){\n  \t\tcanvas.removeEventListener(\"mouseover\",showButtons,false);\n  \t\tbtns.removeEventListener(\"mouseover\",showButtons,false);\n  \t\tcanvas.removeEventListener(\"mouseout\",hideButtons,false);\n    }\n\t\tbtns.style.opacity = 1;\n\t}\n}\nfunction showButtons(){\n\tvar btns= document.getElementById(\"buttons\");\n\tbtns.style.opacity=0.7;\n}\n\nfunction hideButtons(){\n\tvar btns= document.getElementById(\"buttons\");\n\tbtns.style.opacity=0;\n}\n\n  export default {handleDataAvailable, setProgressBarColor, ctrlBtnFunction, countdown,\n                 downloadScreenshots, downloadVideo, captureScreenshot, mirror, fullScreen, organizeScreen}\n\n"]},"metadata":{},"sourceType":"module"}