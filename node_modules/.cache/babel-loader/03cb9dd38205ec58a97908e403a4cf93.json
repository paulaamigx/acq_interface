{"ast":null,"code":"import JSZipUtils from 'jszip-utils';\nimport JSZip from 'jszip';\nimport FileSaver from 'file-saver';\nexport var handleDataAvailable = function (el) {\n  return function (event) {\n    console.log('handleDataAvailable');\n\n    if (event.data && event.data.size > 0) {\n      el.recordedChunks.push(event.data);\n      var blob = new Blob(el.recordedChunks, {\n        type: \"video/webm\"\n      });\n      el.videoRecorded = URL.createObjectURL(blob);\n      var videoElement = document.getElementById(\"recordedVideoElement\");\n      videoElement.src = null;\n      videoElement.srcObject = null;\n      videoElement.src = el.videoRecorded;\n    } else {\n      console.log(\"no data available for recording\");\n    }\n  };\n};\nexport function setProgressBarColor(ctxt) {\n  let p = parseInt(ctxt.props.currentState.progress, 10);\n\n  if (p < 80) {\n    ctxt.progressBarColor = \"info\";\n  } else if (p < 100) {\n    ctxt.progressBarColor = \"success\";\n  } else {\n    ctxt.progressBarColor = \"danger\";\n  }\n\n  return ctxt.progressBarColor;\n}\nexport function ctrlBtnFunction(ctxt) {\n  switch (ctxt.props.currentState.stateName) {\n    case 'Idle':\n      ctxt.props.stateHandler('GetCon'); // Dummy, despues vendra del servidor.\n\n      setTimeout(() => {\n        ctxt.props.stateHandler('Countdown');\n        ctxt.startRecording();\n        ctxt.timeStartPressed = Date.now();\n      }, 1000); // Enviar al servidor la solicitud de conexión.\n\n      break;\n\n    case 'GetCon':\n      ctxt.props.stateHandler('Idle');\n      break;\n\n    case 'Examination':\n      ctxt.stopRecording();\n\n      if (ctxt.props.currentState.hideSidePanel) {\n        ctxt.props.changeStateProp({\n          hideSidePanel: false\n        });\n      }\n\n      if (ctxt.props.currentState.fullScreen) {\n        fullScreen(ctxt);\n      }\n\n      ctxt.props.stateHandler('Review');\n      ctxt.props.changeStateProp({\n        tabOn: \"4\"\n      }); //tab diagnostico\n      // Enviar al servidor la solicitud de diagnóstico.\n\n      break;\n\n    case 'Review':\n      ctxt.props.stateHandler('Idle');\n      ctxt.setStream();\n      console.log(document.getElementById(\"buttons\"));\n      restartStateProps();\n      break;\n\n    default:\n      console.log(\"Error: Boton apretado en estado que no correspondía.\");\n  }\n}\n\nfunction restartStateProps() {}\n\nexport function countdown(canvas, el) {\n  //let context = canvas;\t\n  let cnvs = document.getElementById(\"canvasCountdown\");\n\n  if (cnvs) {\n    let w = canvas.clientWidth * 100 / window.innerWidth;\n    let h = canvas.clientHeight * 100 / window.innerWidth;\n    cnvs.style.width = w + \"vw\";\n    cnvs.style.height = h + \"vw\";\n    cnvs.style.left = canvas.clientLeft;\n    cnvs.style.top = canvas.clientTop;\n    let context = cnvs.getContext(\"2d\");\n    context.font = cnvs.height / 3 + \"px Arial\"; //let countdown = el.props.countdownFrom- Math.trunc((-el.timeStartPressed + Date.now())/1000);\n\n    let countdown = 10 - Math.trunc((-el.timeStartPressed + Date.now()) / 1000);\n    context.beginPath(); //      context.arc(cnvs.clientWidth/2, cnvs.clientHeight/2, cnvs.clientHeight/2, 0, 2 * Math.PI);\n\n    context.arc(cnvs.width / 2, cnvs.height / 2, cnvs.height / 3, 0, 2 * Math.PI);\n    context.fillStyle = \"rgba(255, 255, 255, 0.8)\";\n    ;\n    context.fill();\n    context.beginPath();\n    context.fillStyle = \"black\";\n\n    if (countdown >= 10) {\n      context.fillText(countdown.toString(10), cnvs.width / 2, cnvs.height / 2);\n    } else if (countdown >= 1) {\n      context.fillText(countdown.toString(10), cnvs.width / 2, cnvs.height / 2);\n    }\n\n    context.fill();\n\n    if (countdown < 1) {\n      el.props.stateHandler(\"Examination\");\n    }\n  }\n}\nexport function urlToPromise(url) {\n  return new Promise(function (resolve, reject) {\n    JSZipUtils.getBinaryContent(url, function (err, data) {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(data);\n      }\n    });\n  });\n}\nexport function downloadScreenshots(el) {\n  let zip = new JSZip();\n\n  for (let i = 0; i < el.props.currentState.GallerySrc.length; i++) {\n    let name = \"Screenshot_\" + i + \".jpeg\";\n    zip.file(name, urlToPromise(el.props.currentState.GallerySrc[i].src), {\n      binary: true\n    });\n  }\n\n  zip.generateAsync({\n    type: \"blob\"\n  }).then(function (content) {\n    FileSaver.saveAs(content, \"download.zip\");\n  });\n}\nexport function downloadVideo(el) {\n  var aux = document.createElement(\"a\");\n  document.body.appendChild(aux);\n  aux.style = \"display: none\";\n  aux.href = el.videoRecorded;\n  aux.download = \"test.webm\";\n  document.body.appendChild(aux);\n  aux.click();\n}\nexport function captureScreenshot(el) {\n  var canvas = el.props.canvasPreview.current;\n  var imgAsDataURL = canvas.toDataURL(\"image/jpeg\", 1);\n  let newSlidesData = [{\n    src: imgAsDataURL,\n    thumbnail: imgAsDataURL,\n    thumbnailWidth: 160,\n    thumbnailHeight: 120\n  }];\n  el.props.setScreenshots(newSlidesData);\n}\nexport function mirror(el, way) {\n  //revisar numeros\n  if (way.localeCompare(\"horizontal\") === 0) {\n    el.mirrorTranslate[0] += el.mirrorScale[0] * 640;\n    el.mirrorScale[0] *= -1;\n  } else if (way.localeCompare(\"vertical\") === 0) {\n    el.mirrorTranslate[1] += el.mirrorScale[1] * 480;\n    el.mirrorScale[1] *= -1;\n  }\n}\nexport function fullScreen(el) {\n  let div = document.getElementById(\"canvasDiv\");\n  let canvas = document.getElementById(\"canvasPreview\");\n  let btns = document.getElementById(\"buttons\");\n  let progress = document.getElementById(\"progressBar\");\n  let canvasDim = el.props.getCanvasDim();\n\n  if (!el.props.currentState.fullScreen) {\n    el.props.saveCanvasDim(canvas.clientWidth * 100 / window.innerWidth, canvas.clientHeight * 100 / window.innerWidth); //vw\n\n    canvasDim = [canvas.clientWidth, canvas.clientHeight];\n    canvas.style.height = window.screen.height - 2 * window.innerHeight / 100 + \"px\";\n    canvas.style.width = window.screen.height * canvasDim[0] / canvasDim[1] + \"px\";\n    canvas.style.marginLeft = \"12%\";\n    div.appendChild(btns);\n    div.appendChild(progress);\n    btns.style.width = getComputedStyle(canvas).width;\n    btns.style.marginLeft = \"12%\";\n    btns.style.top = window.screen.height - btns.clientHeight - 10 + \"px\";\n    canvas.addEventListener(\"mouseover\", showButtons, false);\n    btns.addEventListener(\"mouseover\", showButtons, false);\n    canvas.addEventListener(\"mouseout\", hideButtons, false);\n\n    if (div.webkitRequestFullScreen) {\n      div.webkitRequestFullScreen();\n    } else {\n      div.requestFullscreen();\n    }\n\n    el.props.changeStateProp({\n      fullScreen: true\n    });\n  } else {\n    document.exitFullscreen();\n    div.style.width = \"50vw\";\n    canvas.style.width = canvasDim[0] + \"vw\";\n    canvas.style.height = canvasDim[1] + \"vw\";\n    el.props.changeStateProp({\n      fullScreen: false\n    });\n    document.getElementById(\"WebcamStream_Wrapper\").appendChild(btns);\n    document.getElementById(\"WebcamStream_Wrapper\").appendChild(progress);\n    canvas.style.height = canvas.clientWidth * (100 / window.innerWidth) * canvasDim[1] / canvasDim[0] + \"vw\";\n    canvas.style.marginLeft = 0;\n\n    if (!el.props.currentState.hideSidePanel) {\n      btns.style.top = canvasDim[1] + \"vw\";\n    } else {\n      console.log(\"asdf\");\n      btns.style.top = canvasDim[1] - btns.clientHeight * 100 / window.innerWidth + \"vw\";\n    }\n\n    btns.style.marginLeft = div.style.marginLeft;\n    btns.style.width = canvasDim[0] + \"vw\";\n    canvas.removeEventListener(\"mouseover\", showButtons, false);\n    btns.removeEventListener(\"mouseover\", showButtons, false);\n    canvas.removeEventListener(\"mouseout\", hideButtons, false);\n    btns.style.opacity = 1;\n  }\n}\n\nfunction showButtons() {\n  var btns = document.getElementById(\"buttons\");\n  btns.style.opacity = 0.7;\n}\n\nfunction hideButtons() {\n  var btns = document.getElementById(\"buttons\");\n  btns.style.opacity = 0;\n}\n\nexport default {\n  handleDataAvailable,\n  setProgressBarColor,\n  ctrlBtnFunction,\n  countdown,\n  urlToPromise,\n  downloadScreenshots,\n  downloadVideo,\n  captureScreenshot,\n  mirror,\n  fullScreen\n};","map":{"version":3,"sources":["/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/WebcamStream/functions.js"],"names":["JSZipUtils","JSZip","FileSaver","handleDataAvailable","el","event","console","log","data","size","recordedChunks","push","blob","Blob","type","videoRecorded","URL","createObjectURL","videoElement","document","getElementById","src","srcObject","setProgressBarColor","ctxt","p","parseInt","props","currentState","progress","progressBarColor","ctrlBtnFunction","stateName","stateHandler","setTimeout","startRecording","timeStartPressed","Date","now","stopRecording","hideSidePanel","changeStateProp","fullScreen","tabOn","setStream","restartStateProps","countdown","canvas","cnvs","w","clientWidth","window","innerWidth","h","clientHeight","style","width","height","left","clientLeft","top","clientTop","context","getContext","font","Math","trunc","beginPath","arc","PI","fillStyle","fill","fillText","toString","urlToPromise","url","Promise","resolve","reject","getBinaryContent","err","downloadScreenshots","zip","i","GallerySrc","length","name","file","binary","generateAsync","then","content","saveAs","downloadVideo","aux","createElement","body","appendChild","href","download","click","captureScreenshot","canvasPreview","current","imgAsDataURL","toDataURL","newSlidesData","thumbnail","thumbnailWidth","thumbnailHeight","setScreenshots","mirror","way","localeCompare","mirrorTranslate","mirrorScale","div","btns","canvasDim","getCanvasDim","saveCanvasDim","screen","innerHeight","marginLeft","getComputedStyle","addEventListener","showButtons","hideButtons","webkitRequestFullScreen","requestFullscreen","exitFullscreen","removeEventListener","opacity"],"mappings":"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","sourcesContent":["import JSZipUtils from 'jszip-utils';\nimport JSZip from 'jszip';\nimport FileSaver from 'file-saver';\n\nexport var handleDataAvailable = function(el) {\n  return function (event) {\n    console.log('handleDataAvailable');\n      if (event.data && event.data.size > 0) {\n      el.recordedChunks.push(event.data);\n      var blob = new Blob(el.recordedChunks, {\n        type: \"video/webm\"\n      });\n      el.videoRecorded = URL.createObjectURL(blob);\n      var videoElement = document.getElementById(\"recordedVideoElement\");\n      videoElement.src = null;\n      videoElement.srcObject = null;\n      videoElement.src = el.videoRecorded;\n      }\n        else {\n        console.log(\"no data available for recording\");\n      }\n  }\n}\n\n  export function setProgressBarColor(ctxt){\n    let p =parseInt(ctxt.props.currentState.progress,10);\n    if (p < 80){\n      ctxt.progressBarColor = \"info\";\n    }\n    else if (p < 100){\n      ctxt.progressBarColor = \"success\";\n    }\n    else{\n      ctxt.progressBarColor = \"danger\";\n    }\n    return ctxt.progressBarColor;\n  }\n  \n  export function ctrlBtnFunction(ctxt){\n    switch(ctxt.props.currentState.stateName){\n      case 'Idle':\n        ctxt.props.stateHandler('GetCon');\n        // Dummy, despues vendra del servidor.\n        setTimeout(()=>{ctxt.props.stateHandler('Countdown');ctxt.startRecording();ctxt.timeStartPressed = Date.now();}, 1000);\n        // Enviar al servidor la solicitud de conexión.\n        break;\n      case 'GetCon':\n        ctxt.props.stateHandler('Idle');\n        break;\n      case 'Examination':\n        ctxt.stopRecording();\n        if(ctxt.props.currentState.hideSidePanel){\n          ctxt.props.changeStateProp({hideSidePanel: false});\n        }\n        if(ctxt.props.currentState.fullScreen){\n         fullScreen(ctxt); \n        }\n        ctxt.props.stateHandler('Review');\n        ctxt.props.changeStateProp({tabOn: \"4\"}); //tab diagnostico\n        // Enviar al servidor la solicitud de diagnóstico.\n        break;\n      case 'Review':\n        ctxt.props.stateHandler('Idle');\n        ctxt.setStream();\n        console.log(document.getElementById(\"buttons\"));\n        restartStateProps();\n        break;\n      default:\n        console.log(\"Error: Boton apretado en estado que no correspondía.\")\n    }\n  }\n  function restartStateProps(){\n\n  }\n  export function countdown(canvas,el){\n    //let context = canvas;\t\n    let cnvs = document.getElementById(\"canvasCountdown\");\n    if(cnvs){\n      let w =canvas.clientWidth*100/window.innerWidth;\n      let h =canvas.clientHeight*100/window.innerWidth;\n      cnvs.style.width =  w + \"vw\";\n      cnvs.style.height=  h + \"vw\";\n      cnvs.style.left = canvas.clientLeft;\n      cnvs.style.top = canvas.clientTop;\n      let context = cnvs.getContext(\"2d\");\n      context.font = cnvs.height/3 +\"px Arial\"\n             \n\n      //let countdown = el.props.countdownFrom- Math.trunc((-el.timeStartPressed + Date.now())/1000);\n      let countdown = 10- Math.trunc((-el.timeStartPressed + Date.now())/1000);\n      context.beginPath();\n//      context.arc(cnvs.clientWidth/2, cnvs.clientHeight/2, cnvs.clientHeight/2, 0, 2 * Math.PI);\n      context.arc(cnvs.width/2,cnvs.height/2,cnvs.height/3,0, 2 * Math.PI);\n      context.fillStyle = \"rgba(255, 255, 255, 0.8)\";;\n      context.fill();\n      context.beginPath();\n      context.fillStyle = \"black\";\n      if(countdown >= 10){\n        context.fillText(countdown.toString(10),cnvs.width/2,cnvs.height/2);\n      }else if(countdown >= 1){\n        context.fillText(countdown.toString(10),cnvs.width/2 ,cnvs.height/2);\n      }\n    \n      context.fill();\n      if (countdown <  1){\n            el.props.stateHandler(\"Examination\");\n      }\n      }\n  }\n  \n  export function urlToPromise(url) {\n    return new Promise(function(resolve, reject) {\n      JSZipUtils.getBinaryContent(url, function (err, data) {\n        if(err) {\n          reject(err);\n        }\n        else {\n          resolve(data);\n        }\n      });\n    });\n  }\n\n  export function downloadScreenshots(el){\n    let zip = new JSZip();\n    for(let i=0;i < el.props.currentState.GallerySrc.length; i++){\n      let name = \"Screenshot_\" + i + \".jpeg\";\n      zip.file(name,urlToPromise(el.props.currentState.GallerySrc[i].src),{binary:true});\n    }\n    zip.generateAsync({type: \"blob\"}).then(function(content) {\n      FileSaver.saveAs(content, \"download.zip\");\n    });\n  }\n\n  export function downloadVideo(el){\n    var aux = document.createElement(\"a\");\n    document.body.appendChild(aux);\n    aux.style = \"display: none\";\n    aux.href = el.videoRecorded;\n    aux.download = \"test.webm\";\n    document.body.appendChild(aux);\n    aux.click();\t\t\n  }\n  \n  export function captureScreenshot(el){\n    var canvas = el.props.canvasPreview.current; \n    var imgAsDataURL = canvas.toDataURL(\"image/jpeg\",1);\n    let newSlidesData = [{src: imgAsDataURL, \n                          thumbnail: imgAsDataURL,\n                          thumbnailWidth: 160,\n                          thumbnailHeight: 120\n                        }];\n    el.props.setScreenshots(newSlidesData);\n    }\n\nexport function mirror(el,way){\n  //revisar numeros\n\tif(way.localeCompare(\"horizontal\") === 0){\n    el.mirrorTranslate[0] += el.mirrorScale[0]*640;\n    el.mirrorScale[0]*=-1;\n  }\n  else if(way.localeCompare(\"vertical\") === 0){\n    el.mirrorTranslate[1] += el.mirrorScale[1]*480;\n    el.mirrorScale[1]*=-1;\n  }\n}\n\nexport function fullScreen(el){\n  let div = document.getElementById(\"canvasDiv\");\n  let canvas = document.getElementById(\"canvasPreview\");\n  let btns= document.getElementById(\"buttons\");\n  let progress= document.getElementById(\"progressBar\");\n  let canvasDim = el.props.getCanvasDim();\n\tif(!el.props.currentState.fullScreen){\n    el.props.saveCanvasDim(canvas.clientWidth*100/window.innerWidth,canvas.clientHeight*100/window.innerWidth);//vw\n    canvasDim = [canvas.clientWidth,canvas.clientHeight];\n\t\tcanvas.style.height = window.screen.height - 2*window.innerHeight/100+ \"px\";\n\t\tcanvas.style.width = window.screen.height*canvasDim[0]/canvasDim[1] + \"px\";\n\t\tcanvas.style.marginLeft = \"12%\";\n\n\t\tdiv.appendChild(btns);\n\t\tdiv.appendChild(progress);\n\t\tbtns.style.width = getComputedStyle(canvas).width;\n    btns.style.marginLeft = \"12%\"\n\t\tbtns.style.top = window.screen.height - btns.clientHeight - 10 + \"px\";\n\t\tcanvas.addEventListener(\"mouseover\",showButtons, false);\n\t\tbtns.addEventListener(\"mouseover\",showButtons, false);\n\t\tcanvas.addEventListener(\"mouseout\",hideButtons,false);\n\t\tif(div.webkitRequestFullScreen) {\n\t\t\tdiv.webkitRequestFullScreen(); \n\t\t}\n\t\telse {\n\t\t\tdiv.requestFullscreen();\n\t\t} \n\t\tel.props.changeStateProp({fullScreen: true});\n\t}\n\telse{\n    document.exitFullscreen();\n    div.style.width=  \"50vw\";\n\t\tcanvas.style.width = canvasDim[0] +\"vw\";\n\t\tcanvas.style.height = canvasDim[1]+\"vw\";\n\t\tel.props.changeStateProp({fullScreen: false});\n\t\tdocument.getElementById(\"WebcamStream_Wrapper\").appendChild(btns);\n\t\tdocument.getElementById(\"WebcamStream_Wrapper\").appendChild(progress);\n    canvas.style.height = canvas.clientWidth*(100/window.innerWidth)*canvasDim[1]/canvasDim[0] + \"vw\";\n\t\tcanvas.style.marginLeft = 0;\n    if(!el.props.currentState.hideSidePanel){\n\t\t  btns.style.top = canvasDim[1] + \"vw\";\n    }\n    else{\n      console.log(\"asdf\");\n\t\t  btns.style.top = canvasDim[1] - btns.clientHeight*100/window.innerWidth+ \"vw\";\n    }\n    btns.style.marginLeft = div.style.marginLeft;\n    btns.style.width = canvasDim[0] + \"vw\";\n\t\tcanvas.removeEventListener(\"mouseover\",showButtons,false);\n\t\tbtns.removeEventListener(\"mouseover\",showButtons,false);\n\t\tcanvas.removeEventListener(\"mouseout\",hideButtons,false);\n\t\tbtns.style.opacity = 1;\n\t}\n}\n\nfunction showButtons(){\n\tvar btns= document.getElementById(\"buttons\");\n\tbtns.style.opacity=0.7;\n}\n\nfunction hideButtons(){\n\tvar btns= document.getElementById(\"buttons\");\n\tbtns.style.opacity=0;\n}\n\n\n  export default {handleDataAvailable, setProgressBarColor, ctrlBtnFunction, countdown, urlToPromise,\n                 downloadScreenshots, downloadVideo, captureScreenshot, mirror, fullScreen}\n"]},"metadata":{},"sourceType":"module"}