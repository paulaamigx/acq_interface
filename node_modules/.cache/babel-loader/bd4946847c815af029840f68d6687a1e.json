{"ast":null,"code":"var _jsxFileName = \"/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/WebcamStream.js\";\nimport './InferenceUI.css';\nimport React from 'react';\nimport { Button, Alert } from 'reactstrap';\n\nclass WebcamStream extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isVideoLoading: true\n    };\n    this.videoTag = React.createRef();\n    this.videoSavedTag = React.createRef();\n    this.canvasPreview = React.createRef();\n    this.selectVideoSrc = React.createRef();\n    this.tick = this.tick.bind(this);\n    this.mirrorCount = 0;\n    this.fullScreenCount = 0;\n    this.mediaRecorder = null;\n    this.recordedChunks = [];\n    this.videoRecorded = null;\n  }\n\n  componentDidMount() {\n    this.setStream();\n  }\n\n  setStream() {\n    navigator.mediaDevices.enumerateDevices().then(deviceInfos => {\n      for (let i = 0; i !== deviceInfos.length; ++i) {\n        const deviceInfo = deviceInfos[i];\n\n        if (!this.inSelect(deviceInfo.label)) {\n          const option = document.createElement('option');\n          option.value = deviceInfo.deviceId;\n\n          if (deviceInfo.kind === 'videoinput') {\n            option.text = deviceInfo.label || 'camera ' + (this.selectVideoSrc.current.length + 1);\n            this.selectVideoSrc.current.appendChild(option);\n          }\n        }\n      }\n    }).then(navigator.mediaDevices.getUserMedia({\n      video: {\n        deviceId: this.selectVideoSrc.current.value ? {\n          exact: this.selectVideoSrc.current.value\n        } : undefined,\n        facingMode: \"enviroment\"\n      }\n    }).then(stream => {\n      this.videoTag.current.srcObject = stream;\n      requestAnimationFrame(this.tick);\n      window.stream = stream;\n      var options = {\n        mimeType: \"video/webm;codecs=vp8\"\n      };\n      this.mediaRecorder = new MediaRecorder(stream, options);\n    }));\n  }\n\n  tick() {\n    const video = this.props.currentState.current.localeCompare(\"StopStream\") === 0 ? this.videoSavedTag.current : this.videoTag.current;\n    const checkVideoState = setInterval(() => {\n      if (video.readyState === video.HAVE_ENOUGH_DATA) {\n        clearInterval(checkVideoState);\n        this.setState({\n          isVideoLoading: false\n        });\n        const canvasPreviewElement = this.canvasPreview.current;\n        const canvasPreview = canvasPreviewElement.getContext(\"2d\");\n        canvasPreviewElement.height = video.videoHeight;\n        canvasPreviewElement.width = video.videoWidth;\n        canvasPreview.drawImage(video, 0, 0, canvasPreviewElement.width, canvasPreviewElement.height);\n\n        if (this.props.currentState.almostStreaming) {\n          canvasPreview.font = \"200px Arial\";\n          countdown(canvasPreview, this);\n        }\n\n        requestAnimationFrame(this.tick);\n      }\n    }, 50);\n  }\n\n  inSelect(newElement) {\n    for (let i = 0; i < this.selectVideoSrc.current.childElementCount; i++) {\n      if (this.selectVideoSrc.current.children[i].label.localeCompare(newElement) === 0) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  startRecording() {\n    this.mediaRecorder.ondataavailable = handleDataAvailable(this);\n    this.mediaRecorder.start();\n    setInterval(() => {\n      this.props.getVideoThumbnail(this.canvasPreview.current.toDataURL(\"image/jpeg\", 1));\n    }, 300);\n  }\n\n  stopRecording() {\n    this.mediaRecorder.stop();\n  }\n\n  makeVideo() {\n    var blob = new Blob(this.recordedChunks, {\n      type: \"video/webm\"\n    });\n    this.videoRecorded = URL.createObjectURL(blob);\n  }\n\n  downloadVideo() {\n    var aux = document.createElement(\"a\");\n    document.body.appendChild(aux);\n    aux.style = \"display: none\";\n    aux.href = this.videoRecorded;\n    aux.download = \"test.webm\";\n    aux.click();\n    this.recordedChunks = [];\n  }\n\n  render() {\n    const {\n      isVideoLoading\n    } = this.state;\n    let classNameToRender = this.props.currentState.fullScreen ? \"FullScreen\" : \"RegularScreen\";\n    return /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        position: \"absolute\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"video\", {\n      ref: this.videoTag,\n      autoPlay: true,\n      id: \"video\",\n      style: {\n        display: \"none\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"video\", {\n      ref: this.videoSavedTag,\n      id: \"videoPlayer\",\n      src: this.videoRecorded,\n      style: {\n        display: \"none\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }\n    }), !isVideoLoading && /*#__PURE__*/React.createElement(\"div\", {\n      id: \"mainDiv\",\n      className: \"container  mainDiv\" + classNameToRender,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"canvasDiv\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 13\n      }\n    }, this.props.currentState.showAlert && /*#__PURE__*/React.createElement(AlertOnPreview, {\n      msg: \"Recibiendo Im\\xE1genes Borrosas\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"canvas\", {\n      ref: this.canvasPreview,\n      id: \"canvasPreview\",\n      className: \"canvasPreview\" + classNameToRender,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"mirror\",\n      className: \"overlay\" + classNameToRender + \" mirror\" + classNameToRender + \" overlay\",\n      onClick: () => {\n        mirror(this);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 15\n      }\n    }, \"M\"), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"fullScreen\",\n      className: \"overlay\" + classNameToRender + \" fullScreen\" + classNameToRender + \" overlay\",\n      onClick: () => {\n        fullScreen(this);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 15\n      }\n    }, \"PC\"), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"belowCanvas\",\n      className: \"belowCanvas\" + classNameToRender,\n      style: {\n        position: \"absolute\",\n        top: \"900px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 15\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"videoSelectDiv\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"select\", {\n      ref: this.selectVideoSrc,\n      style: {\n        width: 300\n      },\n      id: \"videoSelect\",\n      onChange: () => {\n        this.setStream();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      color: \"primary\",\n      onClick: () => {\n        document.getElementById(\"videoSelectDiv\").remove();\n        this.props.handler(\"OnConnection\");\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 6\n      }\n    }, \"Ok\")), isVideoLoading && /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 28\n      }\n    }, \"Please wait while we load the video stream.\"));\n  }\n\n}\n\nasync function fullScreen(el) {\n  let div = document.getElementById(\"mainDiv\");\n  let canvas = document.getElementById(\"canvasPreview\");\n  let below = document.getElementById(\"belowCanvas\");\n  let screenshots = document.getElementById(\"screenshots\");\n  let btns = await document.getElementById(\"buttons\"); //go fullscreen\n\n  if (el.fullScreenCount % 2 === 0) {\n    el.props.changeStateProp({\n      fullScreen: true\n    });\n    btns.appendChild(document.getElementById(\"mirror\"));\n    btns.appendChild(document.getElementById(\"fullScreen\"));\n    div.appendChild(btns);\n    below.appendChild(screenshots); //style\n\n    canvas.style.height = window.screen.height + \"px\";\n    canvas.style.width = window.screen.height * 640 / 480 + \"px\";\n    canvas.style.left = (window.screen.width - getComputedStyle(canvas).width) / 2 + \"px\";\n    screenshots.style.width = getComputedStyle(canvas).width;\n    btns.style.width = getComputedStyle(canvas).width;\n    below.style.top = window.screen.height + \"px\";\n\n    if (div.webkitRequestFullScreen) {\n      div.webkitRequestFullScreen();\n    } else {\n      div.requestFullscreen();\n    }\n\n    el.divId = \"ButtonsFullScreen\";\n  } //exit fullscreen\n  else {\n      el.props.changeStateProp({\n        fullScreen: false\n      }); //detach elements\n\n      div.appendChild(document.getElementById(\"mirror\"));\n      div.appendChild(document.getElementById(\"fullScreen\"));\n      document.getElementById(\"ElementsMain\").appendChild(btns);\n      document.getElementById(\"ElementsMain\").appendChild(screenshots); //style\n\n      canvas.style.height = \"480px\";\n      canvas.style.width = \"640px\";\n      screenshots.style.width = \"640px\";\n      document.exitFullscreen();\n    }\n\n  el.fullScreenCount++;\n} //For making video recording\n\n\nvar handleDataAvailable = function (el) {\n  return function (event) {\n    console.log(\"data-available\");\n\n    if (event.data.size > 0) {\n      el.recordedChunks.push(event.data);\n      el.makeVideo();\n    } else {\n      console.log(\"no data available for recording\");\n    }\n  };\n};\n\nfunction AlertOnPreview(props) {\n  return /*#__PURE__*/React.createElement(\"div\", {\n    id: \"alert\",\n    style: {\n      position: 'absolute',\n      zIndex: 2\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Alert, {\n    color: \"warning\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 7\n    }\n  }, props.msg));\n}\n\nfunction mirror(el) {\n  let canvas = document.querySelector(\"#canvasPreview\");\n\n  if (el.mirrorCount % 2 === 0) {\n    canvas.style.transform = \"translate(640,0)\";\n    canvas.style.transform = \"scale(-1,1)\";\n  } else {\n    canvas.style.transform = \"none\";\n  }\n\n  el.mirrorCount++;\n}\n\nfunction countdown(canvas, el) {\n  let context = canvas;\n  let countdown = el.props.countdownFrom - Math.trunc((-el.props.currentState.timeStartPressed + Date.now()) / 1000);\n  context.beginPath();\n  context.arc(320, 240, 130, 0, 2 * Math.PI);\n  context.fillStyle = \"rgba(255, 255, 255, 0.8)\";\n  ;\n  context.fill();\n  context.beginPath();\n  context.fillStyle = \"black\";\n\n  if (countdown >= 10) {\n    context.fillText(countdown.toString(10), 200, 315);\n  } else if (countdown >= 1) {\n    context.fillText(countdown.toString(10), 270, 308, 100);\n  }\n\n  context.fill();\n\n  if (countdown < 1) {\n    el.props.currentState.almostStreaming = false;\n    el.props.currentState.streaming = true;\n    el.props.handler(\"Streaming\");\n  }\n}\n\nexport default WebcamStream;","map":{"version":3,"sources":["/home/paula/Documents/Practica/git/user_interface/src/components/InferenceUI/WebcamStream.js"],"names":["React","Button","Alert","WebcamStream","Component","constructor","props","state","isVideoLoading","videoTag","createRef","videoSavedTag","canvasPreview","selectVideoSrc","tick","bind","mirrorCount","fullScreenCount","mediaRecorder","recordedChunks","videoRecorded","componentDidMount","setStream","navigator","mediaDevices","enumerateDevices","then","deviceInfos","i","length","deviceInfo","inSelect","label","option","document","createElement","value","deviceId","kind","text","current","appendChild","getUserMedia","video","exact","undefined","facingMode","stream","srcObject","requestAnimationFrame","window","options","mimeType","MediaRecorder","currentState","localeCompare","checkVideoState","setInterval","readyState","HAVE_ENOUGH_DATA","clearInterval","setState","canvasPreviewElement","getContext","height","videoHeight","width","videoWidth","drawImage","almostStreaming","font","countdown","newElement","childElementCount","children","startRecording","ondataavailable","handleDataAvailable","start","getVideoThumbnail","toDataURL","stopRecording","stop","makeVideo","blob","Blob","type","URL","createObjectURL","downloadVideo","aux","body","style","href","download","click","render","classNameToRender","fullScreen","position","display","showAlert","mirror","top","getElementById","remove","handler","el","div","canvas","below","screenshots","btns","changeStateProp","screen","left","getComputedStyle","webkitRequestFullScreen","requestFullscreen","divId","exitFullscreen","event","console","log","data","size","push","AlertOnPreview","zIndex","msg","querySelector","transform","context","countdownFrom","Math","trunc","timeStartPressed","Date","now","beginPath","arc","PI","fillStyle","fill","fillText","toString","streaming"],"mappings":"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","sourcesContent":["import './InferenceUI.css'\nimport React from 'react';\nimport {Button, Alert} from 'reactstrap';\n\nclass WebcamStream extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isVideoLoading: true,\n    };\n\n    this.videoTag = React.createRef();\n    this.videoSavedTag = React.createRef();\n    this.canvasPreview = React.createRef();\n\t\tthis.selectVideoSrc = React.createRef();\n    this.tick = this.tick.bind(this);\n\n    this.mirrorCount = 0;\n    this.fullScreenCount = 0;\n\n    this.mediaRecorder = null;\n    this.recordedChunks= [];\n\t  this.videoRecorded = null;\n\n\t}\n\n  componentDidMount() {\n    this.setStream();\n\n  }\n  setStream(){\n    navigator.mediaDevices\n\t\t.enumerateDevices()\n\t\t.then( deviceInfos => {\n\t\t\t\tfor (let i = 0; i !== deviceInfos.length; ++i) {\n\t\t\t\t\tconst deviceInfo = deviceInfos[i];\n          if (!this.inSelect(deviceInfo.label)){\n\t\t\t\t\tconst option = document.createElement('option');\n\t\t\t\t\toption.value = deviceInfo.deviceId;\n\t\t\t\t\tif (deviceInfo.kind === 'videoinput') {\n\t\t\t\t\t\toption.text = deviceInfo.label || 'camera ' +\n\t\t\t\t\t\t\t(this.selectVideoSrc.current.length + 1);\n\t\t\t\t\t\tthis.selectVideoSrc.current.appendChild(option);\n\t\t\t\t\t} \n          }\n\t\t\t\t}\n\t\t})\t\t\t\t \n\t\t.then(navigator.mediaDevices\n      .getUserMedia({ video: {deviceId: this.selectVideoSrc.current.value ? {exact: this.selectVideoSrc.current.value} : undefined, facingMode: \"enviroment\"}})\n      .then(stream => {\n        this.videoTag.current.srcObject = stream;\n        requestAnimationFrame(this.tick);\n        window.stream = stream;\n        var options = { mimeType: \"video/webm;codecs=vp8\" };\n        this.mediaRecorder = new MediaRecorder(stream, options);\n      })\n\t\t);\n    \n  }\n\n  tick() {\n    const video = (this.props.currentState.current.localeCompare(\"StopStream\") === 0)?  this.videoSavedTag.current : this.videoTag.current;\n\n\n    const checkVideoState = setInterval(() => {\n      if (video.readyState === video.HAVE_ENOUGH_DATA) {\n        clearInterval(checkVideoState);\n\n        this.setState({ isVideoLoading: false });\n\n          const canvasPreviewElement = this.canvasPreview.current;\n          const canvasPreview = canvasPreviewElement.getContext(\"2d\");\n\n          canvasPreviewElement.height = video.videoHeight;\n          canvasPreviewElement.width = video.videoWidth;\n          canvasPreview.drawImage(\n              video,\n              0,\n              0,\n              canvasPreviewElement.width,\n              canvasPreviewElement.height\n           );\n           if(this.props.currentState.almostStreaming){\n             canvasPreview.font = \"200px Arial\"\n             countdown(canvasPreview,this);\n           }\n           requestAnimationFrame(this.tick);\n      }\n    }, 50);\n  }\n\n  inSelect(newElement){\n    for (let i = 0; i < this.selectVideoSrc.current.childElementCount; i++){\n      if(this.selectVideoSrc.current.children[i].label.localeCompare(newElement)===0){\n        return true;\n      }\n    }\n    return false;\n    \n  }\n\n  startRecording(){\n      this.mediaRecorder.ondataavailable = handleDataAvailable(this);\n      this.mediaRecorder.start();\n      setInterval(()=>{this.props.getVideoThumbnail(this.canvasPreview.current.toDataURL(\"image/jpeg\",1));},300);\n  }\n\n\tstopRecording(){\n\t\tthis.mediaRecorder.stop();\n\t}\n\n\tmakeVideo() {\n\t\tvar blob = new Blob(this.recordedChunks, {\n\t\t\ttype: \"video/webm\"\n\t\t});\n\t\tthis.videoRecorded = URL.createObjectURL(blob);\n\t}\n\n\tdownloadVideo(){\n\t\tvar aux = document.createElement(\"a\");\n\t\tdocument.body.appendChild(aux);\n\t\taux.style = \"display: none\";\n\t\taux.href = this.videoRecorded;\n\t\taux.download = \"test.webm\";\n\t\taux.click();\n\t\tthis.recordedChunks = [];\n\t}\n\n  render() {\n    const { isVideoLoading } = this.state;\n    let classNameToRender = (this.props.currentState.fullScreen)? \"FullScreen\":\"RegularScreen\";\n    return (\n      <div style={{position: \"absolute\"}}>\n        <video\n          ref={this.videoTag}\n          autoPlay\n          id = \"video\"\n          style={{ display: \"none\"}}/>\n\n        <video\n          ref={this.videoSavedTag}\n          id = \"videoPlayer\"\n          src = {this.videoRecorded}\n          style={{ display: \"none\"}}/>\n\n        {!isVideoLoading && \n          <div  id=\"mainDiv\" \n                className={\"container  mainDiv\" + classNameToRender }>\n            <div id=\"canvasDiv\">\n              {this.props.currentState.showAlert && \n                <AlertOnPreview msg=\"Recibiendo ImÃ¡genes Borrosas\"/>}\n              <canvas ref={this.canvasPreview} \n                      id=\"canvasPreview\" \n                      className = {\"canvasPreview\" + classNameToRender}/>\n              <div id=\"mirror\" \n                   className={\"overlay\"  + classNameToRender +\" mirror\"+ classNameToRender + \" overlay\"}\n                   onClick={()=>{mirror(this)}}>M</div>\n              <div id=\"fullScreen\" \n                   className={\"overlay\"  + classNameToRender +\" fullScreen\"+ classNameToRender + \" overlay\"}\n                   onClick={()=>{fullScreen(this)}}>PC</div>\n              <div  id=\"belowCanvas\" \n                    className={\"belowCanvas\" + classNameToRender}\n                    style={{position: \"absolute\", top: \"900px\"}}>\n              </div>\n              \n            </div>\n\n          </div>\n        }\n\t\t\t\t<div id=\"videoSelectDiv\" >\n\t\t\t\t\t<select ref={this.selectVideoSrc}\n\t\t\t\t\t\t\t\t\tstyle={{width: 300 }}\n\t\t\t\t\t\t\t\t\tid=\"videoSelect\"\n                  onChange={()=>{this.setStream();}}/>\n\t\t\t\t\t<Button color='primary' \n                  onClick={()=>{document.getElementById(\"videoSelectDiv\").remove();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.props.handler(\"OnConnection\");}}\n          >Ok</Button>\n\t\t\t\t</div>\n        {isVideoLoading && <p>Please wait while we load the video stream.</p>}\n\n      </div>\n    );\n  }\n}\n\nasync function fullScreen(el){\n  let div = document.getElementById(\"mainDiv\");\n  let canvas  = document.getElementById(\"canvasPreview\");\n  let below = document.getElementById(\"belowCanvas\");\n  let screenshots = document.getElementById(\"screenshots\"); \n  let btns = await document.getElementById(\"buttons\");\n  \n  //go fullscreen\n  if (el.fullScreenCount%2 === 0){\n    el.props.changeStateProp({fullScreen: true});\n    btns.appendChild(document.getElementById(\"mirror\"));\n    btns.appendChild(document.getElementById(\"fullScreen\"));\n    div.appendChild(btns);\n    below.appendChild(screenshots);\n    \n    //style\n    canvas.style.height = window.screen.height + \"px\";\n    canvas.style.width = window.screen.height*640/480 + \"px\";\n    canvas.style.left = (window.screen.width - getComputedStyle(canvas).width)/2 + \"px\";\n\n    screenshots.style.width =  getComputedStyle(canvas).width;\n    btns.style.width = getComputedStyle(canvas).width;\n    below.style.top = window.screen.height + \"px\";\n\n    if(div.webkitRequestFullScreen) {\n      div.webkitRequestFullScreen(); }\n    else {\n      div.requestFullscreen();} \n    el.divId = \"ButtonsFullScreen\";\n  }\n\n  //exit fullscreen\n  else{\n    el.props.changeStateProp({fullScreen: false});\n    //detach elements\n    div.appendChild(document.getElementById(\"mirror\"));\n    div.appendChild(document.getElementById(\"fullScreen\"));\n    document.getElementById(\"ElementsMain\").appendChild(btns);\n    document.getElementById(\"ElementsMain\").appendChild(screenshots);\n  \n    //style\n    canvas.style.height =  \"480px\";\n    canvas.style.width=  \"640px\";\n    screenshots.style.width =  \"640px\";\n    document.exitFullscreen();\n  }\n  el.fullScreenCount++;\n}\n\n//For making video recording\nvar handleDataAvailable = function (el) {\n  return function (event) {\n\t\tconsole.log(\"data-available\");\n  \tif (event.data.size > 0) {\n   \t  el.recordedChunks.push(event.data);\n      el.makeVideo();\n  \t}\n\t\telse {\n    \tconsole.log(\"no data available for recording\");\n  \t}\n  \n  };\n};\n\nfunction AlertOnPreview(props){\n  return(\n    <div id=\"alert\" style={{position: 'absolute', zIndex: 2}}>\n      <Alert color=\"warning\">{props.msg}</Alert>\n    </div>\n  )\n}\nfunction mirror(el){\n  let canvas = document.querySelector(\"#canvasPreview\");\n  if (el.mirrorCount%2 === 0){\n    canvas.style.transform = \"translate(640,0)\";\n    canvas.style.transform = \"scale(-1,1)\";\n  }\n  else{\n    canvas.style.transform = \"none\";\n  }\n  el.mirrorCount ++;\n}\n\nfunction countdown(canvas,el){\n\tlet context = canvas;\t\n\tlet countdown = el.props.countdownFrom- Math.trunc((-el.props.currentState.timeStartPressed + Date.now())/1000);\n  context.beginPath();\n  context.arc(320, 240, 130, 0, 2 * Math.PI);\n  context.fillStyle = \"rgba(255, 255, 255, 0.8)\";;\n  context.fill();\n  context.beginPath();\n  context.fillStyle = \"black\";\n  if(countdown >= 10){\n    context.fillText(countdown.toString(10),200,315);\n  }else if(countdown >= 1){\n    context.fillText(countdown.toString(10),270,308,100);\n  }\n\n  context.fill();\n  if (countdown <  1){\n    el.props.currentState.almostStreaming = false;\n    el.props.currentState.streaming = true;\n\t\tel.props.handler(\"Streaming\");\n  }\n\t\n}\nexport default WebcamStream;\n"]},"metadata":{},"sourceType":"module"}